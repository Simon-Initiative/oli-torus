{"version":3,"file":"activity_bridge.js","sourceRoot":"","sources":["../../../src/phoenix/activity_bridge.ts"],"names":[],"mappings":"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","sourcesContent":["import * as Persistence from 'data/persistence/activity';\nimport {\n  PartResponse,\n  ActivityModelSchema,\n  FeedbackAction,\n  ClientEvaluation,\n  Part,\n  ActivityState,\n  PartState,\n} from 'components/activities/types';\nimport { RequestHintResponse } from 'components/activities/DeliveryElement';\nimport { valueOr, removeEmpty } from 'utils/common';\nimport guid from 'utils/guid';\nimport { defaultActivityState } from 'data/activities/utils';\n\ntype Continuation = (success: any, error: any) => void;\n\nfunction makeRequest(url: string, method: string, body: any, continuation: any) {\n  const params = {\n    method,\n    headers: { 'Content-Type': 'application/json' },\n    body: body === undefined ? undefined : JSON.stringify(body),\n  };\n  window\n    .fetch(url, params)\n    .then((response) => response.json())\n    .then((result) => continuation(result))\n    .catch((error) => continuation(undefined, error));\n}\n\nexport const initActivityBridge = (elementId: string) => {\n  const div = document.getElementById(elementId) as any;\n\n  div.addEventListener(\n    'saveActivity',\n    (e: any) => {\n      e.preventDefault();\n      e.stopPropagation();\n      makeRequest(\n        `/api/v1/state/course/${e.detail.sectionSlug}/activity_attempt/${e.detail.attemptGuid}`,\n        'PATCH',\n        { partInputs: e.detail.payload },\n        e.detail.continuation,\n      );\n    },\n    false,\n  );\n\n  div.addEventListener(\n    'submitActivity',\n    (e: any) => {\n      e.preventDefault();\n      e.stopPropagation();\n      makeRequest(\n        `/api/v1/state/course/${e.detail.sectionSlug}/activity_attempt/${e.detail.attemptGuid}`,\n        'PUT',\n        { partInputs: e.detail.payload },\n        e.detail.continuation,\n      );\n    },\n    false,\n  );\n\n  div.addEventListener(\n    'resetActivity',\n    (e: any) => {\n      e.preventDefault();\n      e.stopPropagation();\n      makeRequest(\n        `/api/v1/state/course/${e.detail.sectionSlug}/activity_attempt/${e.detail.attemptGuid}`,\n        'POST',\n        {},\n        e.detail.continuation,\n      );\n    },\n    false,\n  );\n\n  div.addEventListener(\n    'savePart',\n    (e: any) => {\n      e.preventDefault();\n      e.stopPropagation();\n      makeRequest(\n        `/api/v1/state/course/${e.detail.sectionSlug}/activity_attempt/${e.detail.attemptGuid}/part_attempt/${e.detail.partAttemptGuid}`,\n        'PATCH',\n        { response: e.detail.payload },\n        e.detail.continuation,\n      );\n    },\n    false,\n  );\n\n  div.addEventListener(\n    'submitPart',\n    (e: any) => {\n      e.preventDefault();\n      e.stopPropagation();\n      makeRequest(\n        `/api/v1/state/course/${e.detail.sectionSlug}/activity_attempt/${e.detail.attemptGuid}/part_attempt/${e.detail.partAttemptGuid}`,\n        'PUT',\n        { response: e.detail.payload },\n        e.detail.continuation,\n      );\n    },\n    false,\n  );\n\n  div.addEventListener(\n    'resetPart',\n    (e: any) => {\n      e.preventDefault();\n      e.stopPropagation();\n      makeRequest(\n        `/api/v1/state/course/${e.detail.sectionSlug}/activity_attempt/${e.detail.attemptGuid}/part_attempt/${e.detail.partAttemptGuid}`,\n        'POST',\n        {},\n        e.detail.continuation,\n      );\n    },\n    false,\n  );\n\n  div.addEventListener(\n    'requestHint',\n    (e: any) => {\n      e.preventDefault();\n      e.stopPropagation();\n      makeRequest(\n        `/api/v1/state/course/${e.detail.sectionSlug}/activity_attempt/${e.detail.attemptGuid}/part_attempt/${e.detail.partAttemptGuid}/hint`,\n        'GET',\n        undefined,\n        e.detail.continuation,\n      );\n    },\n    false,\n  );\n\n  div.addEventListener(\n    'submitEvaluations',\n    (e: any) => {\n      e.preventDefault();\n      e.stopPropagation();\n      makeRequest(\n        `/api/v1/state/course/${e.detail.sectionSlug}/activity_attempt/${e.detail.attemptGuid}/evaluations`,\n        'PUT',\n        { evaluations: e.detail.payload },\n        e.detail.continuation,\n      );\n    },\n    false,\n  );\n};\n\nconst key = (activityAttemptGuid: string, partAttemptGuid: string) =>\n  activityAttemptGuid + '|' + partAttemptGuid;\n\nexport const initPreviewActivityBridge = (elementId: string) => {\n  // map to keep track the number of hints requested for each part\n  const hintRequestCounts: { [key: string]: number } = {};\n\n  const div = document.getElementById(elementId) as any;\n\n  function getPart(model: any, id: string): any {\n    return model.authoring.parts.find((p: any) => p.id === id);\n  }\n\n  function submit(e: CustomEvent) {\n    const props = e.detail.props;\n    const continuation: Continuation = e.detail.continuation;\n    const partInputs: PartResponse[] = e.detail.payload;\n\n    Persistence.evaluate(props.model, partInputs).then((result: Persistence.Evaluated) => {\n      const actions: (FeedbackAction | { part_id: string; error: string })[] =\n        result.evaluations.map((e) => {\n          if ('error' in e) {\n            return {\n              part_id: e.part_id,\n              error: e.error,\n            };\n          }\n          return {\n            type: 'FeedbackAction',\n            attempt_guid: e.part_id,\n            out_of: e.result?.out_of,\n            score: e.result?.score,\n            feedback: e.feedback,\n          };\n        });\n\n      continuation({ type: 'success', actions }, undefined);\n    });\n  }\n\n  // IMPLEMENT THESE HANDLERS LATER IF NEEDED IN THE FUTURE\n  // div.addEventListener('saveActivity', (e: any) => {}, false);\n  // div.addEventListener('savePart', (e: any) => {}, false);\n  // div.addEventListener('resetPart', (e: any) => {}, false);\n\n  div.addEventListener(\n    'submitActivity',\n    (e: any) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      submit(e);\n    },\n    false,\n  );\n\n  div.addEventListener(\n    'resetActivity',\n    (e: any) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const props = e.detail.props;\n      const continuation: Continuation = e.detail.continuation;\n      const partId = e.detail.partAttemptGuid;\n\n      Persistence.transform(props.model).then((result: Persistence.Transformed) => {\n        const model = result.transformed === null ? props.model : result.transformed;\n\n        // reset the number of hints requested for this part\n        hintRequestCounts[key(e.detail.attemptGuid, e.detail.partAttemptGuid)] = 0;\n\n        const attemptState = defaultActivityState(model);\n        continuation({ type: 'success', model, attemptState }, undefined);\n      });\n    },\n    false,\n  );\n\n  div.addEventListener(\n    'submitPart',\n    (e: any) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      submit(e);\n    },\n    false,\n  );\n\n  div.addEventListener(\n    'requestHint',\n    (e: any) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const hintKey = key(e.detail.attemptGuid, e.detail.partAttemptGuid);\n\n      const props = e.detail.props;\n      const continuation: Continuation = e.detail.continuation;\n      const partInputs: PartResponse[] = e.detail.payload;\n      const partId = e.detail.partAttemptGuid;\n      const model = props.model;\n      const hints = removeEmpty(getPart(model, partId).hints);\n\n      const nextHintIndex = valueOr(hintRequestCounts[hintKey], 0);\n      const hasMoreHints = hints.length > nextHintIndex + 1;\n      const hint = hints[nextHintIndex];\n      const response: RequestHintResponse = {\n        type: 'success',\n        hint,\n        hasMoreHints,\n      };\n\n      // keep track the number of hints requested for this part\n      hintRequestCounts[hintKey] = valueOr(hintRequestCounts[hintKey], 0) + 1;\n\n      continuation(response, undefined);\n    },\n    false,\n  );\n\n  div.addEventListener('submitEvaluations', (e: any) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const continuation: Continuation = e.detail.continuation;\n    const clientEvaluations: ClientEvaluation[] = e.detail.payload;\n    const evaluatedParts = clientEvaluations.map((clientEval: any) => {\n      return {\n        type: 'EvaluatedPart',\n        out_of: clientEval.out_of,\n        score: clientEval.score,\n        feedback: clientEval.feedback,\n      };\n    });\n\n    continuation({ type: 'success', actions: evaluatedParts }, undefined);\n  });\n};\n"]}