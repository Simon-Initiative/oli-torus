{"version":3,"file":"CreateActivity.jsx","sourceRoot":"","sources":["../../../../src/apps/bank/CreateActivity.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport { ActivityEditorMap, EditorDesc } from 'data/content/editors';\nimport { ActivityEditContext } from 'data/content/activity';\nimport { invokeCreationFunc } from 'components/activities/creation';\nimport * as Persistence from 'data/persistence/activity';\n\nexport type CreateActivityProps = {\n  editorMap: ActivityEditorMap; // Map of activity types to activity elements\n  onAdd: (added: ActivityEditContext) => void;\n  projectSlug: string;\n};\n\nconst create = (\n  projectSlug: string,\n  editorDesc: EditorDesc,\n  onAdded: (context: ActivityEditContext) => void,\n) => {\n  let model: any;\n\n  invokeCreationFunc(editorDesc.slug, {} as any)\n    .then((createdModel) => {\n      model = createdModel;\n      return Persistence.createBanked(projectSlug, editorDesc.slug, createdModel, []);\n    })\n    .then((result: Persistence.Created) => {\n      const objectives = model.authoring.parts\n        .map((p: any) => {\n          return p.id;\n        })\n        .reduce((m: any, id: any) => {\n          m[id] = [];\n          return m;\n        }, {});\n\n      const activity: ActivityEditContext = {\n        authoringElement: editorDesc.authoringElement as string,\n        description: editorDesc.description,\n        friendlyName: editorDesc.friendlyName,\n        activitySlug: result.revisionSlug,\n        typeSlug: editorDesc.slug,\n        activityId: result.resourceId,\n        title: editorDesc.friendlyName,\n        model,\n        objectives,\n        tags: [],\n      };\n\n      onAdded(activity);\n    })\n    .catch((err) => {\n      // tslint:disable-next-line\n      console.error(err);\n    });\n};\n\nexport const CreateActivity = (props: CreateActivityProps) => {\n  const { editorMap, onAdd, projectSlug } = props;\n\n  const handleAdd = (editorDesc: EditorDesc) => create(projectSlug, editorDesc, onAdd);\n\n  const activityEntries = Object.keys(editorMap)\n    .map((k: string) => editorMap[k])\n    .filter(\n      (editorDesc: EditorDesc) => editorDesc.globallyAvailable || editorDesc.enabledForProject,\n    )\n    .map((editorDesc: EditorDesc) => (\n      <a\n        onClick={handleAdd.bind(this, editorDesc)}\n        className=\"dropdown-item\"\n        href=\"#\"\n        key={editorDesc.slug}\n      >\n        {editorDesc.friendlyName}\n      </a>\n    ));\n\n  return (\n    <div className=\"form-inline\">\n      <div className=\"dropdown\">\n        <button\n          type=\"button\"\n          id=\"createButton\"\n          className=\"btn btn-primary dropdown-toggle btn-purpose\"\n          data-toggle=\"dropdown\"\n          aria-haspopup=\"true\"\n          aria-expanded=\"false\"\n        >\n          Create New\n        </button>\n        <div className=\"dropdown-menu\" aria-labelledby=\"createButton\">\n          {activityEntries}\n        </div>\n      </div>\n    </div>\n  );\n};\n"]}