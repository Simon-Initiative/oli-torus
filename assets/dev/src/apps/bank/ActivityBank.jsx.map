{"version":3,"file":"ActivityBank.jsx","sourceRoot":"","sources":["../../../../src/apps/bank/ActivityBank.tsx"],"names":[],"mappings":"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","sourcesContent":["import { modalActions } from 'actions/modal';\nimport { ActivityUndoables, ActivityUndoAction } from 'apps/page-editor/types';\nimport { MultiInputSchema } from 'components/activities/multi_input/schema';\nimport { guaranteeMultiInputValidity } from 'components/activities/multi_input/utils';\nimport { ActivityModelSchema, Undoable as ActivityUndoable } from 'components/activities/types';\nimport {\n  EditorUpdate as ActivityEditorUpdate,\n  InlineActivityEditor,\n} from 'components/activity/InlineActivityEditor';\nimport { PersistenceStatus } from 'components/content/PersistenceStatus';\nimport { Banner } from 'components/messages/Banner';\nimport ModalSelection from 'components/modal/ModalSelection';\nimport { UndoToasts } from 'components/resource/undo/UndoToasts';\nimport { ActivityEditContext } from 'data/content/activity';\nimport * as BankTypes from 'data/content/bank';\nimport { ActivityEditorMap, EditorDesc } from 'data/content/editors';\nimport { Objective } from 'data/content/objective';\nimport { ActivityMap } from 'data/content/resource';\nimport { Tag } from 'data/content/tags';\nimport { createMessage, Message, Severity } from 'data/messages/messages';\nimport * as ActivityPersistence from 'data/persistence/activity';\nimport * as BankPersistence from 'data/persistence/bank';\nimport { DeferredPersistenceStrategy } from 'data/persistence/DeferredPersistenceStrategy';\nimport * as Lock from 'data/persistence/lock';\nimport { PersistenceStrategy } from 'data/persistence/PersistenceStrategy';\nimport { ProjectSlug } from 'data/types';\nimport * as Immutable from 'immutable';\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport { Dispatch, State } from 'state';\nimport { loadPreferences } from 'state/preferences';\nimport { Maybe } from 'tsmonad';\nimport guid from 'utils/guid';\nimport { Operations } from 'utils/pathOperations';\nimport { CreateActivity } from './CreateActivity';\nimport { DeleteActivity } from './DeleteActivity';\nimport { EditingLock } from './EditingLock';\nimport { LogicFilter } from './LogicFilter';\nimport { Paging } from './Paging';\n\nconst PAGE_SIZE = 5;\n\nexport interface ActivityBankProps {\n  editorMap: ActivityEditorMap; // Map of activity types to activity elements\n  projectSlug: ProjectSlug;\n  allObjectives: Objective[]; // All objectives\n  allTags: Tag[]; // All tags\n  totalCount: number;\n}\n\ntype ActivityBankState = {\n  messages: Message[];\n  activityContexts: Immutable.OrderedMap<string, ActivityEditContext>;\n  allObjectives: Immutable.List<Objective>;\n  allTags: Immutable.List<Tag>;\n  persistence: 'idle' | 'pending' | 'inflight';\n  metaModifier: boolean;\n  undoables: ActivityUndoables;\n  paging: BankTypes.Paging;\n  logic: BankTypes.Logic;\n  totalCount: number;\n  totalInBank: number;\n  editedSlug: Maybe<string>;\n  filterExpressions: BankTypes.Expression[];\n  canBeUpdated: boolean; // tracks whether or not the \"Update\" button should be enabled\n};\n\nconst dismiss = () => (window as any).oliDispatch(modalActions.dismiss());\nconst display = (c: any) => (window as any).oliDispatch(modalActions.display(c));\n\nexport function confirmDelete(): Promise<boolean> {\n  return new Promise((resolve, _reject) => {\n    const mediaLibrary = (\n      <ModalSelection\n        title=\"Delete Activity\"\n        onInsert={() => {\n          dismiss();\n          resolve(true);\n        }}\n        onCancel={() => {\n          dismiss();\n          resolve(false);\n        }}\n        okLabel=\"Delete\"\n      >\n        <div>\n          <h5>Are you sure you want to delete this Activity?</h5>\n          <p>This is a permanent operation that cannot be undone.</p>\n        </div>\n      </ModalSelection>\n    );\n\n    display(mediaLibrary);\n  });\n}\n\nexport function showFailedToLockMessage(): Promise<boolean> {\n  return new Promise((resolve, _reject) => {\n    const mediaLibrary = (\n      <ModalSelection\n        title=\"Edit Activity\"\n        onInsert={() => {\n          dismiss();\n          resolve(false);\n        }}\n        onCancel={() => {\n          dismiss();\n          resolve(false);\n        }}\n        disableInsert={true}\n        cancelLabel=\"Ok\"\n        hideOkButton={true}\n        hideDialogCloseButton={true}\n      >\n        <div>\n          <h5>Unable to edit activity</h5>\n          <p>You are unable to edit this activity as there is another user currently editing it.</p>\n        </div>\n      </ModalSelection>\n    );\n\n    display(mediaLibrary);\n  });\n}\n\nfunction defaultFilters() {\n  return [\n    { fact: BankTypes.Fact.objectives, operator: BankTypes.ExpressionOperator.contains, value: [] },\n    { fact: BankTypes.Fact.text, operator: BankTypes.ExpressionOperator.contains, value: '' },\n    { fact: BankTypes.Fact.type, operator: BankTypes.ExpressionOperator.contains, value: [] },\n    { fact: BankTypes.Fact.tags, operator: BankTypes.ExpressionOperator.contains, value: [] },\n  ];\n}\n\nfunction defaultPaging() {\n  return { offset: 0, limit: PAGE_SIZE };\n}\n\n// Take the three fixed filter expressions and convert them to the Logic type.\n// The main goal here is to identify and ignore \"empty\" expressions and not include those\n// in the result logic.  This allows a \"fixed\" UI/UX with three expressions that the user can\n// edit (but not add or remove) to filter through banked activities.\nfunction translateFilterToLogic(expressions: BankTypes.Expression[]): BankTypes.Logic {\n  const nonEmptyExpressions = [];\n\n  if (expressions[0].value.length !== 0) {\n    nonEmptyExpressions.push(expressions[0]);\n  }\n  if (expressions[1].value !== '') {\n    nonEmptyExpressions.push(expressions[1]);\n  }\n  if (expressions[2].value.length !== 0) {\n    nonEmptyExpressions.push(expressions[2]);\n  }\n  if (expressions[3].value.length !== 0) {\n    nonEmptyExpressions.push(expressions[3]);\n  }\n\n  let conditions = null;\n\n  if (nonEmptyExpressions.length === 1) {\n    conditions = nonEmptyExpressions[0];\n  } else if (nonEmptyExpressions.length > 1) {\n    conditions = {\n      operator: BankTypes.ClauseOperator.all,\n      children: nonEmptyExpressions,\n    };\n  }\n\n  return {\n    conditions,\n  };\n}\n\nfunction isEmptyFilterLogic(expressions: BankTypes.Expression[]): boolean {\n  return (\n    expressions[0].value.length === 0 &&\n    expressions[1].value === '' &&\n    expressions[2].value.length === 0 &&\n    expressions[3].value.length === 0\n  );\n}\n\nexport class ActivityBank extends React.Component<ActivityBankProps, ActivityBankState> {\n  persistence: Maybe<PersistenceStrategy>;\n  editorById: { [id: number]: EditorDesc };\n  constructor(props: ActivityBankProps) {\n    super(props);\n\n    this.state = {\n      activityContexts: Immutable.OrderedMap<string, ActivityEditContext>(),\n      messages: [],\n      persistence: 'idle',\n      allObjectives: Immutable.List<Objective>(props.allObjectives),\n      allTags: Immutable.List<Tag>(props.allTags),\n      metaModifier: false,\n      undoables: Immutable.OrderedMap<string, ActivityUndoAction>(),\n      paging: defaultPaging(),\n      editedSlug: Maybe.nothing<string>(),\n      logic: BankTypes.defaultLogic(),\n      filterExpressions: defaultFilters(),\n      totalCount: 0,\n      totalInBank: props.totalCount,\n      canBeUpdated: false,\n    };\n\n    this.editorById = Object.keys(props.editorMap)\n      .map((key: string) => key)\n      .reduce((m: any, k) => {\n        const id = props.editorMap[k].id;\n        m[id] = props.editorMap[k];\n        return m;\n      }, {});\n\n    this.persistence = Maybe.nothing<PersistenceStrategy>();\n    this.onRegisterNewObjective = this.onRegisterNewObjective.bind(this);\n    this.onRegisterNewTag = this.onRegisterNewTag.bind(this);\n    this.onActivityAdd = this.onActivityAdd.bind(this);\n    this.onActivityEdit = this.onActivityEdit.bind(this);\n    this.onPostUndoable = this.onPostUndoable.bind(this);\n    this.onInvokeUndo = this.onInvokeUndo.bind(this);\n    this.onChangeEditing = this.onChangeEditing.bind(this);\n    this.onPageChange = this.onPageChange.bind(this);\n    this.onDelete = this.onDelete.bind(this);\n  }\n\n  componentDidMount() {\n    // Fetch the initial page of activities\n    this.fetchActivities(this.state.logic, this.state.paging);\n  }\n\n  publishErrorMessage(failure: any) {\n    let message;\n    switch (failure?.status) {\n      case 423:\n        message = 'refresh the page to re-gain edit access.';\n        break;\n      case 404:\n        message = 'this page was not found. Try reopening it from the Curriculum.';\n        break;\n      case 403:\n        message = \"you're not able to access this page. Did your login expire?\";\n        break;\n      case 500:\n      default:\n        message =\n          // tslint:disable-next-line\n          'there was a general problem on our end. Please try refreshing the page and trying again.';\n        break;\n    }\n\n    this.addAsUnique(\n      createMessage({\n        guid: 'general-error',\n        canUserDismiss: true,\n        content: \"Your changes weren't saved: \" + message,\n      }),\n    );\n  }\n\n  onActivityAdd(context: ActivityEditContext) {\n    const inserted = [\n      [context.activitySlug, context],\n      ...this.state.activityContexts.toArray(),\n    ].slice(0, PAGE_SIZE);\n    this.setState({\n      activityContexts: Immutable.OrderedMap<string, ActivityEditContext>(inserted as any),\n      totalInBank: this.state.totalInBank + 1,\n      totalCount: this.state.totalCount + 1,\n    });\n    this.onChangeEditing(context.activitySlug, true);\n  }\n\n  onActivityEdit(key: string, update: ActivityEditorUpdate): void {\n    const model = this.adjustActivityForConstraints(\n      this.state.activityContexts.get(key)?.typeSlug,\n      update.content,\n    );\n    const withModel = {\n      model: update.content,\n      title: update.title,\n      objectives: update.objectives,\n      tags: update.tags,\n    };\n\n    // apply the edit\n    const merged = Object.assign({}, this.state.activityContexts.get(key), withModel);\n\n    const activityContexts = this.state.activityContexts.set(key, merged);\n\n    this.setState({ activityContexts }, () => {\n      const saveFn = (releaseLock: boolean) =>\n        ActivityPersistence.edit(\n          this.props.projectSlug,\n          merged.activityId,\n          merged.activityId,\n          { ...update, content: model },\n          releaseLock,\n        );\n\n      this.persistence.lift((p) => p.save(saveFn));\n    });\n  }\n\n  adjustActivityForConstraints(\n    activityType: string | undefined,\n    model: ActivityModelSchema,\n  ): ActivityModelSchema {\n    if (activityType === 'oli_multi_input') {\n      return guaranteeMultiInputValidity(model as MultiInputSchema);\n    }\n    return model;\n  }\n\n  onPostUndoable(key: string, undoable: ActivityUndoable) {\n    const id = guid();\n    this.setState(\n      {\n        undoables: this.state.undoables.set(id, {\n          guid: id,\n          contentKey: key,\n          undoable,\n        }),\n      },\n      () =>\n        setTimeout(\n          () =>\n            this.setState({\n              undoables: this.state.undoables.delete(id),\n            }),\n          5000,\n        ),\n    );\n  }\n\n  onInvokeUndo(guid: string) {\n    const item = this.state.undoables.get(guid);\n\n    if (item !== undefined) {\n      const context = this.state.activityContexts.get(item.contentKey);\n      if (context !== undefined) {\n        // Perform a deep copy\n        const model = JSON.parse(JSON.stringify(context.model));\n\n        // Apply the undo operations to the model\n        Operations.applyAll(model as any, item.undoable.operations);\n\n        // Now save the change and push it down to the activity editor\n        this.onActivityEdit(item.contentKey, {\n          content: model,\n          title: context.title,\n          objectives: context.objectives,\n          tags: context.tags,\n        });\n      }\n    }\n\n    this.setState({ undoables: this.state.undoables.delete(guid) });\n  }\n\n  createObjectiveErrorMessage(_failure: any) {\n    const message = createMessage({\n      guid: 'objective-error',\n      canUserDismiss: true,\n      content: 'A problem occurred while creating your new objective',\n      severity: Severity.Error,\n    });\n    this.addAsUnique(message);\n  }\n\n  onRegisterNewObjective(objective: Objective) {\n    this.setState({\n      allObjectives: this.state.allObjectives.push(objective),\n    });\n  }\n\n  onRegisterNewTag(tag: Tag) {\n    this.setState({\n      allTags: this.state.allTags.push(tag),\n    });\n  }\n\n  onPageChange(page: BankTypes.Paging) {\n    this.persistence.lift((p) => p.destroy());\n    this.state.editedSlug.lift((slug) => this.onChangeEditing(slug, false));\n    this.setState({ undoables: Immutable.OrderedMap<string, ActivityUndoAction>() });\n    this.fetchActivities(this.state.logic, page);\n  }\n\n  onDelete(key: string) {\n    confirmDelete().then((confirmed) => {\n      if (confirmed) {\n        const context = this.state.activityContexts.get(key);\n        if (context !== undefined) {\n          ActivityPersistence.deleteActivity(this.props.projectSlug, context.activityId).then(\n            (result) => {\n              if (result.result === 'success') {\n                // It deleted, so now we force a refresh to make it go away from the display\n                this.fetchActivities(this.state.logic, this.state.paging);\n                this.setState({ totalInBank: this.state.totalInBank - 1 });\n                this.persistence.lift((current) => current.destroy());\n              }\n            },\n          );\n        }\n      }\n    });\n  }\n\n  onChangeEditing(key: string, editMode: boolean) {\n    if (editMode) {\n      this.persistence.lift((current) => current.destroy());\n      const persistence = new DeferredPersistenceStrategy();\n\n      const lockFn = (): Promise<Lock.LockResult> => {\n        return new Promise((resolve, _reject) => {\n          Lock.acquireLock(this.props.projectSlug, key, true).then((result) => {\n            if (result.type === 'acquired') {\n              // Update our local context given the latest from the server\n              const context = this.state.activityContexts.get(key) as ActivityEditContext;\n              context.model = result.revision.content;\n              context.objectives = result.revision.objectives;\n              context.title = result.revision.title;\n\n              this.setState({\n                activityContexts: this.state.activityContexts.set(key, context),\n                editedSlug: Maybe.just<string>(key),\n              });\n              resolve(result);\n            } else {\n              showFailedToLockMessage();\n              resolve(result);\n            }\n          });\n        });\n      };\n\n      const unlockFn = (): Promise<Lock.LockResult> => {\n        return Lock.releaseLock(this.props.projectSlug, key);\n      };\n\n      persistence.initialize(\n        lockFn,\n        unlockFn,\n        // eslint-disable-next-line\n        () => {},\n        (failure) => this.publishErrorMessage(failure),\n        (persistence) => this.setState({ persistence }),\n      );\n      this.persistence = Maybe.just<PersistenceStrategy>(persistence);\n    } else {\n      this.persistence.lift((current) => current.destroy());\n      this.persistence = Maybe.nothing<PersistenceStrategy>();\n      this.setState({\n        editedSlug: Maybe.nothing<string>(),\n      });\n    }\n  }\n\n  createActivityEditors() {\n    return this.state.activityContexts.toArray().map((item) => {\n      const [key, context] = item;\n      const editMode = this.state.editedSlug.caseOf({\n        just: (slug) => slug === key,\n        nothing: () => false,\n      });\n      const onChangeEditMode = (state: boolean) => {\n        const thisKey = key;\n        this.onChangeEditing(thisKey, state);\n      };\n      const onDelete = () => {\n        const thisKey = key;\n        this.onDelete(thisKey);\n      };\n\n      return (\n        <div key={key} className=\"d-flex justify-content-start\">\n          <div>\n            <EditingLock editMode={editMode} onChangeEditMode={onChangeEditMode} />\n            <DeleteActivity editMode={editMode} onDelete={onDelete} />\n          </div>\n          <InlineActivityEditor\n            key={key}\n            projectSlug={this.props.projectSlug}\n            editMode={editMode}\n            allObjectives={this.state.allObjectives.toArray()}\n            allTags={this.state.allTags.toArray()}\n            onPostUndoable={this.onPostUndoable.bind(this, key)}\n            onEdit={this.onActivityEdit.bind(this, key)}\n            onRegisterNewObjective={this.onRegisterNewObjective}\n            onRegisterNewTag={this.onRegisterNewTag}\n            banked={true}\n            {...context}\n          />\n        </div>\n      );\n    });\n  }\n\n  fetchActivities(logic: BankTypes.Logic, paging: BankTypes.Paging) {\n    BankPersistence.retrieve(this.props.projectSlug, logic, paging).then((result) => {\n      if (result.result === 'success') {\n        const contexts = result.queryResult.rows\n          .map((r) => {\n            const editorDesc = this.editorById[r.activity_type_id];\n\n            return {\n              authoringElement: editorDesc.authoringElement,\n              friendlyName: editorDesc.friendlyName,\n              description: editorDesc.description,\n              typeSlug: editorDesc.slug,\n              activityId: r.resource_id,\n              activitySlug: r.slug,\n              title: r.title,\n              model: r.content,\n              objectives: r.objectives,\n              tags: r.tags,\n            } as ActivityEditContext;\n          })\n          .map((c) => [c.activitySlug, c]);\n\n        this.setState({\n          activityContexts: Immutable.OrderedMap<string, ActivityEditContext>(contexts as any),\n          paging,\n          totalCount: result.queryResult.totalCount,\n        });\n        result.queryResult.rows;\n      }\n    });\n  }\n\n  addAsUnique(message: Message) {\n    const messages = this.state.messages.filter((m) => m.guid !== message.guid);\n    this.setState({ messages: [...messages, message] });\n  }\n\n  render() {\n    const props = this.props;\n\n    const onRegisterNewObjective = (objective: Objective) => {\n      this.setState({\n        allObjectives: this.state.allObjectives.push(objective),\n      });\n    };\n\n    const onRegisterNewTag = (tag: Tag) => {\n      this.setState({\n        allTags: this.state.allTags.push(tag),\n      });\n    };\n\n    const activities = this.createActivityEditors();\n    const pagingOrPlaceholder =\n      this.state.totalCount === 0 ? (\n        'No results'\n      ) : (\n        <Paging\n          totalResults={this.state.totalCount}\n          page={this.state.paging}\n          onPageChange={this.onPageChange}\n        />\n      );\n\n    const overviewLabel = (\n      <h5>{`There ${this.state.totalInBank === 1 ? 'is' : 'are'} ${this.state.totalInBank} ${\n        this.state.totalInBank === 1 ? 'activity' : 'activities'\n      } in this course project's activity bank`}</h5>\n    );\n\n    return (\n      <div className=\"resource-editor row\">\n        <div className=\"col-12\">\n          <UndoToasts undoables={this.state.undoables} onInvokeUndo={this.onInvokeUndo} />\n\n          <Banner\n            dismissMessage={(msg) =>\n              this.setState({ messages: this.state.messages.filter((m) => msg.guid !== m.guid) })\n            }\n            executeAction={(message, action) => action.execute(message)}\n            messages={this.state.messages}\n          />\n          <div className=\"d-flex justify-content-end\">\n            <PersistenceStatus persistence={this.state.persistence} />\n          </div>\n          <div className=\"d-flex justify-content-between\">\n            {overviewLabel}\n            <CreateActivity\n              projectSlug={props.projectSlug}\n              editorMap={props.editorMap}\n              onAdd={this.onActivityAdd}\n            />\n          </div>\n          <hr />\n\n          <LogicFilter\n            expressions={this.state.filterExpressions}\n            editMode={true}\n            allowText={true}\n            projectSlug={props.projectSlug}\n            editorMap={props.editorMap}\n            allObjectives={this.state.allObjectives}\n            allTags={this.state.allTags}\n            onRegisterNewObjective={onRegisterNewObjective}\n            onRegisterNewTag={onRegisterNewTag}\n            onChange={(filterExpressions) => {\n              this.setState({ filterExpressions, canBeUpdated: true });\n            }}\n            onRemove={() => true}\n          />\n\n          <div className=\"d-flex justify-content-end\">\n            <button\n              className=\"btn btn-secondary mr-3\"\n              disabled={isEmptyFilterLogic(this.state.filterExpressions)}\n              onClick={() => {\n                this.setState({ filterExpressions: defaultFilters(), canBeUpdated: true });\n              }}\n            >\n              Clear all\n            </button>\n            <button\n              className=\"btn btn-secondary\"\n              disabled={!this.state.canBeUpdated}\n              onClick={() => {\n                this.setState({ paging: defaultPaging(), canBeUpdated: false });\n                this.fetchActivities(\n                  translateFilterToLogic(this.state.filterExpressions),\n                  defaultPaging(),\n                );\n              }}\n            >\n              Apply Filters\n            </button>\n          </div>\n\n          <hr className=\"mb-4\" />\n\n          {pagingOrPlaceholder}\n\n          {activities}\n\n          {this.state.totalCount > 0 ? pagingOrPlaceholder : null}\n        </div>\n      </div>\n    );\n  }\n}\n\n// eslint-disable-next-line\ninterface StateProps {}\n\ninterface DispatchProps {\n  onLoadPreferences: () => void;\n}\n\ntype OwnProps = {\n  editorMap: ActivityEditorMap;\n  activities: ActivityMap;\n};\n\nconst mapStateToProps = (_state: State, _ownProps: OwnProps): StateProps => {\n  return {};\n};\n\nconst mapDispatchToProps = (dispatch: Dispatch, _ownProps: OwnProps): DispatchProps => {\n  return {\n    onLoadPreferences: () => dispatch(loadPreferences()),\n  };\n};\n\nexport default connect<StateProps, DispatchProps, OwnProps>(\n  mapStateToProps,\n  mapDispatchToProps,\n)(ActivityBank);\n"]}