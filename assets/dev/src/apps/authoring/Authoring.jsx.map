{"version":3,"file":"Authoring.jsx","sourceRoot":"","sources":["../../../../src/apps/authoring/Authoring.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Alert, Button } from 'react-bootstrap';\nimport { Provider, useDispatch, useSelector } from 'react-redux';\nimport { isFirefox } from 'utils/browser';\nimport { BottomPanel } from './BottomPanel';\nimport { AdaptivityEditor } from './components/AdaptivityEditor/AdaptivityEditor';\nimport { InitStateEditor } from './components/AdaptivityEditor/InitStateEditor';\nimport EditingCanvas from './components/EditingCanvas/EditingCanvas';\nimport HeaderNav from './components/HeaderNav';\nimport LeftMenu from './components/LeftMenu/LeftMenu';\nimport DiagnosticsWindow from './components/Modal/DiagnosticsWindow';\nimport RightMenu from './components/RightMenu/RightMenu';\nimport { SidePanel } from './components/SidePanel';\nimport store from './store';\nimport { releaseEditingLock } from './store/app/actions/locking';\nimport { attemptDisableReadOnly } from './store/app/actions/readonly';\nimport {\n  selectBottomPanel,\n  selectCurrentRule,\n  selectHasEditingLock,\n  selectLeftPanel,\n  selectProjectSlug,\n  selectReadOnly,\n  selectRevisionSlug,\n  selectRightPanel,\n  selectShowDiagnosticsWindow,\n  selectTopPanel,\n  setInitialConfig,\n  setPanelState,\n} from './store/app/slice';\nimport { initializeFromContext } from './store/page/actions/initializeFromContext';\nimport { PageContext } from './types';\n\nexport interface AuthoringProps {\n  isAdmin: boolean;\n  projectSlug: string;\n  revisionSlug: string;\n  content: PageContext;\n  activityTypes?: any[];\n  partComponentTypes?: any[];\n  resourceId?: number;\n  paths: Record<string, string>;\n}\n\nconst Authoring: React.FC<AuthoringProps> = (props: AuthoringProps) => {\n  const dispatch = useDispatch();\n\n  const authoringContainer = document.getElementById('advanced-authoring');\n  const [isAppVisible, setIsAppVisible] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const hasEditingLock = useSelector(selectHasEditingLock);\n  const isReadOnly = useSelector(selectReadOnly);\n  const [isReadOnlyWarningDismissed, setIsReadOnlyWarningDismissed] = useState(false);\n  const [isAttemptDisableReadOnlyFailed, setIsAttemptDisableReadOnlyFailed] = useState(false);\n\n  const shouldShowLockError = !hasEditingLock && !isReadOnly;\n  const shouldShowReadOnlyWarning = !isLoading && isReadOnly && !isReadOnlyWarningDismissed;\n  const shouldShowEditor =\n    !isLoading && (hasEditingLock || isReadOnly) && !shouldShowReadOnlyWarning;\n\n  const alertSeverity = isAttemptDisableReadOnlyFailed || shouldShowLockError ? 'warning' : 'info';\n\n  /* console.log('RENDER IT', {\n    shouldShowEditor,\n    shouldShowLockError,\n    shouldShowReadOnlyWarning,\n    isAppVisible,\n    hasEditingLock,\n  }); */\n\n  const showDiagnosticsWindow = useSelector(selectShowDiagnosticsWindow);\n\n  const projectSlug = useSelector(selectProjectSlug);\n  const revisionSlug = useSelector(selectRevisionSlug);\n  const currentRule = useSelector(selectCurrentRule);\n  const leftPanelState = useSelector(selectLeftPanel);\n  const rightPanelState = useSelector(selectRightPanel);\n  const topPanelState = useSelector(selectTopPanel);\n  const bottomPanelState = useSelector(selectBottomPanel);\n\n  const panelState = {\n    left: leftPanelState,\n    right: rightPanelState,\n    top: topPanelState,\n    bottom: bottomPanelState,\n  };\n\n  const url = `/authoring/project/${projectSlug}/preview/${revisionSlug}`;\n  const windowName = `preview-${projectSlug}`;\n\n  const handlePanelStateChange = ({\n    top,\n    right,\n    left,\n    bottom,\n  }: {\n    top?: boolean;\n    right?: boolean;\n    left?: boolean;\n    bottom?: boolean;\n  }) => {\n    dispatch(setPanelState({ top, right, left, bottom }));\n  };\n\n  const dismissReadOnlyWarning = async ({ attemptEdit }: { attemptEdit: boolean }) => {\n    if (attemptEdit) {\n      const attemptResult = await dispatch(attemptDisableReadOnly());\n      if ((attemptResult as any).meta.requestStatus !== 'fulfilled') {\n        const errorCode = (attemptResult as any)?.payload?.error;\n        if (errorCode === 'SESSION_EXPIRED') {\n          window.location.reload();\n        }\n        setIsAttemptDisableReadOnlyFailed(true);\n        return;\n      }\n    }\n    setIsReadOnlyWarningDismissed(true);\n  };\n\n  useEffect(() => {\n    if (isAppVisible) {\n      // forced light mode to save on initial dev time\n      const darkModeCss: any = document.getElementById('authoring-theme-dark');\n      darkModeCss.href = '/css/authoring_torus_light.css';\n      document.body.classList.add('overflow-hidden'); // prevents double scroll bars\n      authoringContainer?.classList.remove('d-none');\n      setTimeout(() => {\n        authoringContainer?.classList.add('startup');\n      }, 50);\n    }\n    if (!isAppVisible) {\n      // reset forced light mode\n      const darkModeCss: any = document.getElementById('authoring-theme-dark');\n      darkModeCss.href = '/css/authoring_torus_dark.css';\n      document.body.classList.remove('overflow-hidden');\n      authoringContainer?.classList.remove('startup');\n      setTimeout(() => {\n        authoringContainer?.classList.add('d-none');\n      }, 350);\n    }\n    return () => {\n      document.body.classList.remove('overflow-hidden');\n    };\n  }, [isAppVisible]);\n\n  useEffect(() => {\n    const appConfig = {\n      paths: props.paths,\n      isAdmin: props.isAdmin,\n      projectSlug: props.projectSlug,\n      revisionSlug: props.revisionSlug,\n      partComponentTypes: props.partComponentTypes,\n      activityTypes: props.activityTypes,\n    };\n    dispatch(setInitialConfig(appConfig));\n  }, [props]);\n\n  useEffect(() => {\n    window.addEventListener('beforeunload', async () =>\n      isFirefox\n        ? setTimeout(async () => {\n            await dispatch(releaseEditingLock());\n          })\n        : await dispatch(releaseEditingLock()),\n    );\n\n    setTimeout(() => {\n      if (hasEditingLock || (isReadOnly && isReadOnlyWarningDismissed)) {\n        if (props.content) {\n          const appConfig = {\n            paths: props.paths,\n            isAdmin: props.isAdmin,\n            projectSlug: props.projectSlug,\n            revisionSlug: props.revisionSlug,\n            partComponentTypes: props.partComponentTypes,\n            activityTypes: props.activityTypes,\n          };\n          dispatch(initializeFromContext({ context: props.content, config: appConfig }));\n        }\n\n        setIsAppVisible(true);\n      }\n    }, 500);\n    setTimeout(() => {\n      setIsLoading(false);\n    }, 2000);\n\n    return () => {\n      window.removeEventListener('beforeunload', async () => await dispatch(releaseEditingLock()));\n    };\n  }, [props, hasEditingLock, isReadOnly, isReadOnlyWarningDismissed]);\n\n  return (\n    <>\n      {isLoading && (\n        <div id=\"aa-loading\">\n          <div className=\"loader spinner-border text-primary\" role=\"status\">\n            <span className=\"sr-only\">Loading...</span>\n          </div>\n        </div>\n      )}\n      {shouldShowEditor && (\n        <div id=\"advanced-authoring\" className={`advanced-authoring d-none`}>\n          <HeaderNav panelState={panelState} isVisible={panelState.top} />\n          <SidePanel\n            position=\"left\"\n            panelState={panelState}\n            onToggle={() => handlePanelStateChange({ left: !panelState.left })}\n          >\n            <LeftMenu />\n          </SidePanel>\n          <EditingCanvas />\n          <BottomPanel\n            panelState={panelState}\n            onToggle={() => handlePanelStateChange({ bottom: !panelState.bottom })}\n          >\n            {currentRule === 'initState' && <InitStateEditor />}\n            {currentRule !== 'initState' && <AdaptivityEditor />}\n          </BottomPanel>\n          <SidePanel\n            position=\"right\"\n            panelState={panelState}\n            onToggle={() => handlePanelStateChange({ right: !panelState.right })}\n          >\n            <RightMenu />\n          </SidePanel>\n        </div>\n      )}\n\n      {shouldShowReadOnlyWarning && (\n        <Alert variant={alertSeverity}>\n          <Alert.Heading>Opening in Read-Only Mode</Alert.Heading>\n          {!isAttemptDisableReadOnlyFailed && (\n            <p>\n              You are about to open this page in read-only mode. You are able to view the contents\n              of this page, but any changes you make will not be saved. You may instead attempt to\n              open in editing mode, or open a preview of the page.\n            </p>\n          )}\n          {isAttemptDisableReadOnlyFailed && (\n            <p>\n              Unfortunately, we were unable to disable read-only mode. Another author currently has\n              the page locked for editing. Please try again later. In the meantime, you may continue\n              in Read Only mode or open a preview of the page.\n            </p>\n          )}\n          <hr />\n          <div style={{ textAlign: 'center' }}>\n            <Button\n              variant={`outline-${alertSeverity}`}\n              className=\"text-dark\"\n              onClick={() => dismissReadOnlyWarning({ attemptEdit: false })}\n            >\n              Continue In Read-Only Mode\n            </Button>{' '}\n            {!isAttemptDisableReadOnlyFailed && (\n              <>\n                <Button\n                  variant={`outline-${alertSeverity}`}\n                  className=\"text-dark\"\n                  onClick={() => dismissReadOnlyWarning({ attemptEdit: true })}\n                >\n                  Open In Edit Mode\n                </Button>{' '}\n              </>\n            )}\n            <Button\n              variant={`outline-${alertSeverity}`}\n              className=\"text-dark\"\n              onClick={() => window.open(url, windowName)}\n            >\n              Open Preview <i className=\"las la-external-link-alt ml-1\"></i>\n            </Button>\n          </div>\n        </Alert>\n      )}\n\n      {showDiagnosticsWindow && <DiagnosticsWindow />}\n    </>\n  );\n};\n\nconst ReduxApp: React.FC<AuthoringProps> = (props) => (\n  <Provider store={store}>\n    <Authoring {...props} />\n  </Provider>\n);\n\nexport default ReduxApp;\n"]}