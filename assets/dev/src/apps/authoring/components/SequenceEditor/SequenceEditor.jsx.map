{"version":3,"file":"SequenceEditor.jsx","sourceRoot":"","sources":["../../../../../../src/apps/authoring/components/SequenceEditor/SequenceEditor.tsx"],"names":[],"mappings":"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","sourcesContent":["import { saveActivity } from 'apps/authoring/store/activities/actions/saveActivity';\nimport React, { useEffect, useState } from 'react';\nimport { Accordion, ListGroup, OverlayTrigger, Tooltip } from 'react-bootstrap';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { clone } from 'utils/common';\nimport guid from 'utils/guid';\nimport { createNew as createNewActivity } from '../../../authoring/store/activities/actions/createNew';\nimport { setCurrentRule, setRightPanelActiveTab } from '../../../authoring/store/app/slice';\nimport {\n  selectAllActivities,\n  selectCurrentActivity,\n  upsertActivity,\n} from '../../../delivery/store/features/activities/slice';\nimport {\n  findInHierarchy,\n  flattenHierarchy,\n  getHierarchy,\n  getSequenceLineage,\n  SequenceEntry,\n  SequenceEntryChild,\n  SequenceEntryType,\n  SequenceHierarchyItem,\n} from '../../../delivery/store/features/groups/actions/sequence';\nimport {\n  selectCurrentSequenceId,\n  selectSequence,\n} from '../../../delivery/store/features/groups/selectors/deck';\nimport { selectCurrentGroup, upsertGroup } from '../../../delivery/store/features/groups/slice';\nimport { addSequenceItem } from '../../store/groups/layouts/deck/actions/addSequenceItem';\nimport { setCurrentActivityFromSequence } from '../../store/groups/layouts/deck/actions/setCurrentActivityFromSequence';\nimport { savePage } from '../../store/page/actions/savePage';\nimport ContextAwareToggle from '../Accordion/ContextAwareToggle';\nimport ConfirmDelete from '../Modal/DeleteConfirmationModal';\nimport { RightPanelTabs } from '../RightMenu/RightMenu';\n\nconst SequenceEditor: React.FC<any> = () => {\n  const dispatch = useDispatch();\n  const currentSequenceId = useSelector(selectCurrentSequenceId);\n  const sequence = useSelector(selectSequence);\n  const currentGroup = useSelector(selectCurrentGroup);\n  const currentActivity = useSelector(selectCurrentActivity);\n  const allActivities = useSelector(selectAllActivities);\n  const [hierarchy, setHierarchy] = useState(getHierarchy(sequence));\n  const [itemToRename, setItemToRename] = useState<any>(undefined);\n  const [showConfirmDelete, setShowConfirmDelete] = useState<boolean>(false);\n  const [itemToDelete, setItemToDelete] = useState<any>(undefined);\n\n  const layerLabel = 'Layer';\n  const bankLabel = 'Question Bank';\n  const screenLabel = 'Screen';\n\n  useEffect(() => {\n    const newHierarchy: SequenceHierarchyItem<SequenceEntryChild>[] = getHierarchy(sequence);\n    return setHierarchy(newHierarchy);\n  }, [sequence]);\n\n  const handleItemClick = (e: any, entry: SequenceEntry<SequenceEntryChild>) => {\n    e.stopPropagation();\n    dispatch(setCurrentActivityFromSequence(entry.custom.sequenceId));\n    dispatch(setRightPanelActiveTab({ rightPanelActiveTab: RightPanelTabs.SCREEN }));\n  };\n\n  const addNewSequence = async (newSequenceEntry: any, siblingId: any) => {\n    await dispatch(\n      addSequenceItem({\n        sequence: sequence,\n        item: newSequenceEntry,\n        group: currentGroup,\n        siblingId: siblingId,\n        // parentId: TODO attach parentId if it exists\n      }),\n    );\n\n    dispatch(setCurrentActivityFromSequence(newSequenceEntry.custom.sequenceId));\n\n    // will write the current groups\n    await dispatch(savePage());\n  };\n  const handleItemAdd = async (\n    parentItem: SequenceEntry<SequenceEntryChild> | undefined,\n    isLayer = false,\n    isBank = false,\n  ) => {\n    let layerRef: string | undefined;\n    if (parentItem) {\n      layerRef = parentItem.custom.sequenceId;\n    }\n    const newSeqType = isLayer ? layerLabel : isBank ? bankLabel : screenLabel;\n    const newTitle = `New ${layerRef ? 'Child' : ''}${newSeqType}`;\n\n    const { payload: newActivity } = await dispatch<any>(\n      createNewActivity({\n        title: newTitle,\n      }),\n    );\n\n    const newSequenceEntry: any = {\n      type: 'activity-reference',\n      resourceId: newActivity.resourceId,\n      activitySlug: newActivity.activitySlug,\n      custom: {\n        isLayer,\n        isBank,\n        layerRef,\n        sequenceId: `${newActivity.activitySlug}_${guid()}`,\n        sequenceName: newTitle,\n      },\n    };\n\n    if (isBank) {\n      newSequenceEntry.custom.bankEndTarget = 'next';\n      newSequenceEntry.custom.bankShowCount = 3;\n    }\n\n    // maybe should set in the create?\n    const reduxActivity = {\n      id: newActivity.resourceId,\n      resourceId: newActivity.resourceId,\n      activitySlug: newActivity.activitySlug,\n      activityType: newActivity.activityType,\n      content: { ...newActivity.model, authoring: undefined },\n      authoring: newActivity.model.authoring,\n    };\n\n    await dispatch(upsertActivity({ activity: reduxActivity }));\n    addNewSequence(newSequenceEntry, currentActivity?.activitySlug);\n  };\n\n  enum ReorderDirection {\n    UP = 0,\n    DOWN,\n    IN,\n    OUT,\n  }\n  const handleItemReorder = async (\n    event: any,\n    item: SequenceHierarchyItem<SequenceEntryType>,\n    direction: ReorderDirection,\n  ) => {\n    let hierarchyCopy = clone(hierarchy);\n    const parentId = item.custom.layerRef;\n    let itemIndex = -1;\n    let parent: any = null;\n    if (parentId) {\n      parent = findInHierarchy(hierarchyCopy, parentId);\n      if (!parent) {\n        console.error('parent not found?');\n        return;\n      }\n      itemIndex = parent.children.findIndex(\n        (child: SequenceHierarchyItem<SequenceEntryType>) =>\n          child.custom.sequenceId === item.custom.sequenceId,\n      );\n    } else {\n      itemIndex = hierarchyCopy.findIndex(\n        (child: SequenceHierarchyItem<SequenceEntryType>) =>\n          child.custom.sequenceId === item.custom.sequenceId,\n      );\n    }\n    const move = (from: number, to: number, arr: SequenceHierarchyItem<SequenceEntryType>[]) => {\n      arr.splice(to, 0, ...arr.splice(from, 1));\n    };\n\n    switch (direction) {\n      case ReorderDirection.UP:\n        {\n          if (parent) {\n            move(itemIndex, itemIndex - 1, parent.children);\n          } else {\n            // if there is no parent, move within hierarchy\n            move(itemIndex, itemIndex - 1, hierarchyCopy);\n          }\n        }\n        break;\n      case ReorderDirection.DOWN:\n        {\n          if (parent) {\n            move(itemIndex, itemIndex + 1, parent.children);\n          } else {\n            // if there is no parent, move within hierarchy\n            move(itemIndex, itemIndex + 1, hierarchyCopy);\n          }\n        }\n        break;\n      case ReorderDirection.IN:\n        {\n          let sibling;\n          if (parent) {\n            sibling = parent.children[itemIndex - 1];\n            parent.children = parent.children.filter(\n              (i: SequenceHierarchyItem<SequenceEntryType>) =>\n                i.custom.sequenceId !== item.custom.sequenceId,\n            );\n          } else {\n            sibling = hierarchyCopy[itemIndex - 1];\n            hierarchyCopy = hierarchyCopy.filter(\n              (i: SequenceHierarchyItem<SequenceEntryType>) =>\n                i.custom.sequenceId !== item.custom.sequenceId,\n            );\n          }\n          if (!sibling) {\n            console.error('no sibling above to move \"in\" to');\n            return;\n          }\n          const itemCopy = clone(item);\n          itemCopy.custom.layerRef = sibling.custom.sequenceId;\n          sibling.children.push(itemCopy);\n        }\n        break;\n      case ReorderDirection.OUT:\n        {\n          if (!parent) {\n            console.error('no parent to move out of');\n            return;\n          }\n          // we want to pull out and become a sibling to the parent\n          parent.children = parent.children.filter(\n            (i: SequenceHierarchyItem<SequenceEntryType>) =>\n              i.custom.sequenceId !== item.custom.sequenceId,\n          );\n          if (parent.custom.layerRef) {\n            const grandparent: any = findInHierarchy(hierarchyCopy, parent.custom.layerRef);\n            if (!grandparent) {\n              console.error('no grandparent found? ' + parent.custom.layerRef);\n              return;\n            }\n            const parentIndex = grandparent.children.findIndex(\n              (i: SequenceHierarchyItem<SequenceEntryType>) =>\n                i.custom.sequenceId === parent.custom.sequenceId,\n            );\n            const itemCopy = clone(item);\n            itemCopy.custom.layerRef = grandparent.custom.sequenceId;\n            grandparent.children.splice(parentIndex + 1, 0, itemCopy);\n          } else {\n            // the parent lives in the root\n            const parentIndex = hierarchyCopy.findIndex(\n              (i: SequenceHierarchyItem<SequenceEntryType>) =>\n                i.custom.sequenceId === parent.custom.sequenceId,\n            );\n            const itemCopy = clone(item);\n            itemCopy.custom.layerRef = '';\n            hierarchyCopy.splice(parentIndex + 1, 0, itemCopy);\n          }\n        }\n        break;\n      default:\n        throw new Error('Uknown reorder direction! ' + direction);\n    }\n    const newSequence = clone(flattenHierarchy(hierarchyCopy));\n    const newGroup = { ...currentGroup, children: newSequence };\n    dispatch(upsertGroup({ group: newGroup }));\n    await dispatch(savePage());\n  };\n\n  const handleItemDelete = async (item: SequenceHierarchyItem<SequenceEntryType>) => {\n    const flatten = (parent: SequenceHierarchyItem<SequenceEntryType>) => {\n      const list = [{ ...parent, children: undefined }];\n      parent.children.forEach((child) => {\n        list.push(...flatten(child));\n      });\n      return list;\n    };\n    const itemsToDelete = flatten(item);\n    const sequenceItems = [...sequence];\n    itemsToDelete.forEach((item: SequenceEntry<SequenceEntryChild>) => {\n      if (item.activitySlug === currentActivity?.activitySlug)\n        dispatch(setCurrentRule({ currentRule: undefined }));\n      const itemIndex = sequenceItems.findIndex(\n        (entry) => entry.custom.sequenceId === item.custom.sequenceId,\n      );\n      if (itemIndex < 0) {\n        console.warn('not found in sequence', item);\n        return;\n      }\n      sequenceItems.splice(itemIndex, 1);\n    });\n    const newGroup = { ...currentGroup, children: sequenceItems };\n    dispatch(upsertGroup({ group: newGroup }));\n    await dispatch(savePage());\n    setShowConfirmDelete(false);\n    setItemToDelete(undefined);\n  };\n\n  const handleItemConvert = async (item: SequenceHierarchyItem<SequenceEntryType>) => {\n    const hierarchyCopy = clone(hierarchy);\n    const itemInHierarchy = findInHierarchy(hierarchyCopy, item.custom.sequenceId);\n    if (itemInHierarchy === undefined) {\n      return console.warn('item not converted', item);\n    }\n    const isLayer = !!itemInHierarchy?.custom.isLayer || false;\n    itemInHierarchy.custom.isLayer = !isLayer;\n    const newSequence = flattenHierarchy(hierarchyCopy);\n    const newGroup = { ...currentGroup, children: newSequence };\n    dispatch(upsertGroup({ group: newGroup }));\n    await dispatch(savePage());\n  };\n\n  const handleItemClone = async (item: SequenceHierarchyItem<SequenceEntryType>) => {\n    const newTitle = `Copy of ${item.custom.sequenceName}`;\n    const { payload: newActivity } = await dispatch<any>(\n      createNewActivity({\n        title: newTitle,\n      }),\n    );\n\n    const newSequenceEntry: any = {\n      type: 'activity-reference',\n      resourceId: newActivity.resourceId,\n      activitySlug: newActivity.activitySlug,\n      custom: {\n        ...item.custom,\n        sequenceId: `${newActivity.activitySlug}_${guid()}`,\n        sequenceName: newTitle,\n      },\n    };\n\n    const selectedActivity = allActivities.find((act) => act.id === item.resourceId);\n    const copiedActivity = clone(selectedActivity);\n    copiedActivity.id = newActivity.resourceId;\n    copiedActivity.resourceId = newActivity.resourceId;\n    copiedActivity.activitySlug = newActivity.activitySlug;\n    copiedActivity.title = newTitle;\n    dispatch(saveActivity({ activity: copiedActivity }));\n    await dispatch(upsertActivity({ activity: copiedActivity }));\n    addNewSequence(newSequenceEntry, item.activitySlug);\n  };\n  const handleRenameItem = async (item: any) => {\n    if (itemToRename.custom.sequenceName.trim() === '') {\n      setItemToRename(undefined);\n      return;\n    }\n    if (itemToRename.custom.sequenceName === item.custom.sequenceName) {\n      setItemToRename(undefined);\n      return;\n    }\n    const hierarchyClone = clone(hierarchy);\n    const activityClone = clone(currentActivity);\n    const itemInHierarchy = findInHierarchy(hierarchyClone, item.custom.sequenceId);\n    if (itemInHierarchy === undefined || activityClone === undefined) {\n      return console.warn('item not renamed', item);\n    }\n    itemInHierarchy.custom.sequenceName = itemToRename.custom.sequenceName;\n    activityClone.title = itemToRename.custom.sequenceName;\n    const newSequence = flattenHierarchy(hierarchyClone);\n    const newGroup = { ...currentGroup, children: newSequence };\n    dispatch(upsertGroup({ group: newGroup }));\n    await dispatch(upsertActivity({ activity: activityClone }));\n    await dispatch(savePage());\n    setItemToRename(undefined);\n  };\n\n  useEffect(() => {\n    if (!itemToRename) return;\n    const inputToFocus = document.getElementById('input-sequence-item-name');\n    if (inputToFocus) inputToFocus.focus();\n  }, [itemToRename]);\n\n  const SequenceItemContextMenu = (props: any) => {\n    const { id, item, index, arr, isParentQB } = props;\n    const isBank = item.custom.isBank;\n    const isLayer = item.custom.isLayer;\n    const seqType = isLayer ? layerLabel : isBank ? bankLabel : screenLabel;\n    return (\n      <div className=\"dropdown aa-sequence-item-context-menu\">\n        {currentGroup && (\n          <>\n            <button\n              className=\"dropdown-toggle aa-context-menu-trigger btn btn-link p-0 px-1\"\n              type=\"button\"\n              id={`sequence-item-${id}-context-trigger`}\n              data-toggle=\"dropdown\"\n              aria-haspopup=\"true\"\n              aria-expanded=\"false\"\n              onClick={(e) => {\n                e.stopPropagation();\n                ($(`#sequence-item-${id}-context-trigger`) as any).dropdown('toggle');\n              }}\n            >\n              <i className=\"fas fa-ellipsis-v\" />\n            </button>\n            <div\n              id={`sequence-item-${id}-context-menu`}\n              className=\"dropdown-menu\"\n              aria-labelledby={`sequence-item-${id}-context-trigger`}\n            >\n              {!isParentQB ? (\n                <button\n                  className=\"dropdown-item\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n                    handleItemAdd(item);\n                  }}\n                >\n                  <i className=\"fas fa-desktop mr-2\" /> Add Subscreen\n                </button>\n              ) : null}\n              {!isBank && !isParentQB ? (\n                <button\n                  className=\"dropdown-item\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n                    handleItemAdd(item, true);\n                  }}\n                >\n                  <i className=\"fas fa-layer-group mr-2\" /> Add Layer\n                </button>\n              ) : null}\n              {!isBank && !isParentQB ? (\n                <button\n                  className=\"dropdown-item\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n                    handleItemAdd(item, false, true);\n                  }}\n                >\n                  <i className=\"fas fa-cubes mr-2\" /> Add Question Bank\n                </button>\n              ) : null}\n              {isLayer ? (\n                <button\n                  className=\"dropdown-item\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n                    handleItemConvert(item);\n                  }}\n                >\n                  <i className=\"fas fa-exchange-alt mr-2\" /> Convert to Screen\n                </button>\n              ) : !isBank && !isParentQB ? (\n                <button\n                  className=\"dropdown-item\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n                    handleItemConvert(item);\n                  }}\n                >\n                  <i className=\"fas fa-exchange-alt mr-2\" /> Convert to Layer\n                </button>\n              ) : null}\n              <button\n                className=\"dropdown-item\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n                  setItemToRename(item);\n                }}\n              >\n                <i className=\"fas fa-i-cursor align-text-top mr-2\" /> Rename\n              </button>\n              {!isLayer && !isBank && (\n                <button\n                  className=\"dropdown-item\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n                    handleItemClone(item);\n                  }}\n                >\n                  <i className=\"fas fa-clone align-text-top mr-2\" /> {'Clone Screen'}\n                </button>\n              )}\n              <button\n                className=\"dropdown-item\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n                  navigator.clipboard.writeText(item.custom.sequenceId);\n                }}\n              >\n                <i className=\"fas fa-clipboard align-text-top mr-2\" /> {`Copy ${seqType} ID`}\n              </button>\n              {currentGroup?.children?.length > 1 && (\n                <>\n                  <div className=\"dropdown-divider\" />\n                  <button\n                    className=\"dropdown-item text-danger\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n                      setShowConfirmDelete(true);\n                      setItemToDelete(item);\n                    }}\n                  >\n                    <i className=\"fas fa-trash mr-2\" /> Delete\n                  </button>\n                  <div className=\"dropdown-divider\"></div>\n                </>\n              )}\n              {index > 0 && (\n                <button\n                  className=\"dropdown-item\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n                    handleItemReorder(e, item, ReorderDirection.UP);\n                  }}\n                >\n                  <i className=\"fas fa-arrow-up mr-2\" /> Move Up\n                </button>\n              )}\n              {index < arr.length - 1 && (\n                <button\n                  className=\"dropdown-item\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n                    handleItemReorder(e, item, ReorderDirection.DOWN);\n                  }}\n                >\n                  <i className=\"fas fa-arrow-down mr-2\" /> Move Down\n                </button>\n              )}\n              {item.custom.layerRef && (\n                <button\n                  className=\"dropdown-item\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n                    handleItemReorder(e, item, ReorderDirection.OUT);\n                  }}\n                >\n                  <i className=\"fas fa-arrow-left mr-2\" /> Move Out\n                </button>\n              )}\n              {index > 0 && arr.length > 1 && (\n                <button\n                  className=\"dropdown-item\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n                    handleItemReorder(e, item, ReorderDirection.IN);\n                  }}\n                >\n                  <i className=\"fas fa-arrow-right mr-2\" /> Move In\n                </button>\n              )}\n              {/* <div className=\"dropdown-divider\"></div>\n          <button\n            className=\"dropdown-item\"\n            onClick={(e) => {\n              e.stopPropagation();\n              ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n            }}\n          >\n            <i className=\"fas fa-copy mr-2\" /> Copy\n          </button>\n          <button\n            className=\"dropdown-item\"\n            onClick={(e) => {\n              e.stopPropagation();\n              ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n            }}\n          >\n            <i className=\"fas fa-paste mr-2\" /> Paste as Child\n          </button>\n          <button\n            className=\"dropdown-item\"\n            onClick={(e) => {\n              e.stopPropagation();\n              ($(`#sequence-item-${id}-context-menu`) as any).dropdown('toggle');\n            }}\n          >\n            <i className=\"fas fa-paste mr-2\" /> Paste as Sibling\n          </button> */}\n            </div>\n          </>\n        )}\n      </div>\n    );\n  };\n\n  useEffect(() => {\n    // make sure that menus are expanded when the sequenceId is selected by any means\n    if (!currentSequenceId) {\n      return;\n    }\n    const lineage = getSequenceLineage(sequence, currentSequenceId);\n    /* console.log('lineage', lineage); */\n    // last one is the current sequence\n    lineage.pop();\n    lineage.reverse().forEach((item) => {\n      const eventName = `toggle_${item.custom.sequenceId}`;\n      document.dispatchEvent(new CustomEvent(eventName, { detail: 'expand' }));\n    });\n  }, [currentSequenceId, sequence]);\n\n  const getHierarchyList = (items: any, isParentQB = false) =>\n    items.map(\n      (\n        item: SequenceHierarchyItem<SequenceEntryType>,\n        index: number,\n        arr: SequenceHierarchyItem<SequenceEntryType>,\n      ) => {\n        const title = item.custom?.sequenceName || item.activitySlug;\n        return (\n          <Accordion key={`${index}`}>\n            <ListGroup.Item\n              as=\"li\"\n              className={`aa-sequence-item${item.children.length ? ' is-parent' : ''}`}\n              key={`${item.custom.sequenceId}`}\n              active={item.custom.sequenceId === currentSequenceId}\n              onClick={(e) => handleItemClick(e, item)}\n              tabIndex={0}\n            >\n              <div className=\"aa-sequence-details-wrapper\">\n                <div className=\"details\">\n                  {item.children.length ? (\n                    <ContextAwareToggle\n                      eventKey={`toggle_${item.custom.sequenceId}`}\n                      className={`aa-sequence-item-toggle`}\n                    />\n                  ) : null}\n                  {!itemToRename ? (\n                    <span className=\"title\" title={item.custom.sequenceId}>\n                      {title}\n                    </span>\n                  ) : itemToRename.custom.sequenceId !== item.custom.sequenceId ? (\n                    <span className=\"title\">{title}</span>\n                  ) : null}\n                  {itemToRename && itemToRename?.custom.sequenceId === item.custom.sequenceId && (\n                    <input\n                      id=\"input-sequence-item-name\"\n                      className=\"form-control form-control-sm\"\n                      type=\"text\"\n                      placeholder={item.custom.isLayer ? 'Layer name' : 'Screen name'}\n                      value={itemToRename.custom.sequenceName}\n                      onClick={(e) => e.preventDefault()}\n                      onChange={(e) =>\n                        setItemToRename({\n                          ...itemToRename,\n                          custom: { ...itemToRename.custom, sequenceName: e.target.value },\n                        })\n                      }\n                      onFocus={(e) => e.target.select()}\n                      onBlur={() => handleRenameItem(item)}\n                      onKeyDown={(e) => {\n                        if (e.key === 'Enter') handleRenameItem(item);\n                        if (e.key === 'Escape') setItemToRename(undefined);\n                      }}\n                    />\n                  )}\n                  {item.custom.isLayer && (\n                    <i className=\"fas fa-layer-group ml-2 align-middle aa-isLayer\" />\n                  )}\n                  {item.custom.isBank && (\n                    <i className=\"fas fa-cubes ml-2 align-middle aa-isLayer\" />\n                  )}\n                </div>\n                <SequenceItemContextMenu\n                  id={item.activitySlug}\n                  item={item}\n                  index={index}\n                  arr={arr}\n                  isParentQB={isParentQB}\n                />\n              </div>\n              {item.children.length ? (\n                <Accordion.Collapse eventKey={`toggle_${item.custom.sequenceId}`}>\n                  <ListGroup as=\"ol\" className=\"aa-sequence nested\">\n                    {getHierarchyList(item.children, item.custom.isBank)}\n                  </ListGroup>\n                </Accordion.Collapse>\n              ) : null}\n            </ListGroup.Item>\n          </Accordion>\n        );\n      },\n    );\n\n  return (\n    <Accordion className=\"aa-sequence-editor\" defaultActiveKey=\"0\">\n      <div className=\"aa-panel-section-title-bar\">\n        <div className=\"d-flex align-items-center\">\n          <ContextAwareToggle eventKey=\"0\" />\n          <span className=\"title\">Sequence Editor</span>\n        </div>\n        <OverlayTrigger\n          placement=\"right\"\n          delay={{ show: 150, hide: 150 }}\n          overlay={\n            <Tooltip id=\"button-tooltip\" style={{ fontSize: '12px' }}>\n              New Sequence\n            </Tooltip>\n          }\n        >\n          <div className=\"dropdown\">\n            <button\n              className=\"dropdown-toggle btn btn-link p-0\"\n              type=\"button\"\n              id=\"sequence-add\"\n              data-toggle=\"dropdown\"\n              aria-haspopup=\"true\"\n              aria-expanded=\"false\"\n            >\n              <i className=\"fa fa-plus\" />\n            </button>\n            <div\n              id=\"sequence-add-contextMenu\"\n              className=\"dropdown-menu\"\n              aria-labelledby=\"sequence-add-contextMenu\"\n            >\n              <button\n                className=\"dropdown-item\"\n                onClick={() => {\n                  handleItemAdd(undefined);\n                }}\n              >\n                <i className=\"fas fa-desktop mr-2\" /> Screen\n              </button>\n              <button\n                className=\"dropdown-item\"\n                onClick={() => {\n                  handleItemAdd(undefined, true);\n                }}\n              >\n                <i className=\"fas fa-layer-group mr-2\" /> Layer\n              </button>\n              <button\n                className=\"dropdown-item\"\n                onClick={() => {\n                  handleItemAdd(undefined, false, true);\n                }}\n              >\n                <i className=\"fas fa-cubes mr-2\" /> Question Bank\n              </button>\n            </div>\n          </div>\n        </OverlayTrigger>\n      </div>\n      <Accordion.Collapse eventKey=\"0\">\n        <ListGroup as=\"ol\" className=\"aa-sequence\">\n          {getHierarchyList(hierarchy)}\n        </ListGroup>\n      </Accordion.Collapse>\n      {showConfirmDelete && (\n        <ConfirmDelete\n          show={showConfirmDelete}\n          elementType={\n            itemToDelete.custom?.isLayer\n              ? 'Layer'\n              : itemToDelete.custom?.isBank\n              ? 'Question Bank'\n              : 'Screen'\n          }\n          elementName={itemToDelete.custom?.sequenceName}\n          deleteHandler={() => handleItemDelete(itemToDelete)}\n          cancelHandler={() => {\n            setShowConfirmDelete(false);\n            setItemToDelete(undefined);\n          }}\n        />\n      )}\n    </Accordion>\n  );\n};\n\nexport default SequenceEditor;\n"]}