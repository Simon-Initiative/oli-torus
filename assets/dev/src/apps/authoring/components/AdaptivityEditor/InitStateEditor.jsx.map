{"version":3,"file":"InitStateEditor.jsx","sourceRoot":"","sources":["../../../../../../src/apps/authoring/components/AdaptivityEditor/InitStateEditor.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { OverlayTrigger, Tooltip } from 'react-bootstrap';\nimport debounce from 'lodash/debounce';\nimport { clone } from 'utils/common';\nimport guid from 'utils/guid';\nimport { saveActivity } from '../../../authoring/store/activities/actions/saveActivity';\nimport { selectCurrentActivity } from '../../../delivery/store/features/activities/slice';\nimport { getIsBank, getIsLayer } from '../../../delivery/store/features/groups/actions/sequence';\nimport { OverlayPlacements, VariablePicker } from './VariablePicker';\nimport { CapiVariableTypes } from '../../../../adaptivity/capi';\nimport {\n  ActionOperatorOption,\n  actionOperatorOptions,\n  TypeOption,\n  typeOptions,\n} from './AdaptiveItemOptions';\nimport ConfirmDelete from '../Modal/DeleteConfirmationModal';\n\nexport interface InitStateEditorProps {\n  content?: Record<string, unknown>;\n}\n\nexport interface InitialState {\n  id: string;\n  operator: string;\n  target: string;\n  type: number;\n  value: string;\n}\n\ninterface InitStateItemProps {\n  state: InitialState;\n  onChange: (id: string, key: string, value: string) => void;\n  onDelete: (id: string) => void;\n}\nconst InitStateItem: React.FC<InitStateItemProps> = ({ state, onChange, onDelete }) => {\n  const targetRef = useRef<HTMLInputElement>(null);\n  const typeRef = useRef<HTMLSelectElement>(null);\n  const [showConfirmDelete, setShowConfirmDelete] = useState<boolean>(false);\n\n  // update adding operator if targetType changes from number\n  useEffect(() => {\n    if (state.type !== CapiVariableTypes.NUMBER) {\n      if (state.operator === 'adding') {\n        onChange(state.id, 'operator', '=');\n      }\n    }\n  }, [state.type]);\n\n  return (\n    <div\n      key={state.id}\n      className=\"aa-action aa-mutate d-flex mb-2 form-inline align-items-center flex-nowrap\"\n    >\n      <div className=\"input-group input-group-sm flex-grow-1\">\n        <div className=\"input-group-prepend\" title=\"Target\">\n          <VariablePicker\n            targetRef={targetRef}\n            typeRef={typeRef}\n            placement={OverlayPlacements.TOP}\n            context=\"init\"\n          />\n        </div>\n        <label className=\"sr-only\" htmlFor={`target-${state.id}`}>\n          target\n        </label>\n        <input\n          key={`target-${state.id}`}\n          id={`target-${state.id}`}\n          className=\"form-control form-control-sm flex-grow-1 mr-2\"\n          type=\"text\"\n          placeholder=\"Target\"\n          defaultValue={state.target}\n          onBlur={(e) => onChange(state.id, 'target', e.target.value)}\n          title={state.target}\n          tabIndex={0}\n          ref={targetRef}\n        />\n      </div>\n\n      <label className=\"sr-only\" htmlFor={`operator-${state.id}`}>\n        type\n      </label>\n      <select\n        key={`type-${state.id}`}\n        className=\"custom-select mr-2 form-control form-control-sm\"\n        id={`type-${state.id}`}\n        value={state.type}\n        onChange={(e) => onChange(state.id, 'type', e.target.value)}\n        title=\"Type\"\n        tabIndex={0}\n        ref={typeRef}\n      >\n        {typeOptions.map((option: TypeOption, index: number) => (\n          <option key={`option${index}-${state.id}`} value={option.value}>\n            {option.text}\n          </option>\n        ))}\n      </select>\n      <label className=\"sr-only\" htmlFor={`operator-${state.id}`}>\n        operator\n      </label>\n      <select\n        key={`operator-${state.id}`}\n        className=\"custom-select mr-2 form-control form-control-sm\"\n        id={`operator-${state.id}`}\n        value={state.operator}\n        onChange={(e) => onChange(state.id, 'operator', e.target.value)}\n        title=\"Operator\"\n        tabIndex={0}\n      >\n        {actionOperatorOptions\n          .filter((option: ActionOperatorOption) => {\n            if (state.type !== CapiVariableTypes.NUMBER) {\n              return option.key !== 'add';\n            }\n            return true;\n          })\n          .map((option: ActionOperatorOption, index: number) => (\n            <option key={`option${index}-${state.id}`} value={option.value}>\n              {option.text}\n            </option>\n          ))}\n      </select>\n      <div className=\"input-group input-group-sm flex-grow-1\">\n        <div className=\"input-group-prepend\" title=\"Value\">\n          <div className=\"input-group-text\">\n            <i className=\"fa fa-flag-checkered\" />\n          </div>\n        </div>\n        <label className=\"sr-only\" htmlFor={`value-${state.id}`}>\n          value\n        </label>\n        <input\n          type=\"text\"\n          className=\"form-control form-control-sm flex-grow-1\"\n          key={`value-${state.id}`}\n          id={`value-${state.id}`}\n          defaultValue={state.value}\n          placeholder=\"Value\"\n          onBlur={(e) => onChange(state.id, 'value', e.target.value)}\n          title={state.value}\n          tabIndex={0}\n        />\n      </div>\n      <OverlayTrigger\n        placement=\"top\"\n        delay={{ show: 150, hide: 150 }}\n        overlay={\n          <Tooltip id=\"button-tooltip\" style={{ fontSize: '12px' }}>\n            Delete State\n          </Tooltip>\n        }\n      >\n        <span>\n          <button className=\"btn btn-link p-0 ml-1\" onClick={() => setShowConfirmDelete(true)}>\n            <i className=\"fa fa-trash-alt\" />\n          </button>\n        </span>\n      </OverlayTrigger>\n      {showConfirmDelete && (\n        <ConfirmDelete\n          show={showConfirmDelete}\n          elementType=\"Initial State\"\n          elementName=\"this initial state rule\"\n          deleteHandler={() => {\n            onDelete(state.id);\n            setShowConfirmDelete(false);\n          }}\n          cancelHandler={() => {\n            setShowConfirmDelete(false);\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport const InitStateEditor: React.FC<InitStateEditorProps> = () => {\n  const dispatch = useDispatch();\n  const currentActivity = useSelector(selectCurrentActivity);\n  const [initState, setInitState] = useState([]);\n  const [isDirty, setIsDirty] = useState(false);\n\n  const isLayer = getIsLayer();\n  const isBank = getIsBank();\n\n  useEffect(() => {\n    if (currentActivity === undefined) return;\n    setInitState(currentActivity?.content?.custom?.facts);\n  }, [currentActivity]);\n\n  useEffect(() => {\n    if (!isDirty) {\n      return;\n    }\n    const activityClone = clone(currentActivity);\n    const initStateClone = clone(initState);\n    activityClone.content.custom.facts = initStateClone;\n    dispatch(saveActivity({ activity: activityClone }));\n    setIsDirty(false);\n  }, [isDirty]);\n\n  const notifyTime = 250;\n  const debounceSaveChanges = useCallback(\n    debounce(\n      () => {\n        setIsDirty(true);\n      },\n      notifyTime,\n      { leading: false },\n    ),\n    [],\n  );\n\n  const handleAdd = () => {\n    const tempRules = clone(initState);\n    const tempRule = {\n      id: `is:${guid()}`,\n      target: 'stage.',\n      value: '',\n      type: typeOptions[0].value,\n      operator: actionOperatorOptions[0].value,\n    };\n    tempRules.push(tempRule);\n    setInitState(tempRules);\n  };\n\n  const handleDelete = (id: string) => {\n    const initStateClone = clone(initState);\n    const indexToDelete = initStateClone.findIndex((rule: InitialState) => rule.id === id);\n    initStateClone.splice(indexToDelete, 1);\n    setInitState(initStateClone);\n    debounceSaveChanges();\n  };\n\n  const handleChange = (id: string, key: string, value: string) => {\n    if (value.trim() === '') return;\n    const initStateClone = clone(initState);\n    const indexToUpdate = initStateClone.findIndex((rule: InitialState) => rule.id === id);\n    if (initStateClone[indexToUpdate][key] === value) return;\n    if (key == 'type') {\n      initStateClone[indexToUpdate][key] = parseInt(value);\n    } else {\n      initStateClone[indexToUpdate][key] = value;\n    }\n    setInitState(initStateClone);\n    debounceSaveChanges();\n  };\n\n  return (\n    <div className=\"aa-initState-editor\">\n      {(isLayer || isBank) && (\n        <div className=\"text-center border rounded\">\n          <div className=\"card-body\">\n            {`This sequence item is a ${\n              isLayer ? 'layer' : 'question bank'\n            } and does not support adaptivity`}\n          </div>\n        </div>\n      )}\n      {!isLayer && !isBank && (\n        <div className=\"d-flex w-100\">\n          <OverlayTrigger\n            placement=\"top\"\n            delay={{ show: 150, hide: 150 }}\n            overlay={\n              <Tooltip id=\"button-tooltip\" style={{ fontSize: '12px' }}>\n                New State\n              </Tooltip>\n            }\n          >\n            <button\n              className=\"aa-add-button btn btn-primary btn-sm mr-3\"\n              type=\"button\"\n              onClick={() => handleAdd()}\n            >\n              <i className=\"fa fa-plus\" />\n            </button>\n          </OverlayTrigger>\n          {initState.length === 0 && (\n            <div className=\"d-flex flex-column w-100 border rounded p-2\">\n              <div className=\"text-center\">Initial State is currently empty.</div>\n            </div>\n          )}\n          {initState.length > 0 && (\n            <div className=\"w-100\">\n              {initState.map((state: InitialState, index: number) => (\n                <InitStateItem\n                  key={index}\n                  state={state}\n                  onChange={handleChange}\n                  onDelete={handleDelete}\n                />\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n"]}