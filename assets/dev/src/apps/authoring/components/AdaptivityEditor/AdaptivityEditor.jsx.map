{"version":3,"file":"AdaptivityEditor.jsx","sourceRoot":"","sources":["../../../../../../src/apps/authoring/components/AdaptivityEditor/AdaptivityEditor.tsx"],"names":[],"mappings":";;;;;;;;;AAAA,OAAO,EAAE,oCAAoC,EAAE,MAAM,yBAAyB,CAAC;AAC/E,OAAO,EAAE,cAAc,EAAE,MAAM,oDAAoD,CAAC;AACpF,OAAO,QAAQ,MAAM,iBAAiB,CAAC;AACvC,OAAO,OAAO,MAAM,gBAAgB,CAAC;AACrC,OAAO,KAAK,EAAE,EAAE,WAAW,EAAE,SAAS,EAAE,QAAQ,EAAE,MAAM,OAAO,CAAC;AAChE,OAAO,EAAE,cAAc,EAAE,OAAO,EAAE,MAAM,iBAAiB,CAAC;AAC1D,OAAO,EAAE,WAAW,EAAE,WAAW,EAAE,MAAM,aAAa,CAAC;AACvD,OAAO,EAAE,KAAK,EAAE,MAAM,cAAc,CAAC;AACrC,OAAO,EAAE,iBAAiB,EAAE,MAAM,6BAA6B,CAAC;AAChE,OAAO,EAAE,YAAY,EAAE,MAAM,0DAA0D,CAAC;AACxF,OAAO,EAAE,iBAAiB,EAAE,MAAM,oCAAoC,CAAC;AACvE,OAAO,EAAE,qBAAqB,EAAE,MAAM,mDAAmD,CAAC;AAC1F,OAAO,EACL,cAAc,EACd,SAAS,EACT,UAAU,GACX,MAAM,0DAA0D,CAAC;AAClE,OAAO,EAAE,cAAc,EAAE,MAAM,+CAA+C,CAAC;AAC/E,OAAO,oBAAoB,MAAM,wBAAwB,CAAC;AAC1D,OAAO,kBAAkB,MAAM,sBAAsB,CAAC;AACtD,OAAO,sBAAsB,MAAM,0BAA0B,CAAC;AAC9D,OAAO,qBAAqB,MAAM,yBAAyB,CAAC;AAQ5D,MAAM,CAAC,MAAM,gBAAgB,GAAoC,GAAG,EAAE;;IACpE,MAAM,QAAQ,GAAG,WAAW,EAAE,CAAC;IAC/B,MAAM,WAAW,GAAG,WAAW,CAAC,iBAAiB,CAAC,CAAC;IACnD,MAAM,eAAe,GAAG,WAAW,CAAC,qBAAqB,CAAC,CAAC;IAC3D,MAAM,QAAQ,GAAG,WAAW,CAAC,cAAc,CAAC,CAAC;IAC7C,MAAM,OAAO,GAAG,UAAU,EAAE,CAAC;IAC7B,MAAM,MAAM,GAAG,SAAS,EAAE,CAAC;IAC3B,IAAI,iBAAiB,GAAG,EAAE,CAAC;IAC3B,IAAI,OAAO,EAAE;QACX,iBAAiB,GAAG,OAAO,CAAC;KAC7B;SAAM,IAAI,MAAM,EAAE;QACjB,iBAAiB,GAAG,eAAe,CAAC;KACrC;IAED,MAAM,CAAC,OAAO,EAAE,UAAU,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC;IAC9C,MAAM,CAAC,UAAU,EAAE,aAAa,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAA,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,QAAQ,CAAA,CAAC,CAAC;IACtE,MAAM,CAAC,OAAO,EAAE,UAAU,CAAC,GAAG,QAAQ,CAAC,CAAA,MAAA,MAAA,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,KAAK,0CAAE,MAAM,0CAAE,OAAO,KAAI,EAAE,CAAC,CAAC;IAClF,MAAM,CAAC,UAAU,EAAE,aAAa,CAAC,GAAG,QAAQ,CAC1C,CAAA,MAAA,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,UAAU,0CAAE,GAAG,MAAI,MAAA,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,UAAU,0CAAE,GAAG,CAAA,IAAI,EAAE,CACnE,CAAC;IACF,MAAM,CAAC,kBAAkB,EAAE,qBAAqB,CAAC,GAAG,QAAQ,CAC1D,CAAC,CAAC,CAAA,MAAA,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,UAAU,0CAAE,GAAG,CAAA,CAC/B,CAAC;IACF,MAAM,WAAW,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,MAAW,EAAE,EAAE,CAAC,MAAM,CAAC,IAAI,KAAK,UAAU,CAAC,CAAC;IAC9E,MAAM,aAAa,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,MAAW,EAAE,EAAE,CAAC,MAAM,CAAC,IAAI,KAAK,YAAY,CAAC,CAAC;IAElF,SAAS,CAAC,GAAG,EAAE;;QACb,IAAI,CAAC,WAAW;YAAE,OAAO;QACzB,aAAa,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;QACpC,UAAU,CAAC,CAAA,MAAA,MAAA,WAAW,CAAC,KAAK,0CAAE,MAAM,0CAAE,OAAO,KAAI,EAAE,CAAC,CAAC;QACrD,aAAa,CAAC,CAAA,MAAA,WAAW,CAAC,UAAU,0CAAE,GAAG,MAAI,MAAA,WAAW,CAAC,UAAU,0CAAE,GAAG,CAAA,IAAI,EAAE,CAAC,CAAC;QAChF,qBAAqB,CAAC,CAAC,CAAC,CAAA,MAAA,WAAW,CAAC,UAAU,0CAAE,GAAG,CAAA,CAAC,CAAC;IACvD,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC;IAElB,SAAS,CAAC,GAAG,EAAE;QACb,IAAI,CAAC,OAAO,EAAE;YACZ,OAAO;SACR;QACD,MAAM,WAAW,GAAG;YAClB,EAAE,EAAE,WAAW,CAAC,EAAE;YAClB,IAAI,EAAE,WAAW,CAAC,IAAI;YACtB,eAAe,EAAE,WAAW,CAAC,eAAe,IAAI,CAAC;YACjD,QAAQ,EAAE,WAAW,CAAC,QAAQ,IAAI,CAAC;YACnC,aAAa,EAAE,CAAC,CAAC,WAAW,CAAC,aAAa;YAC1C,OAAO,EAAE,WAAW,CAAC,OAAO;YAC5B,OAAO,EAAE,WAAW,CAAC,OAAO;YAC5B,QAAQ,EAAE,WAAW,CAAC,QAAQ;YAC9B,UAAU,EAAE;gBACV,CAAC,kBAAkB,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,UAAU;aACjD;YACD,KAAK,kCACA,WAAW,CAAC,KAAK,KACpB,IAAI,EAAE,WAAW,CAAC,KAAK,CAAC,IAAI,IAAI,GAAG,WAAW,CAAC,EAAE,IAAI,WAAW,CAAC,IAAI,EAAE,EACvE,MAAM,EAAE;oBACN,OAAO;iBACR,GACF;SACF,CAAC;QACF,UAAU,CAAC,KAAK,CAAC,CAAC;QAClB,gBAAgB,CAAC,WAAW,CAAC,CAAC;IAChC,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC;IAEd,MAAM,gBAAgB,GAAG,CAAC,IAAS,EAAE,EAAE;QACrC,MAAM,QAAQ,GAAG,eAAe,aAAf,eAAe,uBAAf,eAAe,CAAE,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAM,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,IAAI,CAAC,EAAE,CAAC,CAAC;QACrF,MAAM,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAC/D;;;;cAIM;QACN,IAAI,CAAC,QAAQ,EAAE;YACb,OAAO,CAAC,IAAI,CAAC,qCAAqC,CAAC,CAAC;YACpD,OAAO;SACR;QACD,IAAI,IAAI,EAAE;YACR,MAAM,aAAa,GAAG,KAAK,CAAC,eAAe,CAAC,CAAC;YAC7C,MAAM,UAAU,GAAG,CAAC,GAAG,eAAe,aAAf,eAAe,uBAAf,eAAe,CAAE,SAAS,CAAC,KAAK,CAAC,CAAC;YACzD,UAAU,CAAC,eAAe,aAAf,eAAe,uBAAf,eAAe,CAAE,SAAS,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC;YACtE,aAAa,CAAC,SAAS,CAAC,KAAK,GAAG,UAAU,CAAC;YAC3C,oGAAoG;YACpG,8GAA8G;YAC9G,MAAM,aAAa,GAAG,oCAAoC,CACxD,IAAI,CAAC,UAAU,CAAC,GAAG,IAAI,IAAI,CAAC,UAAU,CAAC,GAAG,CAC3C,CAAC;YACF,IAAI,aAAa,CAAC,MAAM,GAAG,CAAC,EAAE;gBAC5B,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,+BAA+B,EAAE;oBAC5D,aAAa,CAAC,SAAS,CAAC,+BAA+B,GAAG,EAAE,CAAC;iBAC9D;gBACD,yEAAyE;gBACzE,MAAM,WAAW,GAAG,aAAa;qBAC9B,GAAG,CAAC,CAAC,YAAiB,EAAE,EAAE;oBACzB,MAAM,YAAY,GAAG,cAAc,CAAC,QAAQ,EAAE,YAAY,CAAC,CAAC;oBAC5D,IAAI,YAAY,EAAE;wBAChB,OAAO,YAAY,CAAC,UAAU,CAAC;qBAChC;yBAAM;wBACL,OAAO,CAAC,IAAI,CACV,yDAAyD,YAAY,cAAc,EACnF,QAAQ,CACT,CAAC;qBACH;gBACH,CAAC,CAAC;qBACD,MAAM,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAa,CAAC;gBAClC,MAAM,OAAO,GAAG,aAAa,CAAC,SAAS,CAAC,+BAA+B,CAAC;gBACxE,aAAa,CAAC,SAAS,CAAC,+BAA+B,GAAG,KAAK,CAAC,IAAI,CAClE,IAAI,GAAG,CAAC,CAAC,GAAG,OAAO,EAAE,GAAG,WAAW,CAAC,CAAC,CACtC,CAAC;gBACF;;;sBAGM;aACP;YACD,QAAQ,CAAC,YAAY,CAAC,EAAE,QAAQ,EAAE,aAAa,EAAE,CAAC,CAAC,CAAC;SACrD;IACH,CAAC,CAAC;IAEF,MAAM,UAAU,GAAG,GAAG,CAAC;IACvB,MAAM,qBAAqB,GAAG,WAAW,CACvC,QAAQ,CACN,GAAG,EAAE;QACH,UAAU,CAAC,IAAI,CAAC,CAAC;IACnB,CAAC,EACD,UAAU,EACV,EAAE,OAAO,EAAE,KAAK,EAAE,CACnB,EACD,EAAE,CACH,CAAC;IAEF,MAAM,4BAA4B,GAAG,CAAC,sBAA2B,EAAE,EAAE;QACnE,4DAA4D;QAC5D,MAAM,KAAK,GAAG,sBAAsB,CAAC,GAAG,IAAI,sBAAsB,CAAC,GAAG,IAAI,EAAE,CAAC;QAC7E,MAAM,YAAY,GAAG,CAAC,CAAC,sBAAsB,CAAC,GAAG,CAAC;QAClD,MAAM,WAAW,GAAG,YAAY,KAAK,kBAAkB,CAAC;QACxD,MAAM,YAAY,GAAG,CAAC,OAAO,CAAC,UAAU,EAAE,KAAK,CAAC,CAAC;QAEjD,IAAI,CAAC,WAAW,IAAI,CAAC,YAAY,EAAE;YACjC,kBAAkB;YAClB,OAAO;SACR;QAED,qBAAqB,CAAC,YAAY,CAAC,CAAC;QACpC,aAAa,CAAC,KAAK,CAAC,CAAC;QACrB,qBAAqB,EAAE,CAAC;IAC1B,CAAC,CAAC;IACF,MAAM,eAAe,GAAG,CAAC,MAAW,EAAE,KAAa,EAAE,EAAE;QACrD,QAAQ,MAAM,CAAC,IAAkB,EAAE;YACjC,KAAK,UAAU;gBACb,OAAO,CACL,CAAC,oBAAoB,CACnB,GAAG,CAAC,CAAC,KAAK,CAAC,CACX,MAAM,CAAC,CAAC,MAAM,CAAC,CACf,QAAQ,CAAC,CAAC,CAAC,OAAY,EAAE,EAAE;wBACzB,kBAAkB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;oBACtC,CAAC,CAAC,CACF,QAAQ,CAAC,CAAC,kBAAkB,CAAC,EAC7B,CACH,CAAC;YACJ,KAAK,YAAY;gBACf,OAAO,CACL,CAAC,sBAAsB,CACrB,GAAG,CAAC,CAAC,KAAK,CAAC,CACX,MAAM,CAAC,CAAC,MAAM,CAAC,CACf,QAAQ,CAAC,CAAC,CAAC,OAAY,EAAE,EAAE;wBACzB,kBAAkB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;oBACtC,CAAC,CAAC,CACF,WAAW,CAAC,CAAC,CAAC,WAAW,CAAC,OAAO,CAAC,CAClC,QAAQ,CAAC,CAAC,kBAAkB,CAAC,EAC7B,CACH,CAAC;YACJ,KAAK,aAAa;gBAChB,OAAO,CACL,CAAC,kBAAkB,CACjB,GAAG,CAAC,CAAC,KAAK,CAAC,CACX,MAAM,CAAC,CAAC,MAAM,CAAC,CACf,QAAQ,CAAC,CAAC,CAAC,OAAY,EAAE,EAAE;wBACzB,kBAAkB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;oBACtC,CAAC,CAAC,CACF,QAAQ,CAAC,CAAC,kBAAkB,CAAC,EAC7B,CACH,CAAC;SACL;IACH,CAAC,CAAC;IAEF,MAAM,eAAe,GAAG,CAAO,UAAsB,EAAE,EAAE;QACvD,IAAI,SAAS,CAAC;QACd,QAAQ,UAAU,EAAE;YAClB,KAAK,UAAU;gBACb,MAAM,MAAM,GAAG,MAAM,QAAQ,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC,CAAC;gBAClD,SAAS,GAAI,MAAc,CAAC,OAAO,CAAC;gBACpC,MAAM;YACR,KAAK,YAAY;gBACf,SAAS,GAAG;oBACV,IAAI,EAAE,YAAY;oBAClB,MAAM,EAAE;wBACN,MAAM,EAAE,MAAM;qBACf;iBACF,CAAC;gBACF,MAAM;YACR,KAAK,aAAa;gBAChB,SAAS,GAAG;oBACV,IAAI,EAAE,aAAa;oBACnB,MAAM,EAAE;wBACN,QAAQ,EAAE,GAAG;wBACb,MAAM,EAAE,QAAQ;wBAChB,UAAU,EAAE,iBAAiB,CAAC,MAAM;wBACpC,KAAK,EAAE,SAAS;qBACjB;iBACF,CAAC;gBACF,MAAM;SACT;QACD,IAAI,SAAS,EAAE;YACb,UAAU,CAAC,CAAC,GAAG,OAAO,EAAE,SAAS,CAAC,CAAC,CAAC;YACpC,qBAAqB,EAAE,CAAC;SACzB;IACH,CAAC,CAAA,CAAC;IAEF,MAAM,kBAAkB,GAAG,CAAO,MAAW,EAAE,OAAY,EAAE,EAAE;QAC7D,MAAM,OAAO,mCAAQ,MAAM,KAAE,MAAM,kCAAO,MAAM,CAAC,MAAM,GAAK,OAAO,IAAI,CAAC;QACxE,MAAM,WAAW,GAAG,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QAC5C,sEAAsE;QACtE,IAAI,WAAW,KAAK,CAAC,CAAC,EAAE;YACtB,MAAM,YAAY,GAAG,CAAC,GAAG,OAAO,CAAC,CAAC;YAClC,YAAY,CAAC,WAAW,CAAC,GAAG,OAAO,CAAC;YACpC,UAAU,CAAC,YAAY,CAAC,CAAC;YACzB,qBAAqB,EAAE,CAAC;SACzB;IACH,CAAC,CAAA,CAAC;IAEF,MAAM,kBAAkB,GAAG,CAAO,MAAW,EAAE,EAAE;QAC/C,gDAAgD;QAChD,MAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC,CAAM,EAAE,EAAE,CAAC,CAAC,KAAK,MAAM,CAAC,CAAC;QACtD,UAAU,CAAC,IAAI,CAAC,CAAC;QACjB,qBAAqB,EAAE,CAAC;IAC1B,CAAC,CAAA,CAAC;IAEF,OAAO,CACL,CAAC,GAAG,CAAC,SAAS,CAAC,sBAAsB,CACnC;MAAA,CAAC,mBAAmB,CACpB;MAAA,CAAC,WAAW,KAAK,SAAS,IAAI,CAC5B,CAAC,GAAG,CAAC,SAAS,CAAC,4BAA4B,CACzC;UAAA,CAAC,GAAG,CAAC,SAAS,CAAC,WAAW,CAAC,6BAA6B,EAAE,GAAG,CAC/D;QAAA,EAAE,GAAG,CAAC,CACP,CAED;;MAAA,CAAC,WAAW,IAAI,CAAC,OAAO,IAAI,MAAM,CAAC,IAAI,CACrC,CAAC,GAAG,CAAC,SAAS,CAAC,4BAA4B,CACzC;UAAA,CAAC,GAAG,CAAC,SAAS,CAAC,WAAW,CACxB;YAAA,CAAC,2BAA2B,iBAAiB,kCAAkC,CACjF;UAAA,EAAE,GAAG,CACP;QAAA,EAAE,GAAG,CAAC,CACP,CAED;;MAAA,CAAC,oBAAoB,CACrB;MAAA,CAAC,WAAW,IAAI,CAAC,OAAO,IAAI,CAAC,MAAM,IAAI,CACrC,EACE;UAAA,CAAC,CAAC,CAAC,WAAW,CAAC,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,CACjD,CAAC,qBAAqB,CACpB,EAAE,CAAC,MAAM,CACT,IAAI,CAAC,CAAC,kBAAkB,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,CACzC,cAAc,CAAC,CAAC,UAAU,CAAC,CAC3B,QAAQ,CAAC,CAAC,4BAA4B,CAAC,CACvC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,EACV,CACH,CACD;UAAA,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,GAAG,WAAW,CAAC,OAAO,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,OAAO,CAAC,CAChF;;UACF,EAAE,CAAC,CACH;UAAA,CAAC,GAAG,CAAC,SAAS,CAAC,mCAAmC,CAChD;YAAA,CAAC,cAAc,CACb,SAAS,CAAC,KAAK,CACf,KAAK,CAAC,CAAC,EAAE,IAAI,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC,CAChC,OAAO,CAAC,CACN,CAAC,OAAO,CAAC,EAAE,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC,CACvD;;gBACF,EAAE,OAAO,CAAC,CACX,CAED;cAAA,CAAC,MAAM,CACL,SAAS,CAAC,2DAA2D,CACrE,IAAI,CAAC,QAAQ,CACb,EAAE,CAAC,CAAC,qCAAqC,CAAC,CAC1C,WAAW,CAAC,UAAU,CACtB,aAAa,CAAC,MAAM,CACpB,aAAa,CAAC,OAAO,CACrB,OAAO,CAAC,CAAC,GAAG,EAAE;gBACX,CAAC,CAAC,sCAAsC,CAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;YACxE,CAAC,CAAC,CAEF;gBAAA,CAAC,CAAC,CAAC,SAAS,CAAC,YAAY,EAC3B;cAAA,EAAE,MAAM,CACV;YAAA,EAAE,cAAc,CAChB;YAAA,CAAC,GAAG,CACF,EAAE,CAAC,CAAC,kCAAkC,CAAC,CACvC,SAAS,CAAC,eAAe,CACzB,eAAe,CAAC,CAAC,qCAAqC,CAAC,CAEvD;cAAA,CAAC,CAAC,WAAW,IAAI,CACf,CAAC,MAAM,CAAC,SAAS,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC,CAC3E;kBAAA,CAAC,CAAC,CAAC,SAAS,CAAC,oBAAoB,EAAI;gBACvC,EAAE,MAAM,CAAC,CACV,CACD;cAAA,CAAC,CAAC,aAAa,IAAI,CACjB,CAAC,MAAM,CAAC,SAAS,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,CAAC,eAAe,CAAC,YAAY,CAAC,CAAC,CAC7E;kBAAA,CAAC,CAAC,CAAC,SAAS,CAAC,oBAAoB,EAAI;gBACvC,EAAE,MAAM,CAAC,CACV,CACD;cAAA,CAAC,MAAM,CAAC,SAAS,CAAC,eAAe,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,CAAC,eAAe,CAAC,aAAa,CAAC,CAAC,CAC9E;gBAAA,CAAC,CAAC,CAAC,SAAS,CAAC,uBAAuB,EAAI;cAC1C,EAAE,MAAM,CACV;YAAA,EAAE,GAAG,CACL;YAAA,CAAC,GAAG,CAAC,SAAS,CAAC,0BAA0B,CACvC;cAAA,CAAC,OAAO,CAAC,MAAM,KAAK,CAAC,IAAI,CACvB,CAAC,GAAG,CAAC,SAAS,CAAC,aAAa,CAAC,2CAA2C,EAAE,GAAG,CAAC,CAC/E,CACD;cAAA,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC;gBACjB,OAAO,CAAC,GAAG,CAAC,CAAC,MAAW,EAAE,KAAa,EAAE,EAAE,CAAC,eAAe,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAC/E;YAAA,EAAE,GAAG,CACP;UAAA,EAAE,GAAG,CACP;QAAA,GAAG,CACJ,CACH;IAAA,EAAE,GAAG,CAAC,CACP,CAAC;AACJ,CAAC,CAAC","sourcesContent":["import { findReferencedActivitiesInConditions } from 'adaptivity/rules-engine';\nimport { selectSequence } from 'apps/delivery/store/features/groups/selectors/deck';\nimport debounce from 'lodash/debounce';\nimport isEqual from 'lodash/isEqual';\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { OverlayTrigger, Tooltip } from 'react-bootstrap';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { clone } from 'utils/common';\nimport { CapiVariableTypes } from '../../../../adaptivity/capi';\nimport { saveActivity } from '../../../authoring/store/activities/actions/saveActivity';\nimport { selectCurrentRule } from '../../../authoring/store/app/slice';\nimport { selectCurrentActivity } from '../../../delivery/store/features/activities/slice';\nimport {\n  findInSequence,\n  getIsBank,\n  getIsLayer,\n} from '../../../delivery/store/features/groups/actions/sequence';\nimport { createFeedback } from '../../store/activities/actions/createFeedback';\nimport ActionFeedbackEditor from './ActionFeedbackEditor';\nimport ActionMutateEditor from './ActionMutateEditor';\nimport ActionNavigationEditor from './ActionNavigationEditor';\nimport ConditionsBlockEditor from './ConditionsBlockEditor';\n\nexport interface AdaptivityEditorProps {\n  content?: any;\n}\n\nexport type ActionType = 'navigation' | 'mutateState' | 'feedback';\n\nexport const AdaptivityEditor: React.FC<AdaptivityEditorProps> = () => {\n  const dispatch = useDispatch();\n  const currentRule = useSelector(selectCurrentRule);\n  const currentActivity = useSelector(selectCurrentActivity);\n  const sequence = useSelector(selectSequence);\n  const isLayer = getIsLayer();\n  const isBank = getIsBank();\n  let sequenceTypeLabel = '';\n  if (isLayer) {\n    sequenceTypeLabel = 'layer';\n  } else if (isBank) {\n    sequenceTypeLabel = 'question bank';\n  }\n\n  const [isDirty, setIsDirty] = useState(false);\n  const [isDisabled, setIsDisabled] = useState(!!currentRule?.disabled);\n  const [actions, setActions] = useState(currentRule?.event?.params?.actions || []);\n  const [conditions, setConditions] = useState<any>(\n    currentRule?.conditions?.all || currentRule?.conditions?.any || [],\n  );\n  const [rootConditionIsAll, setRootConditionIsAll] = useState<boolean>(\n    !!currentRule?.conditions?.all,\n  );\n  const hasFeedback = actions.find((action: any) => action.type === 'feedback');\n  const hasNavigation = actions.find((action: any) => action.type === 'navigation');\n\n  useEffect(() => {\n    if (!currentRule) return;\n    setIsDisabled(currentRule.disabled);\n    setActions(currentRule.event?.params?.actions || []);\n    setConditions(currentRule.conditions?.all || currentRule.conditions?.any || []);\n    setRootConditionIsAll(!!currentRule.conditions?.all);\n  }, [currentRule]);\n\n  useEffect(() => {\n    if (!isDirty) {\n      return;\n    }\n    const updatedRule = {\n      id: currentRule.id,\n      name: currentRule.name,\n      additionalScore: currentRule.additionalScore || 0,\n      priority: currentRule.priority || 1,\n      forceProgress: !!currentRule.forceProgress,\n      correct: currentRule.correct,\n      default: currentRule.default,\n      disabled: currentRule.disabled,\n      conditions: {\n        [rootConditionIsAll ? 'all' : 'any']: conditions,\n      },\n      event: {\n        ...currentRule.event,\n        type: currentRule.event.type || `${currentRule.id}.${currentRule.name}`,\n        params: {\n          actions,\n        },\n      },\n    };\n    setIsDirty(false);\n    handleRuleChange(updatedRule);\n  }, [isDirty]);\n\n  const handleRuleChange = (rule: any) => {\n    const existing = currentActivity?.authoring.rules.find((r: any) => r.id === rule.id);\n    const diff = JSON.stringify(rule) !== JSON.stringify(existing);\n    /* console.log('RULE CHANGE: ', {\n      rule,\n      existing,\n      diff,\n    }); */\n    if (!existing) {\n      console.warn(\"rule not found, shouldn't happen!!!\");\n      return;\n    }\n    if (diff) {\n      const activityClone = clone(currentActivity);\n      const rulesClone = [...currentActivity?.authoring.rules];\n      rulesClone[currentActivity?.authoring.rules.indexOf(existing)] = rule;\n      activityClone.authoring.rules = rulesClone;\n      // due to the way this works technically if we are *deleting\" a condition with an external reference\n      // then it will *not* be removed here, but it will be removed the next time the lesson is opened in the editor\n      const conditionRefs = findReferencedActivitiesInConditions(\n        rule.conditions.any || rule.conditions.all,\n      );\n      if (conditionRefs.length > 0) {\n        if (!activityClone.authoring.activitiesRequiredForEvaluation) {\n          activityClone.authoring.activitiesRequiredForEvaluation = [];\n        }\n        // need to find the resourceId based on the sequenceId that is referenced\n        const resourceIds = conditionRefs\n          .map((conditionRef: any) => {\n            const sequenceItem = findInSequence(sequence, conditionRef);\n            if (sequenceItem) {\n              return sequenceItem.resourceId;\n            } else {\n              console.warn(\n                `[handleRuleChange] could not find referenced activity ${conditionRef} in sequence`,\n                sequence,\n              );\n            }\n          })\n          .filter((id) => id) as number[];\n        const current = activityClone.authoring.activitiesRequiredForEvaluation;\n        activityClone.authoring.activitiesRequiredForEvaluation = Array.from(\n          new Set([...current, ...resourceIds]),\n        );\n        /* console.log('[handleRuleChange] adding activities to required for evaluation', {\n          activityClone,\n          rule,\n        }); */\n      }\n      dispatch(saveActivity({ activity: activityClone }));\n    }\n  };\n\n  const notifyTime = 250;\n  const debounceNotifyChanges = useCallback(\n    debounce(\n      () => {\n        setIsDirty(true);\n      },\n      notifyTime,\n      { leading: false },\n    ),\n    [],\n  );\n\n  const handleConditionsEditorChange = (updatedConditionsBlock: any) => {\n    /* console.log('CONDITION ED: ', updatedConditionsBlock); */\n    const conds = updatedConditionsBlock.all || updatedConditionsBlock.any || [];\n    const updatedIsAll = !!updatedConditionsBlock.all;\n    const rootChanged = updatedIsAll !== rootConditionIsAll;\n    const condsChanged = !isEqual(conditions, conds);\n\n    if (!rootChanged && !condsChanged) {\n      // nothing changed\n      return;\n    }\n\n    setRootConditionIsAll(updatedIsAll);\n    setConditions(conds);\n    debounceNotifyChanges();\n  };\n  const getActionEditor = (action: any, index: number) => {\n    switch (action.type as ActionType) {\n      case 'feedback':\n        return (\n          <ActionFeedbackEditor\n            key={index}\n            action={action}\n            onChange={(changes: any) => {\n              handleActionChange(action, changes);\n            }}\n            onDelete={handleDeleteAction}\n          />\n        );\n      case 'navigation':\n        return (\n          <ActionNavigationEditor\n            key={index}\n            action={action}\n            onChange={(changes: any) => {\n              handleActionChange(action, changes);\n            }}\n            allowDelete={!currentRule.correct}\n            onDelete={handleDeleteAction}\n          />\n        );\n      case 'mutateState':\n        return (\n          <ActionMutateEditor\n            key={index}\n            action={action}\n            onChange={(changes: any) => {\n              handleActionChange(action, changes);\n            }}\n            onDelete={handleDeleteAction}\n          />\n        );\n    }\n  };\n\n  const handleAddAction = async (actionType: ActionType) => {\n    let newAction;\n    switch (actionType) {\n      case 'feedback':\n        const result = await dispatch(createFeedback({}));\n        newAction = (result as any).payload;\n        break;\n      case 'navigation':\n        newAction = {\n          type: 'navigation',\n          params: {\n            target: 'next',\n          },\n        };\n        break;\n      case 'mutateState':\n        newAction = {\n          type: 'mutateState',\n          params: {\n            operator: '=',\n            target: 'stage.',\n            targetType: CapiVariableTypes.STRING,\n            value: undefined,\n          },\n        };\n        break;\n    }\n    if (newAction) {\n      setActions([...actions, newAction]);\n      debounceNotifyChanges();\n    }\n  };\n\n  const handleActionChange = async (action: any, changes: any) => {\n    const updated = { ...action, params: { ...action.params, ...changes } };\n    const actionIndex = actions.indexOf(action);\n    /* console.log('action changed', { action, changes, actionIndex }); */\n    if (actionIndex !== -1) {\n      const cloneActions = [...actions];\n      cloneActions[actionIndex] = updated;\n      setActions(cloneActions);\n      debounceNotifyChanges();\n    }\n  };\n\n  const handleDeleteAction = async (action: any) => {\n    // TODO: get rid of orphaned feedback ensembles!\n    const temp = actions.filter((a: any) => a !== action);\n    setActions(temp);\n    debounceNotifyChanges();\n  };\n\n  return (\n    <div className=\"aa-adaptivity-editor\">\n      {/* No Conditions */}\n      {currentRule === undefined && (\n        <div className=\"text-center border rounded\">\n          <div className=\"card-body\">Please select a sequence item</div>\n        </div>\n      )}\n\n      {currentRule && (isLayer || isBank) && (\n        <div className=\"text-center border rounded\">\n          <div className=\"card-body\">\n            {`This sequence item is a ${sequenceTypeLabel} and does not support adaptivity`}\n          </div>\n        </div>\n      )}\n\n      {/* Has Conditions */}\n      {currentRule && !isLayer && !isBank && (\n        <>\n          {!(currentRule.default && !currentRule.correct) && (\n            <ConditionsBlockEditor\n              id=\"root\"\n              type={rootConditionIsAll ? 'all' : 'any'}\n              rootConditions={conditions}\n              onChange={handleConditionsEditorChange}\n              index={-1}\n            />\n          )}\n          <p className={`${currentRule.default && !currentRule.correct ? '' : 'mt-3'} mb-0`}>\n            Perform the following actions:\n          </p>\n          <div className=\"aa-actions pt-3 mt-2 d-flex w-100\">\n            <OverlayTrigger\n              placement=\"top\"\n              delay={{ show: 150, hide: 150 }}\n              overlay={\n                <Tooltip id=\"button-tooltip\" style={{ fontSize: '12px' }}>\n                  New Action\n                </Tooltip>\n              }\n            >\n              <button\n                className=\"dropdown-toggle aa-add-button btn btn-primary btn-sm mr-3\"\n                type=\"button\"\n                id={`adaptive-editor-add-context-trigger`}\n                data-toggle=\"dropdown\"\n                aria-haspopup=\"true\"\n                aria-expanded=\"false\"\n                onClick={() => {\n                  ($(`#adaptive-editor-add-context-trigger`) as any).dropdown('toggle');\n                }}\n              >\n                <i className=\"fa fa-plus\" />\n              </button>\n            </OverlayTrigger>\n            <div\n              id={`adaptive-editor-add-context-menu`}\n              className=\"dropdown-menu\"\n              aria-labelledby={`adaptive-editor-add-context-trigger`}\n            >\n              {!hasFeedback && (\n                <button className=\"dropdown-item\" onClick={() => handleAddAction('feedback')}>\n                  <i className=\"fa fa-comment mr-2\" /> Show Feedback\n                </button>\n              )}\n              {!hasNavigation && (\n                <button className=\"dropdown-item\" onClick={() => handleAddAction('navigation')}>\n                  <i className=\"fa fa-compass mr-2\" /> Navigate To\n                </button>\n              )}\n              <button className=\"dropdown-item\" onClick={() => handleAddAction('mutateState')}>\n                <i className=\"fa fa-crosshairs mr-2\" /> Mutate State\n              </button>\n            </div>\n            <div className=\"d-flex flex-column w-100\">\n              {actions.length === 0 && (\n                <div className=\"text-danger\">No actions. This rule will not do anything.</div>\n              )}\n              {actions.length > 0 &&\n                actions.map((action: any, index: number) => getActionEditor(action, index))}\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n"]}