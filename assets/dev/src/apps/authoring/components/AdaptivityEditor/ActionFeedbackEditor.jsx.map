{"version":3,"file":"ActionFeedbackEditor.jsx","sourceRoot":"","sources":["../../../../../../src/apps/authoring/components/AdaptivityEditor/ActionFeedbackEditor.tsx"],"names":[],"mappings":"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","sourcesContent":["import { FeedbackAction } from 'apps/authoring/types';\nimport ScreenAuthor from 'components/activities/adaptive/components/authoring/ScreenAuthor';\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { Modal, OverlayTrigger, Tooltip } from 'react-bootstrap';\nimport guid from 'utils/guid';\nimport ConfirmDelete from '../Modal/DeleteConfirmationModal';\n\ninterface ActionFeedbackEditorProps {\n  action: FeedbackAction;\n  onChange: (changes: any) => void;\n  onDelete: (changes: FeedbackAction) => void;\n}\n\nconst ActionFeedbackEditor: React.FC<ActionFeedbackEditorProps> = ({\n  action,\n  onDelete,\n  onChange,\n}) => {\n  const [fakeFeedback, setFakeFeedback] = useState<string>('');\n  const uuid = guid();\n\n  const [feedback, setFeedback] = useState<any>(action.params?.feedback || {});\n  const [showConfirmDelete, setShowConfirmDelete] = useState<boolean>(false);\n\n  useEffect(() => {\n    setFeedback(action.params?.feedback || {});\n  }, [action.params]);\n\n  useEffect(() => {\n    feedback.partsLayout?.forEach((part: any) =>\n      part.custom?.nodes?.forEach((node: any) => {\n        const feedbackText = getFeedbackTextFromNode(node);\n        setFakeFeedback(feedbackText);\n      }),\n    );\n  }, [feedback]);\n\n  const getFeedbackTextFromNode = (node: any): any => {\n    let nodeText = '';\n    if (node?.tag === 'text') {\n      nodeText = node.text;\n    } else if (node?.children?.length > 0) {\n      nodeText = getFeedbackTextFromNode(node?.children[0]);\n    } else {\n      nodeText = 'unknown';\n    }\n    return nodeText;\n  };\n\n  const [showEditor, setShowEditor] = useState(false);\n\n  const handleShowFeedbackClick = () => {\n    // console.log('show feedback editor');\n    setShowEditor(true);\n  };\n\n  const handleCancelEdit = useCallback(() => {\n    // TODO: this revert causes infinite loop\n    // setFeedback(action.params?.feedback || {});\n    setShowEditor(false);\n  }, [feedback]);\n\n  const handleSaveEdit = useCallback(() => {\n    setShowEditor(false);\n    onChange({ feedback });\n  }, [feedback]);\n\n  const handleScreenAuthorChange = (screen: any) => {\n    // console.log('ActionFeedbackEditor Screen Author Change', { screen });\n    setFeedback(screen);\n  };\n\n  return (\n    <div className=\"aa-action d-flex mb-2 form-inline align-items-center flex-nowrap\">\n      <label className=\"sr-only\" htmlFor={`action-feedback-${uuid}`}>\n        show feedback\n      </label>\n      <div className=\"input-group input-group-sm flex-grow-1\">\n        <div className=\"input-group-prepend\">\n          <div\n            className=\"input-group-text\"\n            onClick={handleShowFeedbackClick}\n            style={{ cursor: 'pointer' }}\n          >\n            <i className=\"fa fa-comment mr-1\" />\n            Show Feedback\n          </div>\n        </div>\n        <input\n          type=\"text\"\n          className=\"form-control form-control-sm\"\n          id={`action-feedback-${uuid}`}\n          placeholder=\"Enter feedback\"\n          disabled={false}\n          onClick={handleShowFeedbackClick}\n          value={fakeFeedback}\n          // onChange={(e) => setFakeFeedback(e.target.value)}\n          // onBlur={(e) => handleTargetChange(e)}\n          title={fakeFeedback}\n        />\n      </div>\n      <OverlayTrigger\n        placement=\"top\"\n        delay={{ show: 150, hide: 150 }}\n        overlay={\n          <Tooltip id=\"button-tooltip\" style={{ fontSize: '12px' }}>\n            Delete Action\n          </Tooltip>\n        }\n      >\n        <span>\n          <button className=\"btn btn-link p-0 ml-1\" onClick={() => setShowConfirmDelete(true)}>\n            <i className=\"fa fa-trash-alt\" />\n          </button>\n        </span>\n      </OverlayTrigger>\n      <Modal dialogClassName=\"modal-90w\" show={showEditor} onHide={handleCancelEdit}>\n        <Modal.Header closeButton={true}>\n          <h3 className=\"modal-title\">Feedback</h3>\n        </Modal.Header>\n        <Modal.Body>\n          <ScreenAuthor screen={feedback} onChange={handleScreenAuthorChange} />\n        </Modal.Body>\n        <Modal.Footer>\n          <button className=\"btn btn-secondary\" onClick={handleCancelEdit}>\n            Cancel\n          </button>\n          <button className=\"btn btn-danger\" onClick={handleSaveEdit}>\n            Save\n          </button>\n        </Modal.Footer>\n      </Modal>\n      {showConfirmDelete && (\n        <ConfirmDelete\n          show={showConfirmDelete}\n          elementType=\"Action\"\n          elementName=\"this feedback action\"\n          deleteHandler={() => {\n            onDelete(action);\n            setShowConfirmDelete(false);\n          }}\n          cancelHandler={() => {\n            setShowConfirmDelete(false);\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default ActionFeedbackEditor;\n"]}