{"version":3,"file":"ConditionItemEditor.jsx","sourceRoot":"","sources":["../../../../../../src/apps/authoring/components/AdaptivityEditor/ConditionItemEditor.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { OverlayTrigger, Tooltip } from 'react-bootstrap';\nimport { CapiVariableTypes, JanusConditionProperties } from '../../../../adaptivity/capi';\nimport ConfirmDelete from '../Modal/DeleteConfirmationModal';\nimport {\n  ConditionOperatorOption,\n  conditionOperatorOptions,\n  ConditionTypeOperatorCombo,\n  conditionTypeOperatorCombos,\n  inferTypeFromOperatorAndValue,\n  TypeOption,\n  typeOptions,\n} from './AdaptiveItemOptions';\nimport { OverlayPlacements, VariablePicker } from './VariablePicker';\n\ninterface ConditionItemEditorProps {\n  condition: JanusConditionProperties;\n  parentIndex: number;\n  onChange: (condition: Partial<JanusConditionProperties>) => void;\n  onDelete: () => void;\n}\n\nconst ConditionItemEditor: React.FC<ConditionItemEditorProps> = (props) => {\n  const { condition, parentIndex, onChange, onDelete } = props;\n\n  const [fact, setFact] = useState<string>(condition.fact);\n  const [targetType, setTargetType] = useState<CapiVariableTypes>(\n    condition.type || inferTypeFromOperatorAndValue(condition.operator, condition.value),\n  );\n  const [operator, setOperator] = useState<string>(condition.operator);\n  const [value, setValue] = useState<any>(condition.value);\n  const [showConfirmDelete, setShowConfirmDelete] = useState<boolean>(false);\n\n  const handleFactChange = (e: any) => {\n    const val = e.target.value;\n    if (val === fact) {\n      return;\n    }\n    setFact(val);\n    onChange({ fact: val });\n  };\n\n  const handleTargetTypeChange = (e: any) => {\n    const val = parseInt(e.target.value);\n    if (val === targetType) {\n      return;\n    }\n    setTargetType(val);\n    onChange({ type: val });\n  };\n\n  const handleOperatorChange = (e: any) => {\n    const val = e.target.value;\n    if (val === operator) {\n      return;\n    }\n    setOperator(val);\n    onChange({ operator: val });\n  };\n\n  const handleValueChange = (e: any) => {\n    const val = e.target.value;\n    if (val === value) {\n      return;\n    }\n    setValue(val);\n    onChange({ value: val });\n  };\n\n  const targetRef = useRef<HTMLInputElement>(null);\n  const typeRef = useRef<HTMLSelectElement>(null);\n\n  const getFilteredConditionOperatorOptions = (): ConditionOperatorOption[] => {\n    const filteredConditionOperatorOptions: ConditionOperatorOption[] = [];\n    const filteredCombo: ConditionTypeOperatorCombo[] = conditionTypeOperatorCombos.filter(\n      (combo) => combo.type === targetType,\n    );\n    filteredCombo[0].operators.forEach((comboOperator) => {\n      conditionOperatorOptions.forEach((conditionOperator) => {\n        if (conditionOperator.key === comboOperator) {\n          filteredConditionOperatorOptions.push(conditionOperator);\n        }\n      });\n    });\n    return filteredConditionOperatorOptions;\n  };\n\n  useEffect(() => {\n    // when the targetType is manually changed, we may need to also set the operator\n    setTimeout(() => {\n      const filteredOperations = getFilteredConditionOperatorOptions();\n      const operatorInList = filteredOperations.find((option) => option.value === operator);\n      const updatedOperator = operatorInList ? operatorInList.value : filteredOperations[0].value;\n      if (updatedOperator === operator) {\n        return;\n      }\n      setOperator(updatedOperator);\n      onChange({ operator: updatedOperator });\n    }, 10);\n  }, [targetType]);\n\n  return (\n    <div key={parentIndex} className=\"d-flex mt-1\">\n      <div className=\"input-group input-group-sm flex-grow-1\">\n        <div className=\"input-group-prepend\" title=\"Target\">\n          <VariablePicker\n            targetRef={targetRef}\n            typeRef={typeRef}\n            placement={OverlayPlacements.TOP}\n            context=\"condition\"\n          />\n        </div>\n        <label className=\"sr-only\" htmlFor={`target-${parentIndex}`}>\n          target\n        </label>\n        <input\n          key={`target-${parentIndex}`}\n          id={`target-${parentIndex}`}\n          className=\"form-control form-control-sm flex-grow-1 mr-2\"\n          type=\"text\"\n          placeholder=\"Target\"\n          defaultValue={fact}\n          onBlur={(e) => handleFactChange(e)}\n          title={fact}\n          tabIndex={0}\n          ref={targetRef}\n        />\n      </div>\n      <label className=\"sr-only\" htmlFor={`target-type-${parentIndex}`}>\n        type\n      </label>\n      <select\n        className=\"custom-select mr-2 form-control form-control-sm\"\n        id={`target-type-${parentIndex}`}\n        defaultValue={targetType}\n        onChange={(e) => handleTargetTypeChange(e)}\n        ref={typeRef}\n      >\n        {typeOptions.map((type: TypeOption) => (\n          <option key={type.key} value={type.value}>\n            {type.text}\n          </option>\n        ))}\n      </select>\n      <label className=\"sr-only\" htmlFor={`operator-${parentIndex}`}>\n        operator\n      </label>\n      <select\n        key={`operator-${parentIndex}`}\n        className=\"custom-select mr-2 form-control form-control-sm flex-grow-1 mw-25\"\n        id={`operator-${parentIndex}`}\n        placeholder=\"Operator\"\n        defaultValue={operator}\n        onChange={(e) => handleOperatorChange(e)}\n        title={operator}\n        tabIndex={0}\n      >\n        {getFilteredConditionOperatorOptions().map(\n          (option: ConditionOperatorOption, index: number) => (\n            <option key={`option${index}-${parentIndex}`} value={option.value} title={option.key}>\n              {option.text}\n            </option>\n          ),\n        )}\n      </select>\n      <label className=\"sr-only\" htmlFor={`value-${parentIndex}`}>\n        value\n      </label>\n      <input\n        type=\"text\"\n        className=\"form-control form-control-sm flex-grow-1 mw-25\"\n        key={`value-${parentIndex}`}\n        id={`value-${parentIndex}`}\n        defaultValue={value}\n        onBlur={(e) => handleValueChange(e)}\n        title={value}\n        placeholder=\"Value\"\n        tabIndex={0}\n      />\n      <OverlayTrigger\n        placement=\"top\"\n        delay={{ show: 150, hide: 150 }}\n        overlay={\n          <Tooltip id=\"button-tooltip\" style={{ fontSize: '12px' }}>\n            Delete Condition\n          </Tooltip>\n        }\n      >\n        <span>\n          <button className=\"btn btn-link p-0 ml-1\" onClick={() => setShowConfirmDelete(true)}>\n            <i className=\"fa fa-trash-alt\" />\n          </button>\n        </span>\n      </OverlayTrigger>\n      {showConfirmDelete && (\n        <ConfirmDelete\n          show={showConfirmDelete}\n          elementType=\"Condition\"\n          elementName=\"this rule condition\"\n          deleteHandler={() => {\n            onDelete();\n            setShowConfirmDelete(false);\n          }}\n          cancelHandler={() => {\n            setShowConfirmDelete(false);\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default ConditionItemEditor;\n"]}