{"version":3,"file":"ActionMutateEditor.jsx","sourceRoot":"","sources":["../../../../../../src/apps/authoring/components/AdaptivityEditor/ActionMutateEditor.tsx"],"names":[],"mappings":"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","sourcesContent":["import { CapiVariableTypes } from '../../../../adaptivity/capi';\nimport { MutateStateAction, MutateStateActionParams } from 'apps/authoring/types';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { OverlayTrigger, Tooltip } from 'react-bootstrap';\nimport guid from 'utils/guid';\nimport { VariablePicker, OverlayPlacements } from './VariablePicker';\nimport {\n  ActionOperatorOption,\n  actionOperatorOptions,\n  TypeOption,\n  typeOptions,\n} from './AdaptiveItemOptions';\nimport ConfirmDelete from '../Modal/DeleteConfirmationModal';\n\ninterface ActionMutateEditorProps {\n  action: MutateStateAction;\n  onChange: (changes: MutateStateActionParams) => void;\n  onDelete: (changes: MutateStateAction) => void;\n}\n\nconst ActionMutateEditor: React.FC<ActionMutateEditorProps> = (props) => {\n  const { action, onChange, onDelete } = props;\n\n  const [target, setTarget] = useState(action.params.target);\n  const [targetType, setTargetType] = useState(action.params.targetType);\n  const [operator, setOperator] = useState(action.params.operator);\n  const [value, setValue] = useState(action.params.value);\n  const [isDirty, setIsDirty] = useState(false);\n  const [showConfirmDelete, setShowConfirmDelete] = useState<boolean>(false);\n  const uuid = guid();\n\n  const targetRef = useRef<HTMLInputElement>(null);\n  const typeRef = useRef<HTMLSelectElement>(null);\n\n  const handleTargetChange = (e: any) => {\n    const val = e.target.value;\n    if (val === target) {\n      // since using blur, don't need to update if there is no change\n      return;\n    }\n    setTarget(val);\n    setIsDirty(true);\n  };\n\n  const handleValueChange = (e: any) => {\n    const val = e.target.value;\n    if (val === value) {\n      return;\n    }\n    setValue(val);\n    setIsDirty(true);\n  };\n\n  const handleTargetTypeChange = (e: any) => {\n    const val = parseInt(e.target.value);\n    if (val === targetType) {\n      return;\n    }\n    setTargetType(val);\n    setIsDirty(true);\n  };\n\n  const handleOperatorChange = (e: any) => {\n    const val = e.target.value;\n    if (val === operator) {\n      return;\n    }\n    setOperator(val);\n    setIsDirty(true);\n  };\n\n  const postChanges = () => {\n    const val = {\n      target,\n      targetType,\n      operator,\n      value,\n    };\n    onChange(val);\n    setIsDirty(false);\n  };\n\n  useEffect(() => {\n    if (isDirty) {\n      postChanges();\n    }\n  }, [isDirty]);\n\n  // update adding operator if targetType changes from number\n  useEffect(() => {\n    if (targetType !== CapiVariableTypes.NUMBER) {\n      if (operator === 'adding') {\n        setTimeout(() => {\n          setOperator('=');\n          setIsDirty(true);\n        });\n      }\n    }\n  }, [targetType]);\n\n  return (\n    <div className=\"aa-action aa-mutate d-flex mb-2 form-inline align-items-center flex-nowrap\">\n      <label className=\"sr-only\" htmlFor={`action-mutate-target-${uuid}`}>\n        target\n      </label>\n      <div className=\"input-group input-group-sm flex-grow-1\">\n        <div className=\"input-group-prepend\" title=\"target\">\n          <VariablePicker\n            targetRef={targetRef}\n            typeRef={typeRef}\n            placement={OverlayPlacements.TOP}\n            context=\"mutate\"\n          />\n        </div>\n        <input\n          type=\"text\"\n          className=\"form-control form-control-sm mr-2 flex-grow-1\"\n          id={`action-mutate-target-${uuid}`}\n          defaultValue={target}\n          onBlur={(e) => handleTargetChange(e)}\n          title={target}\n          placeholder=\"Target\"\n          ref={targetRef}\n        />\n      </div>\n      <label className=\"sr-only\" htmlFor={`action-mutate-type-${uuid}`}>\n        type\n      </label>\n      <select\n        className=\"custom-select mr-2 form-control form-control-sm\"\n        id={`action-mutate-type-${uuid}`}\n        value={targetType}\n        onChange={(e) => handleTargetTypeChange(e)}\n        ref={typeRef}\n      >\n        {typeOptions.map((type: TypeOption) => (\n          <option key={type.key} value={type.value}>\n            {type.text}\n          </option>\n        ))}\n      </select>\n      <label className=\"sr-only\" htmlFor={`action-mutate-operator-${uuid}`}>\n        operator\n      </label>\n      <select\n        className=\"custom-select mr-2 form-control form-control-sm\"\n        id={`action-mutate-operator-${uuid}`}\n        value={operator}\n        onChange={(e) => handleOperatorChange(e)}\n      >\n        {actionOperatorOptions\n          .filter((option: ActionOperatorOption) => {\n            if (parseInt(targetType.toString(), 10) !== CapiVariableTypes.NUMBER) {\n              return option.key !== 'add';\n            }\n            return true;\n          })\n          .map((option: ActionOperatorOption) => (\n            <option key={option.key} value={option.value}>\n              {option.text}\n            </option>\n          ))}\n      </select>\n      <label className=\"sr-only\" htmlFor={`action-mutate-value-${uuid}`}>\n        value\n      </label>\n      <div className=\"input-group input-group-sm\">\n        <div className=\"input-group-prepend\" title=\"value\">\n          <div className=\"input-group-text\">\n            <i className=\"fa fa-flag-checkered\" />\n          </div>\n        </div>\n        <input\n          type=\"text\"\n          className=\"form-control form-control-sm\"\n          id={`action-mutate-value-${uuid}`}\n          value={value}\n          onChange={(e) => handleValueChange(e)}\n          title={value}\n          placeholder=\"Value\"\n        />\n      </div>\n\n      <OverlayTrigger\n        placement=\"top\"\n        delay={{ show: 150, hide: 150 }}\n        overlay={\n          <Tooltip id=\"button-tooltip\" style={{ fontSize: '12px' }}>\n            Delete Action\n          </Tooltip>\n        }\n      >\n        <span>\n          <button className=\"btn btn-link p-0 ml-1\" onClick={() => setShowConfirmDelete(true)}>\n            <i className=\"fa fa-trash-alt\" />\n          </button>\n        </span>\n      </OverlayTrigger>\n      {showConfirmDelete && (\n        <ConfirmDelete\n          show={showConfirmDelete}\n          elementType=\"Action\"\n          elementName=\"this mutate action\"\n          deleteHandler={() => {\n            onDelete(action);\n            setShowConfirmDelete(false);\n          }}\n          cancelHandler={() => {\n            setShowConfirmDelete(false);\n          }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default ActionMutateEditor;\n"]}