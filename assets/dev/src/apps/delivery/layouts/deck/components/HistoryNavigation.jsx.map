{"version":3,"file":"HistoryNavigation.jsx","sourceRoot":"","sources":["../../../../../../../src/apps/delivery/layouts/deck/components/HistoryNavigation.tsx"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable react/prop-types */\nimport React, { Fragment } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { defaultGlobalEnv, getEnvState } from '../../../../../adaptivity/scripting';\nimport { selectCurrentActivityId } from '../../../store/features/activities/slice';\nimport {\n  setHistoryNavigationTriggered,\n  setRestartLesson,\n} from '../../../store/features/adaptivity/slice';\nimport { navigateToActivity } from '../../../store/features/groups/actions/deck';\nimport { selectSequence } from '../../../store/features/groups/selectors/deck';\nimport {\n  selectEnableHistory,\n  selectShowHistory,\n  setShowHistory,\n} from '../../../store/features/page/slice';\nimport HistoryPanel from './HistoryPanel';\n\nconst HistoryNavigation: React.FC = () => {\n  const currentActivityId = useSelector(selectCurrentActivityId);\n  const enableHistory = useSelector(selectEnableHistory);\n  const showHistory = useSelector(selectShowHistory);\n\n  const sequences = useSelector(selectSequence);\n  const dispatch = useDispatch();\n\n  const restartHandler = () => {\n    dispatch(setRestartLesson({ restartLesson: true }));\n  };\n\n  const minimizeHandler = () => {\n    dispatch(setShowHistory({ show: !showHistory }));\n  };\n\n  const snapshot = getEnvState(defaultGlobalEnv);\n\n  // Get the activities student visited\n  const globalSnapshot = Object.keys(snapshot)\n    .filter((key: string) => key.indexOf('session.visitTimestamps.') === 0)\n    ?.reverse()\n    .map((entry) => entry.split('.')[2]);\n\n  // Get the activity names and ids to be displayed in the history panel\n  const historyItems = globalSnapshot?.map((activityId) => {\n    const foundSequence = sequences.filter(\n      (sequence) => sequence.custom?.sequenceId === activityId,\n    )[0];\n    return {\n      id: foundSequence.custom?.sequenceId,\n      name: foundSequence.custom?.sequenceName || foundSequence.id,\n      timestamp: snapshot[`session.visitTimestamps.${foundSequence.custom?.sequenceId}`],\n    };\n  });\n  const currentHistoryActivityIndex = historyItems.findIndex(\n    (item: any) => item.id === currentActivityId,\n  );\n  const isFirst = currentHistoryActivityIndex === historyItems.length - 1;\n  const isLast = currentHistoryActivityIndex === 0;\n  const nextHandler = () => {\n    const prevActivity = historyItems[currentHistoryActivityIndex - 1];\n    dispatch(navigateToActivity(prevActivity.id));\n\n    const nextHistoryActivityIndex = historyItems.findIndex(\n      (item: any) => item.id === prevActivity.id,\n    );\n    dispatch(\n      setHistoryNavigationTriggered({\n        historyModeNavigation: nextHistoryActivityIndex !== 0,\n      }),\n    );\n  };\n\n  const prevHandler = () => {\n    const prevActivity = historyItems[currentHistoryActivityIndex + 1];\n    dispatch(navigateToActivity(prevActivity.id));\n    dispatch(\n      setHistoryNavigationTriggered({\n        historyModeNavigation: true,\n      }),\n    );\n  };\n  return (\n    <Fragment>\n      {enableHistory ? (\n        <div className=\"historyStepView pullLeftInCheckContainer\">\n          <div className=\"historyStepContainer\">\n            <button\n              onClick={prevHandler}\n              className=\"backBtn historyStepButton\"\n              aria-label=\"Previous screen\"\n              disabled={isFirst}\n            >\n              <span className=\"icon-chevron-left\" />\n            </button>\n            <button\n              onClick={nextHandler}\n              className=\"nextBtn historyStepButton\"\n              aria-label=\"Next screen\"\n              disabled={isLast}\n            >\n              <span className=\"icon-chevron-right\" />\n            </button>\n          </div>\n        </div>\n      ) : null}\n      <div\n        className={[\n          'navigationContainer',\n          enableHistory ? undefined : 'pullLeftInCheckContainer',\n        ].join(' ')}\n      >\n        <aside className={`ui-resizable ${showHistory ? undefined : 'minimized'}`}>\n          {enableHistory ? (\n            <Fragment>\n              <button\n                onClick={minimizeHandler}\n                className=\"navigationToggle\"\n                aria-label=\"Show lesson history\"\n                aria-haspopup=\"true\"\n                aria-controls=\"theme-history-panel\"\n                aria-pressed=\"false\"\n              />\n\n              <HistoryPanel\n                items={historyItems}\n                onMinimize={minimizeHandler}\n                onRestart={restartHandler}\n              />\n            </Fragment>\n          ) : (\n            <button onClick={restartHandler} className=\"theme-no-history-restart\">\n              <span>\n                <div className=\"theme-no-history-restart__icon\" />\n                <span className=\"theme-no-history-restart__label\">Restart Lesson</span>\n              </span>\n            </button>\n          )}\n        </aside>\n      </div>\n    </Fragment>\n  );\n};\n\nexport default HistoryNavigation;\n"]}