{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../../../src/components/misc/resizer/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import { BoundingRect, Point, Position } from 'components/misc/resizer/types';\nimport { MousePosition } from 'components/misc/resizer/useMousePosition';\n\nconst HANDLE_CENTER_IN_PIXELS = 4;\nconst offsetByResizeHandleSize = (styles: Point) =>\n  Object.assign(styles, {\n    left: styles.left - HANDLE_CENTER_IN_PIXELS,\n    top: styles.top - HANDLE_CENTER_IN_PIXELS,\n  });\n\nexport const cursor = (position: 'border' | Position): { [k: string]: string } => {\n  switch (position) {\n    case 'border':\n      return {};\n    case 'nw':\n      return { cursor: 'nw-resize' };\n    case 'n':\n      return { cursor: 'n-resize' };\n    case 'ne':\n      return { cursor: 'ne-resize' };\n    case 'w':\n      return { cursor: 'w-resize' };\n    case 'e':\n      return { cursor: 'e-resize' };\n    case 'sw':\n      return { cursor: 'sw-resize' };\n    case 's':\n      return { cursor: 's-resize' };\n    case 'se':\n      return { cursor: 'se-resize' };\n  }\n};\n\nconst positions =\n  ({ left, top, width, height }: BoundingRect) =>\n  (position: 'border' | Position): Point | BoundingRect => {\n    switch (position) {\n      case 'border':\n        return { left, top, width, height };\n      case 'nw':\n        return { left, top };\n      case 'n':\n        return { left: left + width / 2, top };\n      case 'ne':\n        return { left: left + width, top };\n      case 'w':\n        return { left, top: top + height / 2 };\n      case 'e':\n        return { left: left + width, top: top + height / 2 };\n      case 'sw':\n        return { left, top: top + height };\n      case 's':\n        return { left: left + width / 2, top: top + height };\n      case 'se':\n        return { left: left + width, top: top + height };\n    }\n  };\n\nexport const resizeHandleStyles =\n  (boundingRect: BoundingRect) =>\n  (position: 'border' | Position): Partial<BoundingRect> =>\n    Object.assign(\n      position === 'border'\n        ? positions(boundingRect)(position)\n        : offsetByResizeHandleSize(positions(boundingRect)(position)),\n      cursor(position),\n    );\n\nexport const clientBoundingRect = (element: HTMLElement): BoundingRect => {\n  const { left, top, width, height } = element.getBoundingClientRect();\n  return {\n    top,\n    left,\n    width,\n    height,\n  };\n};\n\nexport const offsetBoundingRect = (element: HTMLElement): BoundingRect => {\n  const { offsetTop, offsetLeft, offsetWidth, offsetHeight } = element;\n  return {\n    top: offsetTop,\n    left: offsetLeft,\n    width: offsetWidth,\n    height: offsetHeight,\n  };\n};\n\nconst proportionalWidthAndHeight = (\n  { width: initialWidth, height: initialHeight }: BoundingRect,\n  boundaryWidth: number,\n  boundaryHeight: number,\n) => {\n  // initialWidth / initialHeight == scaledWidth / scaledHeight\n  const scaledHeight = initialHeight / (initialWidth / boundaryWidth);\n  const scaledWidth = initialWidth / (initialHeight / boundaryHeight);\n\n  // Constrain resizing to the smaller value of boundary width and height\n  if (scaledHeight < boundaryHeight) {\n    return {\n      width: scaledWidth,\n      height: boundaryHeight,\n    };\n  }\n  return {\n    width: boundaryWidth,\n    height: scaledHeight,\n  };\n};\n\nexport const boundingRectFromMousePosition = (\n  initialClientBoundingRect: BoundingRect,\n  initialOffsetBoundingRect: BoundingRect,\n  mousePosition: MousePosition,\n  dragHandle: Position,\n): BoundingRect =>\n  constrainRect(\n    boundingRectHelper(\n      initialClientBoundingRect,\n      initialOffsetBoundingRect,\n      mousePosition,\n      dragHandle,\n    ),\n    initialOffsetBoundingRect,\n  );\n\nconst constrainRect = (\n  { top, left, width, height }: BoundingRect,\n  { top: initialTop, left: initialLeft, width: initialWidth, height: initialHeight }: BoundingRect,\n) => {\n  const MIN_SIZE = 10;\n  const atLeast = (a: number, min: number) => (a < min ? min : a);\n  const atMost = (a: number, max: number) => (a > max ? max : a);\n\n  return {\n    top: atMost(top, initialTop + initialHeight - MIN_SIZE),\n    left: atMost(left, initialLeft + initialWidth - MIN_SIZE),\n    width: atLeast(width, MIN_SIZE),\n    height: atLeast(height, MIN_SIZE),\n  };\n};\n\nconst boundingRectHelper = (\n  initialClientBoundingRect: BoundingRect,\n  initialOffsetBoundingRect: BoundingRect,\n  { x, y }: MousePosition,\n  dragHandle: Position,\n): BoundingRect => {\n  const {\n    top: offsetTop,\n    left: offsetLeft,\n    width: offsetWidth,\n    height: offsetHeight,\n  } = initialOffsetBoundingRect;\n  const {\n    top: clientTop,\n    left: clientLeft,\n    width: clientWidth,\n    height: clientHeight,\n  } = initialClientBoundingRect;\n  let dw = 0,\n    dh = 0,\n    proportional;\n\n  switch (true) {\n    case dragHandle === 'nw':\n      dw = x - clientLeft;\n      dh = y - clientTop;\n\n      proportional = proportionalWidthAndHeight(\n        initialOffsetBoundingRect,\n        offsetWidth - dw,\n        offsetHeight - dh,\n      );\n\n      return {\n        left: offsetLeft + offsetWidth - proportional.width,\n        top: offsetTop + offsetHeight - proportional.height,\n        width: proportional.width,\n        height: proportional.height,\n      };\n    case dragHandle === 'n':\n      dw = 0;\n      dh = y - clientTop;\n\n      return {\n        left: offsetLeft,\n        top: offsetTop + dh,\n        width: offsetWidth,\n        height: offsetHeight - dh,\n      };\n    case dragHandle === 'ne':\n      dw = clientLeft + clientWidth - x;\n      dh = y - clientTop;\n\n      proportional = proportionalWidthAndHeight(\n        initialOffsetBoundingRect,\n        offsetWidth - dw,\n        offsetHeight - dh,\n      );\n      return {\n        left: offsetLeft,\n        top: offsetTop + offsetHeight - proportional.height,\n        width: proportional.width,\n        height: proportional.height,\n      };\n    case dragHandle === 'w':\n      dw = x - clientLeft;\n      dh = 0;\n\n      return {\n        left: offsetLeft + dw,\n        top: offsetTop,\n        width: offsetWidth - dw,\n        height: offsetHeight,\n      };\n    case dragHandle === 'e':\n      dw = clientLeft + clientWidth - x;\n      dh = 0;\n\n      return {\n        left: offsetLeft,\n        top: offsetTop,\n        width: offsetWidth - dw,\n        height: offsetHeight,\n      };\n    case dragHandle === 'sw':\n      dw = x - clientLeft;\n      dh = clientTop + clientHeight - y;\n\n      proportional = proportionalWidthAndHeight(\n        initialOffsetBoundingRect,\n        offsetWidth - dw,\n        offsetHeight - dh,\n      );\n\n      return {\n        left: offsetLeft + offsetWidth - proportional.width,\n        top: offsetTop,\n        width: proportional.width,\n        height: proportional.height,\n      };\n    case dragHandle === 's':\n      dw = 0;\n      dh = clientTop + clientHeight - y;\n\n      return {\n        left: offsetLeft,\n        top: offsetTop,\n        width: offsetWidth,\n        height: offsetHeight - dh,\n      };\n    case dragHandle === 'se':\n      dw = clientLeft + clientWidth - x;\n      dh = clientTop + clientHeight - y;\n\n      proportional = proportionalWidthAndHeight(\n        initialOffsetBoundingRect,\n        offsetWidth - dw,\n        offsetHeight - dh,\n      );\n      return {\n        left: offsetLeft,\n        top: offsetTop,\n        width: proportional.width,\n        height: proportional.height,\n      };\n    default:\n      throw new Error('unhandled drag handle in Image Editor boundingRect: ' + dragHandle);\n  }\n};\n"]}