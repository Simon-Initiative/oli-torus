{"version":3,"file":"AddActivity.jsx","sourceRoot":"","sources":["../../../../../src/components/content/add_resource_content/AddActivity.tsx"],"names":[],"mappings":"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","sourcesContent":["import { invokeCreationFunc } from 'components/activities/creation';\nimport { ActivityModelSchema } from 'components/activities/types';\nimport { AddCallback } from 'components/content/add_resource_content/AddResourceContent';\nimport { ActivityEditContext } from 'data/content/activity';\nimport { ActivityEditorMap, EditorDesc } from 'data/content/editors';\nimport { ActivityReference, ResourceContext } from 'data/content/resource';\nimport * as Persistence from 'data/persistence/activity';\nimport React from 'react';\nimport guid from 'utils/guid';\n\ninterface Props {\n  resourceContext: ResourceContext;\n  onAddItem: AddCallback;\n  editorMap: ActivityEditorMap;\n  index: number;\n}\nexport const AddActivity: React.FC<Props> = ({ resourceContext, onAddItem, editorMap, index }) => {\n  const activityEntries = Object.keys(editorMap)\n    .map((k: string) => {\n      const editorDesc: EditorDesc = editorMap[k];\n      const enabled = editorDesc.globallyAvailable || editorDesc.enabledForProject;\n\n      return enabled ? (\n        <a\n          href=\"#\"\n          key={editorDesc.slug}\n          className=\"list-group-item list-group-item-action flex-column align-items-start\"\n          onClick={(_e) => addActivity(editorDesc, resourceContext, onAddItem, editorMap, index)}\n        >\n          <div className=\"type-label\"> {editorDesc.friendlyName}</div>\n          <div className=\"type-description\"> {editorDesc.description}</div>\n        </a>\n      ) : null;\n    })\n    .filter((e) => e !== null);\n\n  return (\n    <>\n      <div className=\"header\">Activities...</div>\n      <div className=\"list-group\">{activityEntries}</div>\n    </>\n  );\n};\n\nexport const addActivity = (\n  editorDesc: EditorDesc,\n  resourceContext: ResourceContext,\n  onAddItem: AddCallback,\n  editorMap: ActivityEditorMap,\n  index: number,\n) => {\n  let model: ActivityModelSchema;\n\n  invokeCreationFunc(editorDesc.slug, resourceContext)\n    .then((createdModel) => {\n      model = createdModel;\n\n      return Persistence.create(resourceContext.projectSlug, editorDesc.slug, model, []);\n    })\n    .then((result: Persistence.Created) => {\n      const resourceContent: ActivityReference = {\n        type: 'activity-reference',\n        id: guid(),\n        activitySlug: result.revisionSlug,\n        purpose: 'none',\n        children: [],\n      };\n\n      // For every part that we find in the model, we attach the selected\n      // objectives to it\n      const objectives = model.authoring.parts\n        .map((p: any) => p.id)\n        .reduce((p: any, id: string) => {\n          p[id] = [];\n          return p;\n        }, {});\n\n      const editor = editorMap[editorDesc.slug];\n\n      const activity: ActivityEditContext = {\n        authoringElement: editor.authoringElement as string,\n        description: editor.description,\n        friendlyName: editor.friendlyName,\n        activitySlug: result.revisionSlug,\n        typeSlug: editorDesc.slug,\n        activityId: result.resourceId,\n        title: editor.friendlyName,\n        model,\n        objectives,\n        tags: [],\n      };\n\n      onAddItem(resourceContent, index, activity);\n    })\n    .catch((err) => {\n      // tslint:disable-next-line\n      console.error(err);\n    });\n};\n"]}