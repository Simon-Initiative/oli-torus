{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../../src/components/cookies/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import { selectCookieConsent } from 'components/cookies/CookieConsent';\n\nexport type CookieDetails = {\n  name: string;\n  value: string;\n  duration?: number;\n  durationUtc?: string;\n  expiresIso?: string;\n  expiration?: string;\n};\n\nexport const setCookies = (cookies: CookieDetails[]) => {\n  cookies.forEach((cookie) => {\n    const d = new Date();\n    if (cookie.duration) d.setTime(d.getTime() + cookie.duration);\n\n    cookie.durationUtc = d.toUTCString();\n    cookie.expiresIso = d.toISOString();\n\n    setCookie(cookie.name, cookie.value, cookie.durationUtc);\n  });\n  persistCookie(cookies);\n};\n\nexport const consentOptions = () => {\n  const optSetCookie = getCookie('_cky_opt_choices');\n  let userOptions = {\n    necessary: true,\n    functionality: true,\n    analytics: true,\n    targeting: false,\n  };\n  if (optSetCookie !== '') {\n    userOptions = JSON.parse(optSetCookie);\n  }\n  return userOptions;\n};\n\nconst setCookie = (cname: string, cvalue: string, duration: string) => {\n  const expires = 'expires=' + duration;\n  document.cookie = cname + '=' + cvalue + ';' + expires + ';path=/;SameSite=None; Secure';\n};\n\nconst getCookie = (cname: string) => {\n  const name = cname + '=';\n  const decodedCookie = decodeURIComponent(document.cookie);\n  const ca = decodedCookie.split(';');\n  for (let i = 0; i < ca.length; i++) {\n    let c = ca[i];\n    while (c.charAt(0) === ' ') {\n      c = c.substring(1);\n    }\n    if (c.indexOf(name) === 0) {\n      return c.substring(name.length, c.length);\n    }\n  }\n  return '';\n};\n\nconst processConsent = () => {\n  let optInCookie = getCookie('_cky_opt_in');\n  const dismissOptIn = getCookie('_cky_opt_in_dismiss');\n  if (optInCookie === '') {\n    const days = 365 * 24 * 60 * 60 * 1000;\n    setCookies([{ name: '_cky_opt_in', value: 'false', duration: days }]);\n    optInCookie = 'false';\n  }\n\n  if (optInCookie === 'false' && dismissOptIn === '') {\n    const minutes = 60 * 60 * 1000;\n    setCookies([{ name: '_cky_opt_in_dismiss', value: 'true', duration: minutes }]);\n    selectCookieConsent();\n  }\n};\n\nconst persistCookie = (cookies: CookieDetails[]) => {\n  fetch('/consent/cookie', {\n    method: 'POST',\n    headers: {\n      Accept: 'application/json',\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({ cookies: cookies }),\n  })\n    .then((response) => response.json())\n    .then((json) => {\n      return json;\n    })\n    .catch((error) => {\n      return error;\n    });\n};\n\nexport const retrieveCookies = (url: string) => {\n  const optInCookie = getCookie('_cky_opt_in');\n  if (optInCookie === '') {\n    fetch(url, {\n      method: 'GET',\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n      },\n    })\n      .then((response) => response.json())\n      .then((json) => {\n        if (!json.result) {\n          const dateNow = new Date();\n          json.forEach((c: CookieDetails) => {\n            if (c.expiration) {\n              const expiration = new Date(c.expiration);\n              if (expiration > dateNow) {\n                c.durationUtc = expiration.toUTCString();\n                setCookie(c.name, c.value, c.durationUtc);\n              }\n            }\n          });\n        }\n        processConsent();\n        return json;\n      })\n      .catch((error) => {\n        return error;\n      });\n  }\n};\n"]}