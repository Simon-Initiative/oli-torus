{"version":3,"file":"AddPartToolbar.jsx","sourceRoot":"","sources":["../../../../../../../src/components/activities/adaptive/components/authoring/AddPartToolbar.tsx"],"names":[],"mappings":"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","sourcesContent":["import { AnyPartComponent } from 'components/parts/types/parts';\nimport React, { Fragment, useCallback, useEffect, useState } from 'react';\nimport { ListGroup, Overlay, OverlayTrigger, Popover, Tooltip } from 'react-bootstrap';\nimport guid from 'utils/guid';\n\ninterface AddPartToolbarProps {\n  partTypes: string[];\n  priorityTypes?: string[];\n  onAdd: (part: AnyPartComponent) => void;\n}\n\nconst AddPartToolbar: React.FC<AddPartToolbarProps> = ({\n  partTypes,\n  priorityTypes = [],\n  onAdd,\n}) => {\n  const paths = { images: '/images' }; // TODO: provide context to authoring\n  const imgsPath = paths?.images || '';\n  const availablePartComponents = (window as any)['partComponentTypes'] || []; // TODO: replace with context\n\n  const [priorityPartComponents, setPriorityPartComponents] = useState<any[]>([]);\n  const [otherPartComponents, setOtherPartComponents] = useState<any[]>([]);\n\n  const [showMorePartsMenu, setShowMorePartsMenu] = useState(false);\n  const [morePartsMenuTarget, setMorePartsMenuTarget] = useState(null);\n\n  const handleMoreButtonClick = (e: any) => {\n    setShowMorePartsMenu((current) => !current);\n    setMorePartsMenuTarget(e.target);\n  };\n\n  const handleAddPartClick = useCallback(\n    (partSlug: string) => {\n      setShowMorePartsMenu(false);\n      setMorePartsMenuTarget(null);\n\n      const partType = availablePartComponents.find((p: any) => p.slug === partSlug);\n      if (partType) {\n        const PartClass = customElements.get(partType.authoring_element);\n        if (PartClass) {\n          const part = new PartClass() as any;\n          const newPartData = {\n            id: `${partSlug}-${guid()}`,\n            type: partType.delivery_element,\n            custom: {\n              x: 10,\n              y: 10,\n              z: 0,\n              width: 100,\n              height: 100,\n            },\n          };\n          const creationContext = { transform: { ...newPartData.custom } };\n          if (part.createSchema) {\n            newPartData.custom = { ...newPartData.custom, ...part.createSchema(creationContext) };\n          }\n          onAdd(newPartData);\n        }\n      }\n    },\n    [availablePartComponents, onAdd],\n  );\n\n  useEffect(() => {\n    const filteredByPriority = availablePartComponents\n      .filter((part: any) => partTypes[0] === '*' || partTypes.includes(part.slug))\n      .filter((part: any) => priorityTypes.includes(part.slug))\n      .sort((a: any, b: any) => {\n        const aIndex = priorityTypes.indexOf(a.slug);\n        const bIndex = priorityTypes.indexOf(b.slug);\n        return aIndex - bIndex;\n      });\n    setPriorityPartComponents(filteredByPriority);\n    const remainder = availablePartComponents\n      .filter((part: any) => partTypes[0] === '*' || partTypes.includes(part.slug))\n      .filter((part: any) => !priorityTypes.includes(part.slug));\n    setOtherPartComponents(remainder);\n  }, [availablePartComponents, priorityTypes]);\n\n  return (\n    <Fragment>\n      <div className=\"btn-group align-items-center\" role=\"group\">\n        {priorityPartComponents.map((part) => (\n          <OverlayTrigger\n            key={part.slug}\n            placement=\"bottom\"\n            delay={{ show: 150, hide: 150 }}\n            overlay={\n              <Tooltip id=\"button-tooltip\" style={{ fontSize: '12px' }}>\n                <strong>{part.title}</strong>\n                <br />\n                <em>{part.description}</em>\n              </Tooltip>\n            }\n          >\n            <span>\n              <button className=\"px-2 btn btn-link\" onClick={() => handleAddPartClick(part.slug)}>\n                <img src={`${imgsPath}/icons/${part.icon}`}></img>\n              </button>\n            </span>\n          </OverlayTrigger>\n        ))}\n      </div>\n      {otherPartComponents.length > 0 && (\n        <div className=\"btn-group pl-3 ml-3 border-left align-items-center\" role=\"group\">\n          <OverlayTrigger\n            placement=\"bottom\"\n            delay={{ show: 150, hide: 150 }}\n            overlay={\n              <Tooltip id=\"button-tooltip\" style={{ fontSize: '12px' }}>\n                More Components\n              </Tooltip>\n            }\n          >\n            <span>\n              <button className=\"px-2 btn btn-link\" onClick={handleMoreButtonClick}>\n                <img src={`${imgsPath}/icons/icon-componentList.svg`}></img>\n              </button>\n            </span>\n          </OverlayTrigger>\n          <Overlay\n            show={showMorePartsMenu}\n            target={morePartsMenuTarget}\n            placement=\"bottom\"\n            container={document.getElementById('advanced-authoring')}\n            containerPadding={20}\n            rootClose={true}\n            onHide={() => setShowMorePartsMenu(false)}\n          >\n            <Popover id=\"moreComponents-popover\">\n              <Popover.Title as=\"h3\">More Components</Popover.Title>\n              <Popover.Content>\n                <ListGroup className=\"aa-parts-list\">\n                  {otherPartComponents.map((part) => (\n                    <ListGroup.Item\n                      action\n                      onClick={() => handleAddPartClick(part.slug)}\n                      key={part.slug}\n                      className=\"d-flex align-items-center\"\n                    >\n                      <div className=\"text-center mr-1 d-inline-block\" style={{ minWidth: '36px' }}>\n                        <img title={part.description} src={`${imgsPath}/icons/${part.icon}`} />\n                      </div>\n                      <span className=\"mr-3\">{part.title}</span>\n                    </ListGroup.Item>\n                  ))}\n                </ListGroup>\n              </Popover.Content>\n            </Popover>\n          </Overlay>\n        </div>\n      )}\n    </Fragment>\n  );\n};\n\nexport default AddPartToolbar;\n"]}