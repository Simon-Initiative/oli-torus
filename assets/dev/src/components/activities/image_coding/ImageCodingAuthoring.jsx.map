{"version":3,"file":"ImageCodingAuthoring.jsx","sourceRoot":"","sources":["../../../../../src/components/activities/image_coding/ImageCodingAuthoring.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Hints as HintsAuthoring } from 'components/activities/common/hints/authoring/HintsAuthoringConnected';\nimport { Stem } from 'components/activities/common/stem/authoring/StemAuthoringConnected';\nimport { DEFAULT_PART_ID } from 'components/activities/common/utils';\nimport { MIMETYPE_FILTERS } from 'components/media/manager/MediaManager';\nimport { CloseButton } from 'components/misc/CloseButton';\nimport { Heading } from 'components/misc/Heading';\nimport { image } from 'data/content/model/elements/factories';\nimport * as ContentModel from 'data/content/model/elements/types';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { configureStore } from 'state/store';\nimport guid from 'utils/guid';\nimport {\n  AuthoringElement,\n  AuthoringElementProps,\n  AuthoringElementProvider,\n  useAuthoringElementContext,\n} from '../AuthoringElement';\nimport * as ActivityTypes from '../types';\nimport { MediaItemRequest } from '../types';\nimport { ICActions } from './actions';\nimport { ImageCodingModelSchema } from './schema';\nimport { Feedback } from './sections/Feedback';\nimport { ImageCodeEditor } from './sections/ImageCodeEditor';\nimport { lastPart } from './utils';\n\nconst ImageCoding = (props: AuthoringElementProps<ImageCodingModelSchema>) => {\n  const { dispatch, model, onRequestMedia } = useAuthoringElementContext<ImageCodingModelSchema>();\n\n  const { projectSlug } = props;\n\n  const sharedProps = {\n    model: props.model,\n    editMode: props.editMode,\n    projectSlug,\n    onRequestMedia,\n  };\n\n  function selectImage(_projectSlug: string, _model: ContentModel.Image): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const request = {\n        type: 'MediaItemRequest',\n        mimeTypes: MIMETYPE_FILTERS.IMAGE,\n      } as MediaItemRequest;\n      if (props.onRequestMedia) {\n        props.onRequestMedia(request).then((r) => {\n          if (r === false) {\n            reject('error');\n          } else {\n            resolve(r as string);\n          }\n        });\n      }\n    });\n  }\n\n  function selectSpreadsheet(\n    _projectSlug: string,\n    _model: ContentModel.Image,\n  ): Promise<ContentModel.Image> {\n    return new Promise((resolve, reject) => {\n      const request = {\n        type: 'MediaItemRequest',\n        mimeTypes: MIMETYPE_FILTERS.CSV,\n      } as MediaItemRequest;\n      if (props.onRequestMedia) {\n        props.onRequestMedia(request).then((r) => {\n          if (r === false) {\n            reject('error');\n          } else {\n            resolve({\n              type: 'img',\n              src: r as string,\n              id: guid(),\n              children: [],\n            });\n          }\n        });\n      }\n    });\n  }\n\n  const addImage = (_e: any) => {\n    selectImage(projectSlug, image()).then((url: string) => {\n      dispatch(ICActions.addResourceURL(url));\n    });\n  };\n\n  const addSpreadsheet = (_e: any) => {\n    selectSpreadsheet(projectSlug, image()).then((img) => {\n      dispatch(ICActions.addResourceURL(img.src));\n    });\n  };\n\n  const usesImage = () => {\n    return model.resourceURLs.some((url) => !url.endsWith('csv'));\n  };\n\n  const usesSpreadsheet = () => {\n    return model.resourceURLs.some((url) => url.endsWith('csv'));\n  };\n\n  const solutionParameters = () => {\n    return (\n      <div>\n        <Heading title=\"Solution\" id=\"solution-code\" />\n\n        <p>Image problems: Solution Code {!usesImage() ? '-- add image to enable' : ''}</p>\n        <ImageCodeEditor\n          disabled={!usesImage()}\n          value={model.solutionCode}\n          onChange={(newValue: string) => dispatch(ICActions.editSolutionCode(newValue))}\n        />\n        <br />\n        <p>\n          Tolerance:&nbsp;\n          <input\n            type=\"number\"\n            value={model.tolerance}\n            disabled={!usesImage()}\n            onChange={(e: any) => dispatch(ICActions.editTolerance(e.target.value))}\n          />\n          &nbsp;(Average per-pixel error allowed.)\n        </p>\n\n        <p>\n          Text output problems:\n          <br />\n          Regex:&nbsp;\n          <input\n            type=\"text\"\n            value={model.regex}\n            disabled={usesImage()}\n            onChange={(e: any) => dispatch(ICActions.editRegex(e.target.value))}\n          />\n          &nbsp;Pattern for correct text output\n        </p>\n      </div>\n    );\n  };\n\n  return (\n    <React.Fragment>\n      <Stem />\n\n      <Heading title=\"Resources\" id=\"images\" />\n      <div>\n        <ul className=\"list-group\">\n          {model.resourceURLs.map((url, i) => (\n            <li className=\"list-group-item\" key={i}>\n              {lastPart(url)}\n              <CloseButton\n                className=\"pl-3 pr-1\"\n                editMode={props.editMode}\n                onClick={() => dispatch(ICActions.removeResourceURL(url))}\n              />\n            </li>\n          ))}\n        </ul>\n        <button className=\"btn btn-primary mt-2\" onClick={addImage} disabled={usesSpreadsheet()}>\n          Add Image...\n        </button>\n        &nbsp;&nbsp;&nbsp;\n        <button className=\"btn btn-primary mt-2\" onClick={addSpreadsheet} disabled={usesImage()}>\n          Add Spreadsheet...\n        </button>\n      </div>\n      <br />\n\n      <Heading title=\"Starter Code\" id=\"starter-code\" />\n      <ImageCodeEditor\n        disabled={false}\n        value={model.starterCode}\n        onChange={(newValue: string) => dispatch(ICActions.editStarterCode(newValue))}\n      />\n      <br />\n\n      <div className=\"form-check mb-2\">\n        <input\n          className=\"form-check-input\"\n          type=\"checkbox\"\n          id=\"example-toggle\"\n          aria-label=\"Checkbox for example\"\n          checked={model.isExample}\n          onChange={(e: any) => dispatch(ICActions.editIsExample(e.target.checked))}\n        />\n        <label className=\"form-check-label\" htmlFor=\"example-toggle\">\n          <b>Example Only</b>\n        </label>\n      </div>\n\n      {!model.isExample && (\n        <div>\n          {solutionParameters()}\n\n          <HintsAuthoring partId={DEFAULT_PART_ID} />\n\n          <Feedback\n            {...sharedProps}\n            projectSlug={props.projectSlug}\n            onEditResponse={(score, content) => dispatch(ICActions.editFeedback(score, content))}\n          />\n        </div>\n      )}\n    </React.Fragment>\n  );\n};\n\nconst store = configureStore();\n\nexport class ImageCodingAuthoring extends AuthoringElement<ImageCodingModelSchema> {\n  render(mountPoint: HTMLDivElement, props: AuthoringElementProps<ImageCodingModelSchema>) {\n    ReactDOM.render(\n      <Provider store={store}>\n        <AuthoringElementProvider {...props}>\n          <ImageCoding {...props} />\n        </AuthoringElementProvider>\n      </Provider>,\n      mountPoint,\n    );\n  }\n}\n// eslint-disable-next-line\nconst manifest = require('./manifest.json') as ActivityTypes.Manifest;\nwindow.customElements.define(manifest.authoring.element, ImageCodingAuthoring);\n"]}