{"version":3,"file":"ActivityBankSelection.jsx","sourceRoot":"","sources":["../../../../../src/components/resource/editors/ActivityBankSelection.tsx"],"names":[],"mappings":"AAAA,OAAO,KAAK,MAAM,OAAO,CAAC;AAG1B,OAAO,EAAE,YAAY,EAAE,MAAM,+BAA+B,CAAC;AAC7D,OAAO,EAAE,SAAS,EAAE,MAAM,6BAA6B,CAAC;AAExD,OAAO,KAAK,IAAI,MAAM,mBAAmB,CAAC;AAgB1C,MAAM,CAAC,MAAM,qBAAqB,GAAG,CAAC,KAAiC,EAAE,EAAE;IACzE,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,KAAK,CAAC;IAEhD,MAAM,aAAa,GAAG,CAAC,WAAmB,EAAE,EAAE;QAC5C,IAAI,KAAK,CAAC;QAEV,IAAI;YACF,KAAK,GAAG,QAAQ,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC;SACnC;QAAC,OAAO,CAAC,EAAE;YACV,KAAK,GAAG,CAAC,CAAC;SACX;QAED,IAAI,KAAK,CAAC,KAAK,CAAC,IAAI,KAAK,IAAI,CAAC,EAAE;YAC9B,KAAK,GAAG,CAAC,CAAC;SACX;QAED,MAAM,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,KAAK,CAAC,SAAS,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;QAChE,QAAQ,CAAC,SAAS,CAAC,CAAC;IACtB,CAAC,CAAC;IAEF,MAAM,aAAa,GAAG,CAAC,KAAiB,EAAE,EAAE;QAC1C,IACE,KAAK,CAAC,UAAU,KAAK,IAAI;YACzB,CAAC,KAAK,CAAC,UAAU,CAAC,QAAQ,KAAK,IAAI,CAAC,cAAc,CAAC,GAAG;gBACpD,KAAK,CAAC,UAAU,CAAC,QAAQ,KAAK,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,EACxD;YACA,IAAI,KAAK,CAAC,UAAU,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE;gBAC1C,MAAM,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,KAAK,CAAC,SAAS,EAAE,EAAE,KAAK,EAAE,EAAE,UAAU,EAAE,IAAI,EAAE,EAAE,CAAC,CAAC;gBACtF,QAAQ,CAAC,SAAS,CAAC,CAAC;gBACpB,OAAO;aACR;iBAAM,IAAI,KAAK,CAAC,UAAU,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE;gBACjD,MAAM,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,KAAK,CAAC,SAAS,EAAE;oBACnD,KAAK,EAAE,EAAE,UAAU,EAAE,KAAK,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE;iBACpD,CAAC,CAAC;gBACH,QAAQ,CAAC,SAAS,CAAC,CAAC;gBACpB,OAAO;aACR;SACF;QACD,MAAM,SAAS,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,KAAK,CAAC,SAAS,EAAE;YACnD,KAAK;SACN,CAAC,CAAC;QACH,QAAQ,CAAC,SAAS,CAAC,CAAC;IACtB,CAAC,CAAC;IAEF,mFAAmF;IACnF,8DAA8D;IAC9D,MAAM,KAAK,GAAG,GAAG,EAAE;QACjB,MAAM,UAAU,GAAG;YACjB,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU;YAC1B,QAAQ,EAAE,IAAI,CAAC,kBAAkB,CAAC,QAAQ;YAC1C,KAAK,EAAE,EAAE;SACV,CAAC;QAEF,IAAI,SAAS,CAAC,KAAK,CAAC,UAAU,KAAK,IAAI,EAAE;YACvC,MAAM,UAAU,GAAG,UAAU,CAAC;YAC9B,MAAM,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,SAAS,CAAC,KAAK,EAAE,EAAE,UAAU,EAAE,CAAC,CAAC;YACjE,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,SAAS,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;SACnD;aAAM,IACL,SAAS,CAAC,KAAK,CAAC,UAAU,CAAC,QAAQ,KAAK,IAAI,CAAC,cAAc,CAAC,GAAG;YAC/D,SAAS,CAAC,KAAK,CAAC,UAAU,CAAC,QAAQ,KAAK,IAAI,CAAC,cAAc,CAAC,GAAG,EAC/D;YACA,MAAM,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,SAAS,CAAC,KAAK,CAAC,UAAU,EAAE;gBAC/D,QAAQ,EAAE,CAAC,GAAG,SAAS,CAAC,KAAK,CAAC,UAAU,CAAC,QAAQ,EAAE,UAAU,CAAC;aAC/D,CAAC,CAAC;YACH,MAAM,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,SAAS,CAAC,KAAK,EAAE,EAAE,UAAU,EAAE,CAAC,CAAC;YACjE,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,SAAS,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;SACnD;aAAM;YACL,MAAM,UAAU,GAAG;gBACjB,QAAQ,EAAE,IAAI,CAAC,cAAc,CAAC,GAAG;gBACjC,QAAQ,EAAE,CAAC,SAAS,CAAC,KAAK,CAAC,UAAU,EAAE,UAAU,CAAC;aACnD,CAAC;YACF,MAAM,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,SAAS,CAAC,KAAK,EAAE,EAAE,UAAU,EAAE,CAAC,CAAC;YACjE,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,SAAS,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;SACnD;IACH,CAAC,CAAC;IAEF,OAAO,CACL,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,yBAAyB,CAC9D;MAAA,CAAC,GAAG,CAAC,SAAS,CAAC,YAAY,CAAC,uBAAuB,EAAE,GAAG,CACxD;MAAA,CAAC,GAAG,CAAC,SAAS,CAAC,iCAAiC,CAC9C;QAAA,CAAC,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,iBAAiB,EAAE,GAAG,CAC5C;QAAA,CAAC,GAAG,CAAC,SAAS,CAAC,aAAa,CAC1B;UAAA,CAAC,SAAS,CACR,MAAM,CAAC,CAAC,aAAa,CAAC,CACtB,IAAI,CAAC,QAAQ,CACb,QAAQ,CAAC,CAAC,QAAQ,CAAC,CACnB,KAAK,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,CAClC,KAAK,CAAC,sBAAsB,EAEhC;QAAA,EAAE,GAAG,CACP;MAAA,EAAE,GAAG,CACL;MAAA,CAAC,GAAG,CAAC,SAAS,CAAC,MAAM,CAAC,uBAAuB,EAAE,GAAG,CAClD;MAAA,CAAC,YAAY,CACX,SAAS,CAAC,CAAC,KAAK,CAAC,CACjB,QAAQ,CAAC,CAAC,QAAQ,CAAC,CACnB,KAAK,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,CACvB,QAAQ,CAAC,CAAC,aAAa,CAAC,CACxB,sBAAsB,CAAC,CAAC,KAAK,CAAC,sBAAsB,CAAC,CACrD,gBAAgB,CAAC,CAAC,KAAK,CAAC,gBAAgB,CAAC,CACzC,aAAa,CAAC,CAAC,KAAK,CAAC,aAAa,CAAC,CACnC,OAAO,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CACvB,WAAW,CAAC,CAAC,KAAK,CAAC,WAAW,CAAC,CAC/B,SAAS,CAAC,CAAC,KAAK,CAAC,SAAS,CAAC,CAC3B,QAAQ,CAAC,CAAC,GAAG,EAAE,CAAC,IAAI,CAAC,EAEvB;MAAA,CAAC,MAAM,CAAC,SAAS,CAAC,wBAAwB,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,CACxD;;MACF,EAAE,MAAM,CACV;IAAA,EAAE,GAAG,CAAC,CACP,CAAC;AACJ,CAAC,CAAC","sourcesContent":["import React from 'react';\nimport * as Immutable from 'immutable';\nimport { ActivityBankSelection as Selection } from 'data/content/resource';\nimport { LogicBuilder } from 'components/logic/LogicBuilder';\nimport { TextInput } from 'components/common/TextInput';\nimport { Tag } from 'data/content/tags';\nimport * as Bank from 'data/content/bank';\nimport { Objective } from 'data/content/objective';\nimport { ActivityEditorMap } from 'data/content/editors';\n\nexport type ActivityBankSelectionProps = {\n  selection: Selection;\n  onChange: (selection: Selection) => void;\n  editMode: boolean;\n  allObjectives: Immutable.List<Objective>;\n  allTags: Immutable.List<Tag>;\n  projectSlug: string;\n  onRegisterNewObjective: (objective: Objective) => void;\n  onRegisterNewTag: (tag: Tag) => void;\n  editorMap: ActivityEditorMap;\n};\n\nexport const ActivityBankSelection = (props: ActivityBankSelectionProps) => {\n  const { selection, onChange, editMode } = props;\n\n  const onChangeCount = (countString: string) => {\n    let count;\n\n    try {\n      count = parseInt(countString, 10);\n    } catch (e) {\n      count = 1;\n    }\n\n    if (isNaN(count) || count <= 0) {\n      count = 1;\n    }\n\n    const selection = Object.assign({}, props.selection, { count });\n    onChange(selection);\n  };\n\n  const onChangeLogic = (logic: Bank.Logic) => {\n    if (\n      logic.conditions !== null &&\n      (logic.conditions.operator === Bank.ClauseOperator.all ||\n        logic.conditions.operator === Bank.ClauseOperator.any)\n    ) {\n      if (logic.conditions.children.length === 0) {\n        const selection = Object.assign({}, props.selection, { logic: { conditions: null } });\n        onChange(selection);\n        return;\n      } else if (logic.conditions.children.length === 1) {\n        const selection = Object.assign({}, props.selection, {\n          logic: { conditions: logic.conditions.children[0] },\n        });\n        onChange(selection);\n        return;\n      }\n    }\n    const selection = Object.assign({}, props.selection, {\n      logic,\n    });\n    onChange(selection);\n  };\n\n  // This add implementation allows only expressions to be added, but will implicitly\n  // insert an \"all\" clause to wrap a colleciton of expressions.\n  const onAdd = () => {\n    const expression = {\n      fact: Bank.Fact.objectives,\n      operator: Bank.ExpressionOperator.contains,\n      value: [],\n    };\n\n    if (selection.logic.conditions === null) {\n      const conditions = expression;\n      const logic = Object.assign({}, selection.logic, { conditions });\n      onChange(Object.assign({}, selection, { logic }));\n    } else if (\n      selection.logic.conditions.operator === Bank.ClauseOperator.all ||\n      selection.logic.conditions.operator === Bank.ClauseOperator.any\n    ) {\n      const conditions = Object.assign({}, selection.logic.conditions, {\n        children: [...selection.logic.conditions.children, expression],\n      });\n      const logic = Object.assign({}, selection.logic, { conditions });\n      onChange(Object.assign({}, selection, { logic }));\n    } else {\n      const conditions = {\n        operator: Bank.ClauseOperator.all,\n        children: [selection.logic.conditions, expression],\n      };\n      const logic = Object.assign({}, selection.logic, { conditions });\n      onChange(Object.assign({}, selection, { logic }));\n    }\n  };\n\n  return (\n    <div id={props.selection.id} className=\"activity-bank-selection\">\n      <div className=\"label mb-3\">Activity Bank Selection</div>\n      <div className=\"d-flex justify-items-start mb-4\">\n        <div className=\"mr-3\">Number to select:</div>\n        <div className=\"count-input\">\n          <TextInput\n            onEdit={onChangeCount}\n            type=\"number\"\n            editMode={editMode}\n            value={selection.count.toString()}\n            label=\"Number of activities\"\n          />\n        </div>\n      </div>\n      <div className=\"mb-3\">Criteria for selection:</div>\n      <LogicBuilder\n        allowText={false}\n        editMode={editMode}\n        logic={selection.logic}\n        onChange={onChangeLogic}\n        onRegisterNewObjective={props.onRegisterNewObjective}\n        onRegisterNewTag={props.onRegisterNewTag}\n        allObjectives={props.allObjectives}\n        allTags={props.allTags}\n        projectSlug={props.projectSlug}\n        editorMap={props.editorMap}\n        onRemove={() => true}\n      />\n      <button className=\"btn btn-primary btn-sm\" onClick={onAdd}>\n        Add Expression\n      </button>\n    </div>\n  );\n};\n"]}