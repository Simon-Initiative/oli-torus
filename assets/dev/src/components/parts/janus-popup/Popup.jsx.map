{"version":3,"file":"Popup.jsx","sourceRoot":"","sources":["../../../../../src/components/parts/janus-popup/Popup.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { CSSProperties, useCallback, useEffect, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { parseBool } from 'utils/common';\nimport { CapiVariableTypes } from '../../../adaptivity/capi';\nimport {\n  NotificationType,\n  subscribeToNotification,\n} from '../../../apps/delivery/components/NotificationContext';\nimport { contexts } from '../../../types/applicationContext';\nimport { PartComponentProps } from '../types/parts';\nimport { getIcon, getIconSrc } from './GetIcon';\nimport PopupWindow from './PopupWindow';\nimport { PopupModel } from './schema';\nimport { InitResultProps } from './types';\n\nconst Popup: React.FC<PartComponentProps<PopupModel>> = (props) => {\n  const [ready, setReady] = useState<boolean>(false);\n  const [model, setModel] = useState<any>(props.model);\n  const id: string = props.id;\n  const [context, setContext] = useState<boolean>(false);\n  const [showPopup, setShowPopup] = useState(false);\n  const [popupVisible, setPopupVisible] = useState(true);\n  const [iconSrc, setIconSrc] = useState('');\n\n  const [initSnapshot, setInitSnapshot] = useState<InitResultProps>();\n\n  const [activityHost, setActivityHost] = useState<any>(null);\n  const handleStylingChanges = () => {\n    const styleChanges: any = {};\n    if (width !== undefined) {\n      styleChanges.width = { value: width as number };\n    }\n    if (height != undefined) {\n      styleChanges.height = { value: height as number };\n    }\n    props.onResize({ id: `${id}`, settings: styleChanges });\n  };\n  const initialize = useCallback(async (pModel) => {\n    const initResult = await props.onInit({\n      id,\n      responses: [\n        {\n          key: 'visible',\n          type: CapiVariableTypes.BOOLEAN,\n          value: !!pModel.visible,\n        },\n        {\n          key: 'openByDefault',\n          type: CapiVariableTypes.BOOLEAN,\n          value: !!pModel.openByDefault,\n        },\n        {\n          key: 'isOpen',\n          type: CapiVariableTypes.BOOLEAN,\n          value: false,\n        },\n      ],\n    });\n\n    /* console.log('POPUP INIT', initResult); */\n    setActivityHost(initResult.context.host);\n\n    // result of init has a state snapshot with latest (init state applied)\n    setInitSnapshot(initResult);\n    const currentStateSnapshot = initResult.snapshot;\n    const isOpenByDefault: boolean | undefined = currentStateSnapshot[`stage.${id}.openByDefault`];\n    if (isOpenByDefault !== undefined) {\n      setShowPopup(isOpenByDefault);\n    }\n    const isOpen: boolean | undefined = currentStateSnapshot[`stage.${id}.isOpen`];\n    if (isOpen !== undefined && !isOpenByDefault) {\n      setShowPopup(isOpen);\n    }\n    const isVisible = currentStateSnapshot[`stage.${id}.visible`];\n    if (isVisible !== undefined) {\n      setPopupVisible(isVisible);\n    }\n    const initIconUrl = currentStateSnapshot[`stage.${id}.iconURL`];\n    if (initIconUrl !== undefined) {\n      if (getIcon(initIconUrl)) {\n        setIconSrc(getIcon(initIconUrl));\n      } else {\n        setIconSrc(initIconUrl);\n      }\n    }\n    if (initResult.context.mode === contexts.REVIEW) {\n      setContext(false);\n    }\n    handleStylingChanges();\n    setReady(true);\n  }, []);\n\n  useEffect(() => {\n    const { iconURL, defaultURL } = props.model;\n\n    setShowPopup(!!props.model.openByDefault);\n    setPopupVisible(!!props.model.visible);\n    setIconSrc(getIconSrc(iconURL, defaultURL));\n\n    initialize(props.model);\n  }, [props]);\n\n  const {\n    x,\n    y,\n    z,\n    width,\n    height,\n    customCssClass,\n    openByDefault,\n    visible,\n    defaultURL,\n    iconURL,\n    useToggleBehavior,\n    popup,\n    description,\n  } = model;\n\n  useEffect(() => {\n    if (!props.notify) {\n      return;\n    }\n    const notificationsHandled = [\n      NotificationType.CHECK_STARTED,\n      NotificationType.CHECK_COMPLETE,\n      NotificationType.CONTEXT_CHANGED,\n      NotificationType.STATE_CHANGED,\n    ];\n    const notifications = notificationsHandled.map((notificationType: NotificationType) => {\n      const handler = (payload: any) => {\n        /* console.log(`${notificationType.toString()} notification handled [Pop-up]`, payload); */\n        switch (notificationType) {\n          case NotificationType.CHECK_STARTED:\n            // nothing to do\n            break;\n          case NotificationType.CHECK_COMPLETE:\n            // nothing to do\n            break;\n          case NotificationType.STATE_CHANGED:\n            {\n              const { mutateChanges: changes } = payload;\n              const isOpen: boolean | undefined = changes[`stage.${id}.isOpen`];\n              if (isOpen !== undefined) {\n                setShowPopup(isOpen);\n                props.onSave({\n                  id,\n                  responses: [\n                    {\n                      key: 'isOpen',\n                      type: CapiVariableTypes.BOOLEAN,\n                      value: isOpen,\n                    },\n                  ],\n                });\n              }\n\n              const openByDefault = changes[`stage.${id}.openByDefault`];\n              if (openByDefault !== undefined) {\n                setShowPopup(parseBool(openByDefault));\n              }\n              const isVisible = changes[`stage.${id}.visible`];\n              if (isVisible !== undefined) {\n                setPopupVisible(isVisible);\n              }\n\n              const initIconUrl = changes[`stage.${id}.iconURL`];\n              if (initIconUrl !== undefined) {\n                if (getIcon(initIconUrl)) {\n                  setIconSrc(getIcon(initIconUrl));\n                } else {\n                  setIconSrc(initIconUrl);\n                }\n              }\n            }\n            break;\n          case NotificationType.CONTEXT_CHANGED:\n            {\n              const { snapshot: changes } = payload;\n\n              const isOpen: boolean | undefined = changes[`stage.${id}.isOpen`];\n              if (isOpen !== undefined) {\n                setShowPopup(isOpen);\n                props.onSave({\n                  id,\n                  responses: [\n                    {\n                      key: 'isOpen',\n                      type: CapiVariableTypes.BOOLEAN,\n                      value: isOpen,\n                    },\n                  ],\n                });\n              }\n              const isVisible = changes[`stage.${id}.visible`];\n              if (isVisible !== undefined) {\n                setPopupVisible(isVisible);\n              }\n\n              const initIconUrl = changes[`stage.${id}.iconURL`];\n              if (initIconUrl !== undefined) {\n                if (getIcon(initIconUrl)) {\n                  setIconSrc(getIcon(initIconUrl));\n                } else {\n                  setIconSrc(initIconUrl);\n                }\n              }\n            }\n            break;\n        }\n      };\n      const unsub = subscribeToNotification(props.notify, notificationType, handler);\n      return unsub;\n    });\n    return () => {\n      notifications.forEach((unsub) => {\n        unsub();\n      });\n    };\n  }, [props.notify]);\n\n  const iconTriggerStyle: CSSProperties = {\n    width,\n    height,\n  };\n\n  // Toggle popup open/close\n  const handleToggleIcon = (toggleVal: boolean) => {\n    setShowPopup(toggleVal);\n    // optimistically write state\n    props.onSave({\n      id,\n      responses: [\n        {\n          key: 'isOpen',\n          type: CapiVariableTypes.BOOLEAN,\n          value: toggleVal,\n        },\n      ],\n    });\n  };\n\n  const partComponents = popup?.partsLayout;\n  const config = popup?.custom ? popup.custom : null;\n\n  const PortalWindow = () => {\n    if (!initSnapshot) {\n      return null;\n    }\n    const windowProps = {\n      config,\n      parts: partComponents,\n      snapshot: initSnapshot.snapshot,\n      context: initSnapshot.context,\n      onClose: () => handleToggleIcon(false),\n    };\n    return activityHost && ReactDOM.createPortal(<PopupWindow {...windowProps} />, activityHost);\n  };\n\n  return ready ? (\n    <React.Fragment>\n      {popupVisible ? (\n        <input\n          data-janus-type={tagName}\n          role=\"button\"\n          {...(iconSrc\n            ? {\n                src: iconSrc,\n                type: 'image',\n                alt: description,\n              }\n            : {\n                type: 'button',\n              })}\n          className={`info-icon`}\n          aria-controls={id}\n          aria-haspopup=\"true\"\n          aria-label={description}\n          style={iconTriggerStyle}\n          {...(useToggleBehavior\n            ? {\n                onClick: () => handleToggleIcon(!showPopup),\n              }\n            : {\n                onMouseEnter: () => handleToggleIcon(true),\n                onMouseLeave: () => handleToggleIcon(false),\n                onFocus: () => handleToggleIcon(true),\n                onBlur: () => handleToggleIcon(false),\n              })}\n        />\n      ) : null}\n      {showPopup ? <PortalWindow /> : null}\n    </React.Fragment>\n  ) : null;\n};\n\nexport const tagName = 'janus-popup';\n\nexport default Popup;\n"]}