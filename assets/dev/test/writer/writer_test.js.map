{"version":3,"file":"writer_test.js","sourceRoot":"","sources":["../../../test/writer/writer_test.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-var-requires */\nimport { ContentWriter } from 'data/content/writers/writer';\nimport { defaultWriterContext } from 'data/content/writers/context';\nimport { HtmlParser } from 'data/content/writers/html';\nimport { render, screen } from '@testing-library/react';\nimport '@testing-library/jest-dom';\n\nconst exampleUnsupportedContent = require('./example_unsupported_content.json');\nconst exampleMalformedContent = require('./example_malformed_content.json');\nconst exampleContent = require('./example_content.json');\n\nconst parse = (content: any, context = defaultWriterContext()) =>\n  new ContentWriter().render(context, content, new HtmlParser());\n\ndescribe('parser', () => {\n  it('renders well-formed content properly', () => {\n    render(parse(exampleContent));\n\n    expect(\n      screen.getByText((content, element) => {\n        return element?.tagName.toLowerCase() === 'h3' && content === 'Introduction';\n      }),\n    ).toBeTruthy();\n\n    expect(\n      screen.getByText((content, element) => {\n        return (\n          element?.tagName.toLowerCase() === 'img' &&\n          element?.getAttribute('src') ===\n            'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f9/Declaration_of_Independence_%281819%29%2C_by_John_Trumbull.jpg/480px-Declaration_of_Independence_%281819%29%2C_by_John_Trumbull.jpg'\n        );\n      }),\n    ).toBeTruthy();\n\n    expect(\n      screen.getByText((content, element) => {\n        return (\n          element?.tagName.toLowerCase() === 'p' &&\n          content.startsWith(\n            'The American colonials proclaimed \"no taxation without representation',\n          )\n        );\n      }),\n    ).toBeTruthy();\n\n    expect(\n      screen.getByText((content, element) => {\n        return (\n          element?.tagName.toLowerCase() === 'a' &&\n          element.getAttribute('href') === '#' &&\n          content === 'Page Two'\n        );\n      }),\n    ).toBeTruthy();\n\n    expect(\n      screen.getByText((content, element) => {\n        return (\n          element?.tagName.toLowerCase() === 'a' &&\n          element.className === 'external-link' &&\n          element.getAttribute('href') === 'https://en.wikipedia.org/wiki/Stamp_Act_Congress' &&\n          content === 'Stamp Act Congress'\n        );\n      }),\n    ).toBeTruthy();\n\n    expect(\n      screen.getByText((content, element) => {\n        return element?.tagName.toLowerCase() === 'h3' && content === '1651â€“1748: Early seeds';\n      }),\n    ).toBeTruthy();\n\n    expect(\n      screen.getByText((content, element) => {\n        return (\n          element?.tagName.toLowerCase() === 'ol' &&\n          [...element.childNodes.values()].every((node) => node.nodeName.toLowerCase() === 'li')\n        );\n      }),\n    ).toBeTruthy();\n\n    expect(\n      screen.getByText((content, element) => {\n        return (\n          element?.tagName.toLowerCase() === 'ul' &&\n          [...element.childNodes.values()].every((node) => node.nodeName.toLowerCase() === 'li')\n        );\n      }),\n    ).toBeTruthy();\n\n    expect(\n      screen.getByText((content, element) => {\n        return (\n          element?.tagName.toLowerCase() === 'iframe' &&\n          element.getAttribute('src') === 'https://www.youtube.com/embed/fhdCslFcKFU' &&\n          content === ''\n        );\n      }),\n    ).toBeTruthy();\n\n    expect(\n      screen.getByText((content, element) => {\n        return (\n          element?.tagName.toLowerCase() === 'pre' &&\n          element?.firstChild?.nodeName.toLowerCase() === 'code' &&\n          !!element?.firstChild.textContent?.includes('import fresh-pots')\n        );\n      }),\n    ).toBeTruthy();\n  });\n\n  it('renders internal link with context', () => {\n    render(parse(exampleContent, defaultWriterContext({ sectionSlug: 'some_section' })));\n    expect(\n      screen.getByText((content, element) => {\n        return (\n          element?.tagName.toLowerCase() === 'a' &&\n          element.getAttribute('href') === '/sections/some_section/page/page_two' &&\n          content === 'Page Two'\n        );\n      }),\n    ).toBeTruthy();\n  });\n\n  it('renders malformed page gracefully', () => {\n    render(parse(exampleMalformedContent));\n\n    expect(\n      screen.getByText((content, element) => {\n        return element?.tagName.toLowerCase() === 'h3' && content === 'Introduction';\n      }),\n    ).toBeTruthy();\n\n    expect(\n      screen.getByText((content, element) => {\n        return (\n          element?.tagName.toLowerCase() === 'div' &&\n          element.className === 'content invalid' &&\n          content === 'Content element is invalid'\n        );\n      }),\n    ).toBeTruthy();\n  });\n\n  it('renders unsupported content gracefully', () => {\n    render(parse(exampleUnsupportedContent));\n\n    expect(\n      screen.getByText((content, element) => {\n        return element?.tagName.toLowerCase() === 'h3' && content === 'Introduction';\n      }),\n    ).toBeTruthy();\n\n    expect(\n      screen.getByText((content, element) => {\n        return (\n          element?.tagName.toLowerCase() === 'div' &&\n          element.className === 'content invalid' &&\n          content === 'Content element is invalid'\n        );\n      }),\n    ).toBeTruthy();\n  });\n});\n"]}