<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.25.2">
    <meta name="project" content="OLI Torus v0.18.4">

    <title>Oli.Delivery.Attempts.PageLifecycle.GradeUpdateWorker â€” OLI Torus v0.18.4</title>
    <link rel="stylesheet" href="dist/elixir-37545fd2f35b96531434.css" />

    <script src="dist/sidebar_items-bac9cf75b1.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/app-f97730d45ef67f3e6188.js"></script>


  </head>
  <body data-type="modules">
    <script>

      try {
        if (localStorage.getItem('night-mode') === 'true') {
          document.body.classList.add('night-mode');
        }
      } catch (error) { }
    </script>

<div class="main">

<button class="sidebar-button sidebar-toggle">
  <span class="icon-menu" title="Collapse/expand sidebar"></span>
</button>

<section class="sidebar">
  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <span class="icon-search" aria-hidden="true" title="Submit search"></span>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <span class="icon-cross" aria-hidden="true" title="Cancel search"></span>
    </button>
    <label class="search-label">
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">
    <div class="sidebar-projectDetails">
      <a href="http://oli.cmu.edu" class="sidebar-projectName">
OLI Torus
      </a>
      <strong class="sidebar-projectVersion">
        v0.18.4
      </strong>
    </div>

      <a href="http://oli.cmu.edu">
        <img src="assets/logo.png" alt="OLI Torus" class="sidebar-projectImage">
      </a>

  </div>

  <ul class="sidebar-listNav">
    <li><a id="extras-list-link" href="#full-list">Pages</a></li>

      <li><a id="modules-list-link" href="#full-list">Modules</a></li>


      <li><a id="tasks-list-link" href="#full-list">Mix Tasks</a></li>

  </ul>
  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <div class="content-outer">
    <div id="content" class="content-inner">

      <h1>
Oli.Delivery.Attempts.PageLifecycle.GradeUpdateWorker <small class="app-vsn">(OLI Torus v0.18.4)</small>

          <a href="https://github.com/Simon-Initiative/oli-torus/blob/master/lib/oli/delivery/attempts/page_lifecycle/grade_update_worker.ex#L1" title="View Source" class="view-source" rel="help">
            <span class="icon-code" aria-hidden="true"></span>
            <span class="sr-only">View Source</span>
          </a>

      </h1>


        <section id="moduledoc">
<p>An Oban worker driven LMS grade update.</p><p>Called via the <code class="inline">create</code> function, which takes a resource access id and an update type (:inline, :manual, :manual_batch).</p><p>This works by first fetching the <code class="inline">%ResourceAccess</code> record, and then posts the score and out_of found their
to the line item in the LMS. The line item is created if it doesn't already exist. Success and failure are tracked
via <code class="inline">%LMSGradeUpdate</code> records which hang off of the <code class="inline">%ResourceAccess</code> record.</p><p>It is important that we fetch the ResourceAccess record just in time to make this robust to the chance that students can be finalizing
additional attempts prior to the execution of this (potentially) deferred job.  An example series of events that can easily
lead to this situation:</p><ol><li>Student completes their first attempt and receives a 7/10.</li><li>This job executes, but fails (say due to a network timeout).  The job is rescheduled for a second attempt.</li><li>Meanwhile, the student - not satisfied with a 7/10 - takes and finishes a second attempt receiving 9/10.</li><li>Our Oban infrastructure detects this new job to be a duplicate of an existing and simply merges the two jobs.</li><li>When the original job finally executes in its second attempt, the &quot;just in time&quot; read of the %ResourceAccess record
results in the correct grade (9/10) being sent.</li></ol>
        </section>


        <section id="summary" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#summary">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
            Summary
          </h1>

  <div class="summary-functions summary">
    <h2>
      <a href="#functions">Functions</a>
    </h2>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#create/3">create(section_id, resource_access_id, update_type)</a>

  </div>

    <div class="summary-synopsis"><p>Create a grade update worker, given a resource_access_id and a job type.  The job type
is one of <code class="inline">[:inline, :manual, :manual_batch]</code></p></div>

</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#track_failure/5">track_failure(details, resource_access, type, job, section)</a>

  </div>

</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#track_not_synced/4">track_not_synced(resource_access, type, job, section)</a>

  </div>

</div>
<div class="summary-row">
  <div class="summary-signature">
    <a href="#track_success/4">track_success(resource_access, type, job, section)</a>

  </div>

</div>

  </div>

        </section>


        <section id="functions" class="details-list">
          <h1 class="section-heading">
            <a class="hover-link" href="#functions">
              <span class="icon-link" aria-hidden="true"></span>
              <span class="sr-only">Link to this section</span>
            </a>
Functions
          </h1>
          <div class="functions-list">
<section class="detail" id="create/3">

  <div class="detail-header">
    <a href="#create/3" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">create(section_id, resource_access_id, update_type)</h1>

      <a href="https://github.com/Simon-Initiative/oli-torus/blob/master/lib/oli/delivery/attempts/page_lifecycle/grade_update_worker.ex#L65" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Create a grade update worker, given a resource_access_id and a job type.  The job type
is one of <code class="inline">[:inline, :manual, :manual_batch]</code></p><p>Emits broadcasted PubSub events to allow client code to monitor the lifecycle of the grade update.
The status events emitted are: <code class="inline">[:queued, :running, :success, :failure, :not_synced, :retrying]</code></p><ul><li><code class="inline">:queued</code>: The grade update request is queued for its initial execution</li><li><code class="inline">:running</code>: The grade update request has started execution</li><li><code class="inline">:success</code>: The grade update request succeeded</li><li><code class="inline">:failure</code>: The grade update request failed permanently after exhausting all retry attempts</li><li><code class="inline">:not_synced</code>: The grade update request was not actually run due to LMS grade passback not being enabled</li><li><code class="inline">:retrying</code>: The grade update request failed, but is queued for a retry</li></ul>
  </section>
</section>
<section class="detail" id="track_failure/5">

  <div class="detail-header">
    <a href="#track_failure/5" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">track_failure(details, resource_access, type, job, section)</h1>

      <a href="https://github.com/Simon-Initiative/oli-torus/blob/master/lib/oli/delivery/attempts/page_lifecycle/grade_update_worker.ex#L254" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="track_not_synced/4">

  <div class="detail-header">
    <a href="#track_not_synced/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">track_not_synced(resource_access, type, job, section)</h1>

      <a href="https://github.com/Simon-Initiative/oli-torus/blob/master/lib/oli/delivery/attempts/page_lifecycle/grade_update_worker.ex#L273" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="track_success/4">

  <div class="detail-header">
    <a href="#track_success/4" class="detail-link" title="Link to this function">
      <span class="icon-link" aria-hidden="true"></span>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature">track_success(resource_access, type, job, section)</h1>

      <a href="https://github.com/Simon-Initiative/oli-torus/blob/master/lib/oli/delivery/attempts/page_lifecycle/grade_update_worker.ex#L263" class="view-source" rel="help" title="View Source">
       <span class="icon-code" aria-hidden="true"></span>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>

          </div>
        </section>

      <footer class="footer">

        <p>
          <span class="line">
            Built using
            <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener">ExDoc</a> (v0.25.2) for the
            <a href="https://elixir-lang.org" title="Elixir" target="_blank">Elixir programming language</a>.
          </span>
          <span class="line">
            Designed by
            <a href="https://twitter.com/dignifiedquire" target="_blank" rel="noopener" title="@dignifiedquire">Friedel Ziegelmayer</a>.
          </span>
        </p>
        <p>

            <a href="api-reference.html" title="API reference" class="line footer-button">API Reference</a>

          <button class="line footer-button display-shortcuts-help">
            Display keyboard shortcuts
          </button>
          <button class="line footer-button night-mode-toggle">
            Toggle night mode
          </button>
          <button class="line footer-button display-quick-switch">
            Go to a HexDocs package
          </button>
          <button class="line footer-button tooltips-toggle">
            <span class="tooltips-option-disable">Disable tooltips</span>
            <span class="tooltips-option-enable">Enable tooltips</span>
          </button>
        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>
