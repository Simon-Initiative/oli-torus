<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.28.5">
    <meta name="project" content="OLI Torus v0.21.5">

    <title>CI/CD and Deployment Process — OLI Torus v0.21.5</title>
    <link rel="stylesheet" href="dist/elixir-64c5e2b63575bddb1c5b.css" />

    <script src="dist/sidebar_items-e9b1ba3e2d.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/app-b5f3440501744dc8be3d.js"></script>


  </head>
  <body data-type="extras">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">


<section class="sidebar">
  <button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
    <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
  </button>

  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

      <a href="http://oli.cmu.edu">
        <img src="assets/logo.png" alt="OLI Torus" class="sidebar-projectImage">
      </a>

    <div class="sidebar-projectDetails">
      <a href="http://oli.cmu.edu" class="sidebar-projectName" translate="no">
OLI Torus
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v0.21.5
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">GUIDES</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="settings display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


    <a href="https://github.com/Simon-Initiative/oli-torus/blob/main/guides/process/deployment.md#L1" title="View Source" class="view-source" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>

  <span>CI/CD and Deployment Process</span>
</h1>

<h2 id="overview" class="section-heading">
  <a href="#overview" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">overview</p>
  </a>
  Overview
</h2>
<p>Torus uses Github Actions for its CI/CD pipelines. When a PR is opened, a build is automatically started and several checks are run including unit tests and lint checks which must all pass before a PR can be merged. Once a branch is merged into master, the resulting commit is packaged and deployed to the test server (<a href="https://tokamak.oli.cmu.edu">tokamak.oli.cmu.edu</a>). The test server will always represent the latest from master unless a manual deployment is made. When a release is made (tagged vX.Y.Z), a deployment is kicked off to the production server (<a href="proton.oli.cmu.edu">proton.oli.cmu.edu</a>). A production deployment will always use a prebuilt artifact identified by the version and commit SHA to ensure that the release tested is the same as the release deployed.</p><p><strong>Test Server:</strong> <a href="tokamak.oli.cmu.edu">tokamak.oli.cmu.edu</a></p><p><strong>Production Server:</strong> <a href="proton.oli.cmu.edu">proton.oli.cmu.edu</a></p><h2 id="pull-requests" class="section-heading">
  <a href="#pull-requests" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">pull-requests</p>
  </a>
  Pull Requests
</h2>
<p>Every pull request is required to pass a set of status checks in both Elixir and Typescript including a successful build, all unit tests passing, and successful lint with no errors (TypeScript). These checks are automatically started when a pull request is created. Other automated checks include Coveralls for unit test coverage and GitGuardian for identifying accidentally leaked secrets, however these checks are only informative and discretion is left to the developer and code reviewer to decide if issues found are blocking.</p><h2 id="deployments-to-test" class="section-heading">
  <a href="#deployments-to-test" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">deployments-to-test</p>
  </a>
  Deployments to Test
</h2>
<p>Deployments to the test server are automatically initiated when a pull request is landed to master. This means the test server will usually be up-to-date with the latest changes from the master branch. There are some situations however, when someone may want to manually push a deployment to the test server which can be accomplished with the following:</p><h3 id="release-candidates" class="section-heading">
  <a href="#release-candidates" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">release-candidates</p>
  </a>
  Release Candidates
</h3>
<p>If a release candidate is created with a tag formatted as <code class="inline">vX.Y.Z-rcN</code> where X.Y.Z represents a version number and N is the release candidate number, a deployment of the tag's targeted ref will be deployed to the test server.</p><ol><li>Go to <a href="https://github.com/Simon-Initiative/oli-torus/releases">https://github.com/Simon-Initiative/oli-torus/releases</a> and click &quot;Draft a new release&quot;</li><li>Enter your vX.Y.X-rcN for <strong>Tag version</strong> and <strong>Release Title</strong></li><li>Add the Features and Bug Fixes sections (formatted as markdown) to the description</li><li>Check &quot;This is a pre-release&quot;</li><li>Click &quot;Publish release&quot;</li></ol><h3 id="deploy-test-tag" class="section-heading">
  <a href="#deploy-test-tag" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">deploy-test-tag</p>
  </a>
  <code class="inline">deploy-test</code> Tag
</h3>
<p>A deployment can be initiated by tagging any git ref with the <code class="inline">deploy-test</code> tag and pushing to remote. For example:</p><pre><code class="makeup elixir" translate="no"><span class="n">git</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="o">--</span><span class="n">delete</span><span class="w"> </span><span class="n">deploy</span><span class="o">-</span><span class="n">test</span><span class="w">   </span><span class="c1"># if the tag previously existed locally</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="n">tag</span><span class="w"> </span><span class="n">deploy</span><span class="o">-</span><span class="n">test</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="n">push</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="n">deploy</span><span class="o">-</span><span class="n">test</span><span class="w"> </span><span class="o">--</span><span class="n">force</span></code></pre><h2 id="deployments-to-production" class="section-heading">
  <a href="#deployments-to-production" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">deployments-to-production</p>
  </a>
  Deployments to Production
</h2>
<p>Deployments to the production server will be initiated when a release is created with the tag formatted as <code class="inline">vX.Y.Z</code> where X.Y.Z represents a version number.</p><blockquote><p><strong>Note:</strong> Production deployments assume a previous build has been packaged, and therefore any commit tagged as a release must exist on the <code class="inline">master</code> branch, a <code class="inline">hotfix-*</code> branch or be packaged by tagging the commit with the <code class="inline">package</code> tag first.</p></blockquote><h2 id="hotfixes" class="section-heading">
  <a href="#hotfixes" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">hotfixes</p>
  </a>
  Hotfixes
</h2>
<p>A hotfix branch can be created using the release tag you wish to branch from. For example:</p><pre><code class="makeup elixir" translate="no"><span class="n">git</span><span class="w"> </span><span class="n">checkout</span><span class="w"> </span><span class="o">-</span><span class="n">b</span><span class="w"> </span><span class="n">hotfix</span><span class="o">-</span><span class="nc">X.Y</span><span class="o">.</span><span class="p" data-group-id="0125003288-1">[</span><span class="nc">Z</span><span class="o">+</span><span class="mi">1</span><span class="p" data-group-id="0125003288-1">]</span><span class="w"> </span><span class="n">vX</span><span class="o">.</span><span class="nc">Y.Z</span><span class="w">
</span><span class="n">git</span><span class="w"> </span><span class="n">push</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="n">hotfix</span><span class="o">-</span><span class="nc">X.Y</span><span class="o">.</span><span class="p" data-group-id="0125003288-2">[</span><span class="nc">Z</span><span class="o">+</span><span class="mi">1</span><span class="p" data-group-id="0125003288-2">]</span></code></pre><p>Once the hotfix branch is created, it will essentially act as the master branch to land all bug fixes and enhancements that are intended to be included in the hotfix.</p><p>When a hotfix branch is ready to be deployed, it can be tagged using the <strong>Release Candidate</strong> and <strong>Deployment Process</strong> outlined above. Hotfix branches that follow the convention <code class="inline">hotfix-</code> will automatically be packaged when pushed to remote, just like master. Make sure to wait for the package step to complete before creating a release, or else the deployment will fail.</p><blockquote><p><strong>Note:</strong> Because hotfix branches are automatically packaged based on the branch name convention, there is no need to manually tag with <code class="inline">package</code> before deploying.</p></blockquote><p>Finally, make sure the hotfix branch is eventually merged back to master to be included in downstream development. To do this easily, create a new branch from the hotfix branch called <code class="inline">integrate-X.Y.Z</code> (the name here is not necessarily important, but just serves as an example). Then pull <code class="inline">master</code> into this integration branch. Once any/all merge conflicts are resolved, open a PR against master.</p>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="changelog-pr.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Changelog processes
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="building.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Production Deployments
        </span>
      </a>

  </div>
</div>

      <footer class="footer">

        <p>
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.28.5) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>


  </body>
</html>
